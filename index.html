<html lang="en">
<head><link rel="icon" type="image/x-icon" href="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png">
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">



<!-- ——— Open Graph ——— -->
<meta property="og:type"        content="website">
<meta property="og:url"         content="https://clidder.example.com/">
<meta property="og:title"       content="Clidder – It's what’s going on">
<meta property="og:description" content="join today and see what's going on world?">
<meta property="og:image"       content="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png">

<!-- ——— Twitter Card (uses the same image) ——— -->
<meta name="twitter:card"        content="summary_large_image">
<meta name="twitter:site"        content="@ClidderApp">  <!-- optional -->
<meta name="twitter:title"       content="Clidder – What’s going on">
<meta name="twitter:description" content="Join Clidder, the fast, fun way to share what’s going in your world.">
<meta name="twitter:image"       content="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png">



  <title>Clidder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght𝓬𝓹400;700&display=swap"
    rel="stylesheet"
  />
  <style>
  body {
  font-family: "Helvetica Neue", "Segoe UI", system-ui, sans-serif;
}




/* Light mode (default) */
    body.light-mode {
      background-color: #ffffff;
      color: #111827;
    }
    body.light-mode header,
    body.light-mode #leftSidebar,
    body.light-mode #rightSidebar,
    body.light-mode #tweetBox,
    body.light-mode #modalAddPost > div,
    body.light-mode #modalAuth > div,
    body.light-mode #modalProfile > div,
    body.light-mode #modalCliddersContent,
    body.light-mode .bg-white {
      background-color: white;
      color: #111827;
    }
    body.light-mode .text-gray-700 {
      color: #374151;
    }
    body.light-mode .text-gray-900 {
      color: #111827;
    }
    body.light-mode .text-gray-600 {
      color: #4b5563;
    }
    body.light-mode .text-gray-500 {
      color: #6b7280;
    }
    body.light-mode .bg-[#FF7D1E] {
      background-color: #FF7D1E;
    }
    body.light-mode .hover\:bg-[#e6680f]:hover {
      background-color: #FF7D1E;
    }
    body.light-mode .bg-indigo-500 {
      background-color: #6366f1;
    }
    body.light-mode .hover\:bg-indigo-600:hover {
      background-color: #4f46e5;
    }
    body.light-mode .bg-yellow-500 {
      background-color: #eab308;
    }
    body.light-mode .hover\:bg-yellow-600:hover {
      background-color: #ca8a04;
    }
    body.light-mode .bg-purple-500 {
      background-color: #8b5cf6;
    }
    body.light-mode .hover\:bg-purple-600:hover {
      background-color: #7c3aed;
    }
    body.light-mode .bg-red-500 {
      background-color: #ef4444;
    }
    body.light-mode .hover\:bg-red-600:hover {
      background-color: #dc2626;
    }
    body.light-mode .bg-green-500 {
      background-color: #22c55e;
    }
    body.light-mode .hover\:bg-green-600:hover {
      background-color: #16a34a;
    }
    body.light-mode .bg-gray-300 {
      background-color: #d1d5db;
    }
    body.light-mode .hover\:bg-gray-400:hover {
      background-color: #9ca3af;
    }
    body.light-mode .bg-gray-100 {
      background-color: #f3f4f6;
    }
    body.light-mode .ring-[#FF7D1E] {
      --tw-ring-color: #FF7D1E;
    }

    /* Dark mode */
    body.dark-mode {
      background-color: #000000;
      color: #f9fafb;
    }
    body.dark-mode header,
body.dark-mode #centerContent,
    body.dark-mode #leftSidebar,
    body.dark-mode #rightSidebar,
    body.dark-mode #tweetBox,
    body.dark-mode #modalAddPost > div,
    body.dark-mode #modalAuth > div,
    body.dark-mode #modalProfile > div,
    body.dark-mode #modalCliddersContent,
    body.dark-mode .bg-white {
      background-color: #000000;
      color: #f9fafb;
    }
    body.dark-mode .text-gray-700 {
      color: #d1d5db;
    }
    body.dark-mode .text-gray-900 {
      color: #f9fafb;
    }
    body.dark-mode .text-gray-600 {
      color: #9ca3af;
    }
    body.dark-mode .text-gray-500 {
      color: #6b7280;
    }
    body.dark-mode .bg-[#FF7D1E] {
      background-color: #FF7D1E;
    }
    body.dark-mode .hover\:bg-[#e6680f]:hover {
      background-color: #FF7D1E;
    }
    body.dark-mode .bg-indigo-500 {
      background-color: #4f46e5;
    }
    body.dark-mode .hover\:bg-indigo-600:hover {
      background-color: #4338ca;
    }
    body.dark-mode .bg-yellow-500 {
      background-color: #ca8a04;
    }
    body.dark-mode .hover\:bg-yellow-600:hover {
      background-color: #a16207;
    }
    body.dark-mode .bg-purple-500 {
      background-color: #7c3aed;
    }
    body.dark-mode .hover\:bg-purple-600:hover {
      background-color: #6d28d9;
    }
    body.dark-mode .bg-red-500 {
      background-color: #dc2626;
    }
    body.dark-mode .hover\:bg-red-600:hover {
      background-color: #b91c1c;
    }
    body.dark-mode .bg-green-500 {
      background-color: #16a34a;
    }
    body.dark-mode .hover\:bg-green-600:hover {
      background-color: #15803d;
    }
    body.dark-mode .bg-gray-300 {
      background-color: #4b5563;
    }
    body.dark-mode .hover\:bg-gray-400:hover {
      background-color: #6b7280;
    }
    body.dark-mode .bg-gray-100 {
      background-color: #374151;
    }
    body.dark-mode .ring-[#FF7D1E] {
      --tw-ring-color: #FF7D1E;
    }

    /* Dark/Light mode toggle button styles */
    .mode-toggle-btn {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-weight: 600;
      user-select: none;
      transition: background-color 0.3s, color 0.3s;
    }
    body.light-mode .mode-toggle-btn {
      background-color: #FF7D1E;
      color: white;
    }
    body.light-mode .mode-toggle-btn:hover {
      background-color: #FF7D1E;
    }
    body.dark-mode .mode-toggle-btn {
      background-color: #93c5fd;
      color: #1e293b;
    }
    body.dark-mode .mode-toggle-btn:hover {
      background-color: #FF7D1E;
    }

    /* Position dark mode toggle in leftSidebar bottom */
#leftSidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 16rem;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding: 1rem;
  background-color: white; /* optional */
  box-sizing: border-box;
  z-index: 25;
  scrollbar-width: thin;               /* Firefox */
  scrollbar-color: #FF7D1E transparent; /* Firefox */
}

/* Chrome, Safari, Edge */
#leftSidebar::-webkit-scrollbar {
  width: 3px; /* very thin */
}
#leftSidebar::-webkit-scrollbar-thumb {
  background-color: #FF7D1E;
  border-radius: 10px;
}
#leftSidebar::-webkit-scrollbar-track {
  background: transparent;
}
#leftSidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 16rem;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding: 1rem;
  background-color: white; /* optional */
  box-sizing: border-box;
  z-index: 25;
  scrollbar-width: none; /* Firefox */
}

/* Hide scrollbar for WebKit browsers */
#leftSidebar::-webkit-scrollbar {
  display: none;
}

    #leftSidebar .mode-toggle-container {
      margin-top: auto;
      padding-top: 1rem;
      border-top: 1px solid #d1d5db;
    }
    body.dark-mode #leftSidebar .mode-toggle-container {
      border-top-color: #4b5563;
    }

    /* Position dark mode toggle in header top right */
    #headerModeToggle {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-weight: 600;
      user-select: none;
      transition: background-color 0.3s, color 0.3s;
      border: 1px solid transparent;
    }
    #headerModeToggle:hover {
      background-color: #e0e7ff;
    }
    body.dark-mode #headerModeToggle:hover {
      background-color: #4338ca;
      color: white;
    }
    body.dark-mode #headerModeToggle {
      color: #f9fafb;
      border-color: #a5b4fc;
    }


    #contextMenu {
      position: absolute;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
      z-index: 10000;
      width: 150px;
      display: none;
    }
    #contextMenu button {
      width: 100%;
      padding: 0.5rem 1rem;
      text-align: left;
      font-size: 0.875rem;
      color: #374151;
      background: transparent;
      border: none;
      cursor: pointer;
    }
    #contextMenu button:hover {
      background-color: #e5e7eb;
      color: #111827;
    }
    #centerContent {
  flex: 1;
  max-width: 610px;
  margin: 0 auto;
  padding: 1rem;
  width: 100%;
  box-sizing: border-box;
  overflow-y: auto;
  height: calc: 100vh;
  display: flex;
  flex-direction: column;
  gap: 0rem;
  scroll-behavior: smooth;
  
}

    #tweetBox {
      background: white;
      border-radius: 0rem;
      box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
      padding: 1rem 1.5rem;
      z-index: 20;
      flex-shrink: 0;
      position: relative !important;
        transition: all 0.3s ease-in-out;
      top: auto !important;
    }
    #tweetBox textarea {
      resize: none;
    }
    .tweet-action-btn {
      cursor: pointer;
      color: #6b7280;
      transition: color 0.2s ease;
      display: flex;
      align-items: center;
    }
    .tweet-action-btn:hover {
      color: #1d9bf0;
    }
    .liked {
      color: #e0245e !important;
    }
    #feed {
      display: flex;
      flex-direction: column;
      gap: 0rem;
    }
    .reply-list {
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  position: relative;
}

.reply-list::before {
  content: "";
  position: absolute;
  top: 0;
  left: 3.5rem; /* same as pl-14 */
  right: 0;
  height: 1px;
  background-color: #e5e7eb;
}

body.dark-mode .reply-list::before {
  background-color: #4b5563; /* Tailwind gray-600 */
}


    .reply-item {
      margin-bottom: 0.5rem;
    }
    .reply-item strong {
      color: #111827;
    }
    main.flex-grow {
      max-width: 100vw;
      padding-left: 0;
      padding-right: 0;
      overflow: hidden;
    }
    #leftSidebar {

      position: fixed;
      top: 0px;
      bottom: 0;
      overflow-y: auto;
      background: white;
      border-right: 1px ;
      padding: 1rem;
      width: 18rem;
      z-index: 25;
    }
    #rightSidebar {
      position: fixed;
      top: 0px;
      bottom: 0;
      overflow-y: auto;
      background: white;
      border-right: 1px ;
      padding: 1rem;
      width: 22rem;
      z-index: 10;
    }
#leftSidebar {
  left: 0;
  border-right: 1px solid #374151;
  border-left: none;
}

#rightSidebar {
  right: 0;
  border-left: 1px solid #374151;
  border-right: none;
}



#sidebarMessages,
 {
  display: none !important;
}



#leftSidebar button {
  padding: 0.3rem 0.5rem;
  border-radius: 9999px;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.875rem; /* 14px like Facebook */
  font-weight: 500;
  white-space: nowrap;
}


#leftSidebar button i {
  font-size: 1.5rem; /* Increased from 1.25rem */
  min-width: 28px;   /* Optional: ensures spacing */
  text-align: center;
}


#leftSidebar button:hover {
  background-color: rgba(59, 130, 246, 0.1); /* Tailwind blue-500 light */
  color: #FF7D1E;
}

body.dark-mode #leftSidebar button:hover {
  background-color: #1e40af33;
  color: #FF7D1E;
}





/* Light Mode Sidebar Borders */
body.light-mode #leftSidebar {
  border-right: 1px solid #DADEDD;
}

body.light-mode #rightSidebar {
  border-left: 1px solid #DADEDD;
}

/* Dark Mode Sidebar Borders */
body.dark-mode #leftSidebar {
  border-right: 1px solid #374151; /* Tailwind gray-700 */
}

body.dark-mode #rightSidebar {
  border-left: 1px solid #374151;
}


    @media (max-width: 1023px) {

      #leftSidebar,
      #rightSidebar {
        display: none;
      }
      #centerContent {
        margin-left: 0;
        margin-right: 0;
        height: auto;
        overflow-y: visible;
        padding: 0rem;
        max-width: 100%;
        width: 100%;

      }
      #tweetBox {
        position: relative !important;
        top: auto !important;
        box-shadow: none;
        padding: 1rem 0 0 0;
      }
    }

#notificationBadgeLeft {
  background-color: #FF7D1E; /* Tailwind blue-500 */
  color: white;
  font-size: 0.75rem;
  font-weight: 700;
  line-height: 1;
  padding: 0 6px;
  border-radius: 9999px;
  min-width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
}




    #sidebarNotifications {
      position: relative;
    }
    /* Notifications dropdown */
    #notificationsDropdown {
      position: absolute;
      top: 100%;
      right: 0;
      width: 320px;
      max-height: 400px;
      overflow-y: auto;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
      z-index: 10000;
      display: none;
    }
    #notificationsDropdown h3 {
      font-weight: 700;
      font-size: 1.125rem;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    #notificationsDropdown ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    #notificationsDropdown li {
      border-bottom: 1px solid #e5e7eb;
      padding: 0.75rem 1rem;
      cursor: pointer;
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
    }
    #notificationsDropdown li:last-child {
      border-bottom: none;
    }
    #notificationsDropdown li:hover {
      background-color: #f3f4f6;
    }
    #notificationsDropdown img {
      width: 40px;
      height: 40px;
      border-radius: 9999px;
      object-fit: cover;
      flex-shrink: 0;
    }
    #notificationsDropdown .notification-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #notificationsDropdown .notification-user {
      font-weight: 700;
      color: #111827;
      margin-bottom: 0.25rem;
    }
    #notificationsDropdown .notification-caption {
      color: #374151;
      white-space: pre-wrap;
      word-break: break-word;
      margin-bottom: 0.25rem;
    }
    #notificationsDropdown .notification-time {
      font-size: 0.75rem;
      color: #6b7280;
      user-select: none;
    }

/* Hide all scrollbars */
::-webkit-scrollbar {
  width: 0px;
  height: 0px;
  display: none;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: transparent;
}

::-webkit-scrollbar-thumb:hover {
  background: transparent;
}

/* For Firefox */
body {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* IE and Edge */
}

body::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}


/* Clidders Modal */
#modalClidders {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 11000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  overflow-y: auto;
}
#modalCliddersContent {
  background: white;
  border-radius: 0.5rem;
  max-width: 28rem;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  padding: 1rem 1.5rem 1.5rem 1.5rem;
  box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
}
#modalCliddersContent h2 {
  font-weight: 700;
  font-size: 1.25rem;
  margin-bottom: 1rem;
  text-align: center;
}
#modalCliddersContent ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
#modalCliddersContent li {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0;
  border-bottom: 1px solid #e5e7eb;
  cursor: pointer;
  transition: background-color 0.2s ease;
}
#modalCliddersContent li:last-child {
  border-bottom: none;
}
#modalCliddersContent li:hover {
  background-color: #f3f4f6;
}
#modalCliddersContent img {
  width: 40px;
  height: 40px;
  border-radius: 9999px;
  object-fit: cover;
  flex-shrink: 0;
}
#modalCliddersContent .user-info {
  display: flex;
  flex-direction: column;
}
#modalCliddersContent .user-name {
  font-weight: 700;
  color: #111827;
}
#modalCliddersContent .user-handle {
  font-size: 0.875rem;
  color: #6b7280;
}
#modalCliddersCloseBtn {
  position: absolute;
  top: 0.5rem;
  right: 0.75rem;
  background: transparent;
  border: none;
  font-size: 1.25rem;
  color: #6b7280;
  cursor: pointer;
  transition: color 0.2s ease;
}
#modalCliddersCloseBtn:hover {
  color: #111827;
}





body.light-mode #centerContent .bg-white{
  border: 2px #F3FFFF;
}

body.dark-mode #centerContent .bg-white{
  border: 1px solid #374151; /* Tailwind gray-700 */
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
}






body.light-mode #rightSidebar .bg-white.rounded-lg {
  border: 2px #F3FFFF;
}

body.dark-mode #rightSidebar .bg-white {
  border: 1px solid #374151;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
}




/* Light mode border */
body.light-mode #tweetBox {
  border: 1px solid #E5E7EB; /* Tailwind gray-200 */
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

/* Dark mode border */
body.dark-mode #tweetBox {
  border: 1px solid #374151; /* Tailwind gray-700 */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
}




body.dark-mode #tweetInput {
  background-color: transparent;
  color: #f9fafb;
  border: none;
}


body.dark-mode #searchInput {
  background-color: #1f2937;
  color: #f9fafb;
  border-color: #374151;
}


.hashtag {
  color: purple;
  cursor: pointer;
  text-decoration: none;
}

.hashtag:hover {
  text-decoration: underline;
}


.post-content {
  display: -webkit-box;
  -webkit-line-clamp: 15;
  -webkit-box-orient: vertical;
  overflow: hidden;
  position: relative;
  transition: max-height 0.3s ease;

  margin: 0.5rem 0 0 0 !important;
  padding-left: 3.5rem !important; /* 👈 Twitter-like spacing (~16px) */
}




.post-content.expanded {
  -webkit-line-clamp: unset;
  max-height: none;
}


.read-more {
  color: #FF7D1E;
  cursor: pointer;
  display: inline-block;
  margin-top: 4px;
  font-size: 0.875rem;

  display: block;              /* make it full-width */
  padding-left: 3.5rem;          /* same as .post-content */
}



#scrollTopBtn {
  transition: opacity 0.3s ease;
}

.text-unique-user {
color: gray;
font-weight: 600;
}
.text-unique-user:hover {
  text-decoration: underline;
  cursor: pointer;
}

@media (max-width: 767px) {
  #leftSidebar {
    display: none;
  }
}


@media (max-width: 768px) {
  .post-actions {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    width: 100%;
    gap: 10px;
    font-size: 0.9rem;
  }
  .post-actions button {
    flex: 1 1 22%;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 8px 0;
    font-size: 0.95rem;
  }
}

/* Styling select boxes in both light and dark modes */
select {
  padding: 4px 8px;
  border-radius: 0.375rem;
  border: 1px solid #ccc;
}

/* Light Mode */
body.light-mode select {
  background-color: white;
  color: black;
  border-color: #ccc;
}

/* Dark Mode */
body.dark-mode select {
  background-color: #1f2937;  /* Tailwind gray-800 */
  color: #f9fafb;             /* light text */
  border-color: #374151;      /* Tailwind gray-700 */
}
#editorToolbar select {
  margin-right: 6px;
}

@media (max-width: 768px) {
  header nav,
  #btnMenu {
    display: none !important;
  }
}

@media screen and (min-width: 769px) and (max-width: 1023px) {
  /* Applies to tablets and non-standard widths between mobile and desktop */

  body {
    font-size: 16px;
  }

  #leftSidebar,
  #rightSidebar {
    display: flex !important;
    position: fixed;
    top: 0;
    bottom: 0;
    overflow-y: auto;
    background-color: white;
    z-index: 20;
  }

  #leftSidebar {
    left: 0;
    width: 15rem;
    border-right: 1px solid #ccc;
  }

  #rightSidebar {
    right: 0;
    width: 15rem;
    border-left: 1px solid #ccc;
  }

  #centerContent {
    margin-left: 15rem;
    margin-right: 15rem;
    width: auto;
    padding: 1rem;
    height: 100vh;
    overflow-y: auto;
  }

  header {
    padding-left: 15rem;
    padding-right: 15rem;
  }

  #tweetBox {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border-radius: 0.5rem;
  }
}



#tweetInput {
  line-height: 1.4;
  font-size: 1rem;
  padding: 0.5rem 0;
}

body.dark-mode .reply-list {
  
  color: #d1d5db; /* light gray text */
}

body.dark-mode .reply-item strong {
  color: #f9fafb; /* near white for dark mode */
}

body.dark-mode .reply-item {
  background-color: transparent !important;
  padding: 0 !important;
  border-radius: 0 !important;
}




@keyframes gradientMove {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

.animate-gradient {
  animation: gradientMove 4s ease infinite;
}


.animated-gradient {
  background: linear-gradient(270deg, #6366f1, #FF7D1E, #ec4899, #f59e0b, #10b981);
  background-size: 800% 800%;
  animation: gradientShift 6s ease infinite;
}

@keyframes gradientShift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

#newPostAlert {
  animation: fadeSlideDown 0.4s ease;
}

@keyframes fadeSlideDown {
  from {
    opacity: 0;
    transform: translate(-50%, -20%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, 0%);
  }
}



/* Optional: toggle moon/sun icon */
body.light-mode #mobileModeToggle i::before {
  content: '\f186'; /* fa-moon */
}
body.dark-mode #mobileModeToggle i::before {
  content: '\f185'; /* fa-sun */
}

.animated-gradient {
  background: linear-gradient(270deg, #1e3a8a, #FF7D1E, #8b5cf6);
  background-size: 800% 800%;
  animation: gradientShift 6s ease infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}


/* Hide popup toggle on desktop */
.mobile-menu-toggle {
  font-size: 24px;
  cursor: pointer;
  padding: 8px;
}

/* Style the popup menu */
.mobile-popup-menu {
  position: fixed;
  top: 60px;
  right: 20px;
  background: #222;
  border: 1px solid #555;
  padding: 10px;
  border-radius: 8px;
  z-index: 9999;
}

.mobile-popup-menu button {
  display: block;
  width: 100%;
  margin: 5px 0;
  padding: 10px;
  background: #333;
  color: #fff;
  border: none;
  border-radius: 5px;
}

/* Show hamburger menu only on screens less than 768px */
@media (max-width: 768px) {
  .mobile-menu-toggle {
    display: inline-block !important;
  }

  .sidebar-button, .some-sidebar-class-for-those-buttons {
    display: none !important; /* Adjust class as needed */
  }
}

  html, body, *, *::before, *::after {
    -webkit-user-select: none !important; /* Safari/Chrome */
    -moz-user-select: none !important;    /* Firefox */
    -ms-user-select: none !important;     /* IE10+ */
    user-select: none !important;         /* Standard */
  }

/* ⋮⋮⋮ “More” dropdown */
#moreOptionsDropdown {
  position: absolute;
  top: 100%;
  right: 3rem;            /* adjust to sit under the ⋮ button */
  width: 150px;
  background: white;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  box-shadow: 0 10px 15px rgba(0,0,0,0.1);
  z-index: 10000;
  display: none;
}
#moreOptionsDropdown button {
  width: 100%;
  padding: 0.5rem 1rem;
  text-align: left;
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  color: #374151;
}
#moreOptionsDropdown button:hover {
  background-color: #f3f4f6;
  color: #111827;
}

body.dark-mode .reply-item {
  background-color: transparent !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  margin: 0 !important;
}


.reply-item {
  margin-bottom: 0.25rem;
  font-size: 0.875rem;
}

.more-comments.hidden {
  display: none;
}

.notification-caption {
  color: #f59e0b; /* Tailwind amber-500 */
  font-weight: 600;
}

#birthdayBanner {
  background: linear-gradient(to right, #7c3aed, #FF7D1E, #06b6d4, #10b981);
  color: #ffffff;
  font-weight: 700;
  padding: 0.75rem;
  text-align: center;
  display: none;
  font-size: 1.1rem;
  border-bottom: 2px solid #a855f7;
}

.birthday-banner-container {
  background: linear-gradient(to right, #7c3aed, #FF7D1E, #06b6d4, #10b981);
  border-bottom: 2px solid #a855f7;
  padding: 1rem;
  display: none;
  flex-direction: column;
  gap: 0.75rem;
  color: #ffffff;
  font-weight: 600;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.birthday-banner-title {
  font-size: 1.25rem;
  margin-bottom: 0.5rem;
  color: #ffffff;
}

.birthday-users-list {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: center; /* Center content horizontally */
  align-items: center;     /* Optional: center vertically if needed */
  overflow-x: auto;
  padding-bottom: 0.25rem;
}


.birthday-user-card {
  background: linear-gradient(to right, #6d28d9, #FF7D1E); /* Purple to blue gradient */
  border-radius: 12px;
  padding: 0.5rem 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
  white-space: nowrap;
  color: #ffffff;
  transition: transform 0.2s ease;
}

.birthday-user-card:hover {
  transform: translateY(-2px);
}

.birthday-user-card img {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #a855f7; /* Optional: highlight the photo */
}

.birthday-user-card span {
  font-size: 0.95rem;
  font-weight: 500;
  color: #ffffff;
}

body.dark-mode img {
  border: none !important;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* optional: soft shadow */
  background-color: transparent !important;
}

body.dark-mode .bg-white.rounded-lg img {
  border: none !important;
  background: transparent !important;
}


body.dark-mode .reply-item {
  background-color: transparent !important;
  padding: 0 !important;
  border-radius: 0 !important;
  border: none !important;
  box-shadow: none !important;
}
body.dark-mode .reply-item,
body.light-mode .reply-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem; /* Tailwind gap-3 */
  font-size: 0.875rem; /* text-sm */
  line-height: 1.25rem; /* leading-5 */
  margin-top: 0.5rem;
  color: inherit;
}


.reply-item .font-semibold {
  font-weight: 600;
  font-size: 0.875rem; /* text-sm */
  line-height: 1.25rem;
  color: #111827;
}

body.dark-mode .reply-item .font-semibold {
  color: #f9fafb;
}


.verified-badge {
  width: 16px;
  height: 16px;
  margin-left: 4px;
  vertical-align: middle;
}

body.light-mode #centerContent .bg-white {
  border-top: 1px solid #EDEDED;    /* Light gray like Twitter */
  border-bottom: 1px solid #EDEDED;
  border-left: none;
  border-right: none;
  box-shadow: none; /* No extra glow */
  border-radius: 0;
}

body.dark-mode #centerContent .bg-white {
  border-top: 1px solid #2d2f34;    /* Slightly lighter than black */
  border-bottom: 1px solid #2d2f34;
  border-left: none;
  border-right: none;
  box-shadow: none; /* Remove heavy glow */
  border-radius: 0;
}



body.dark-mode .post-options-menu {
  background-color: #1f2937;
  border-color: #374151;
  color: #f9fafb;
}
body.dark-mode .post-options-menu button:hover {
  background-color: #374151;
}



#centerContent {
  overflow-y: auto;
  height: 100vh; /* or calc(100vh - height of header if it's back */
  display: flex;
  flex-direction: column;
}



/* Compact action buttons like Twitter */
.post-actions {
  display: flex;
  justify-content: space-between;
  padding: 0 12px;
  font-size: 0.8rem;
  gap: 0.5rem;
}

.post-actions button {
  padding: 2px 6px;
  font-size: 0.8rem;
  display: flex;
  align-items: center;
  gap: 4px;
  color: #6b7280; /* Tailwind gray-500 */
  transition: color 0.2s ease;
  background: transparent;
  border: none;
}

.post-actions button i {
  font-size: 0.95rem; /* smaller icon size */
}

.post-actions button:hover {
  color: #1d9bf0; /* Twitter blue on hover */
}

/* Compact tweet-style font and spacing for posts */
#feed,
#feed .post-content,
#feed .reply-item {
  font-size: 17px;
  line-height: 1.3;
  padding: 0.5rem 0;
}

#feed .reply-item strong {
  font-size: 14px;
  font-weight: 600;
}

#feed .post-content p {
  margin-bottom: 0.25rem;
}

#feed .tweet-action-btn,
#feed .read-more,
#feed .post-actions button {
  font-size: 17px;
  line-height: 1.4;
}

#feed .post-actions {
  padding: 4px 8px;
  gap: 0.25rem;
}


#rightSidebar {
  font-family: "Helvetica Neue", "Segoe UI", system-ui, sans-serif;
  font-size: 14px;
  line-height: 1.4;
  font-weight: 400;
}

#rightSidebar h2 {
  font-size: 15px;
  font-weight: 700;
}

#rightSidebar p,
#rightSidebar li,
#rightSidebar a {
  font-size: 13px;
  line-height: 1.4;
  font-weight: 400;
}


#centerContent, #centerContent * {
  user-select: text !important;
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  -ms-user-select: text !important;
}


/* Make *every* badge inside the feed non-selectable */
#centerContent .verified-badge,
#centerContent .premium-badge,
#centerContent .pro-badge,
#centerContent .company-badge,
#centerContent .clidder-badge,
#centerContent .ai-badge {
  user-select: none !important;
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
}



  #topFeedTabs {
    display: none !important;
  }


/* Light mode border for profile button section */
body.light-mode .profile-button-border {
  border-color: #E5E7EB; /* Tailwind gray-200 */
}

/* Dark mode border for profile button section */
body.dark-mode .profile-button-border {
  border-color: #374151; /* Tailwind gray-700 */
}

#imageModal {
  display: none;
}
#imageModal.show {
  display: flex !important;
}

/* For dark mode input and textarea */
body.dark-mode input,
body.dark-mode textarea {
  background-color: #1f2937; /* Tailwind gray-800 */
  color: #f9fafb;             /* Light text */
  border-color: #374151;      /* Tailwind gray-700 */
}

/* Placeholder text */
body.dark-mode input::placeholder,
body.dark-mode textarea::placeholder {
  color: #9ca3af; /* Tailwind gray-400 */
}


.verified-badge {
  pointer-events: none !important;
  cursor: default !important;
}


.premium-badge {
  width: 16px;
  height: 16px;
  margin-left: 4px;
  vertical-align: middle;
  pointer-events: none;
}

.pro-badge {
  width: 16px;
  height: 16px;
  margin-left: 4px;
  vertical-align: middle;
  pointer-events: none;
}

.company-badge {
  width: 16px;
  height: 16px;
  margin-left: 4px;
  vertical-align: middle;
  pointer-events: none;
}

/* ORANGE-OUT ANY SCHEME THAT SHOULD STAND OUT */
.protocol-link {
  color: #FF7D1E !important;
}


.ai-badge {
  width: 16px;
  height: 16px;
  margin-left: 4px;
  vertical-align: middle;
  pointer-events: none;
}

.clidder-badge {
  width: 16px;
  height: 16px;
  margin-left: 4px;
  vertical-align: middle;
  pointer-events: none;
}


#sidebarMessages,
#sidebarLists {
  display: none !important;
}

#whoToFollowList {
  display: none !important;
}

#whoToFollowList::before,
#whoToFollowList::after,
#whoToFollowList:parent,
#whoToFollowList:parent * {
  display: none !important;
}

#leftSidebar {
  border: none !important;
}

body.light-mode #leftSidebar,
body.dark-mode #leftSidebar {
  border: none !important;
}

#rightSidebar {
  border: none !important;
}

body.light-mode #rightSidebar,
body.dark-mode #rightSidebar {
  border: none !important;
}




/* Light mode */
body.light-mode #centerContent .bg-white {
  border-left: 1px solid #E5E7EB;
  border-right: 1px solid #E5E7EB;
}

/* Dark mode */
body.dark-mode #centerContent .bg-white {
  border-left: 1px solid #374151; /* Tailwind gray-700 */
  border-right: 1px solid #374151;
}





  </style>


<!-- Facebook SDK root -->
<div id="fb-root"></div>

<!-- Instagram, Twitter and TikTok SDKs auto-load as needed -->

<link rel="manifest" href="/manifest.json" />
<meta name="theme-color" content="#FF7D1E" />


</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

<div id="splashScreen" style="position:fixed; top:0; left:0; width:100%; height:100vh; display:flex; align-items:center; justify-content:center; z-index:99999; background:#fff;">
  <img id="splashImage" src="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png" alt="Clidder Splash" style="width: 100px; height: 100px;" />
</div>



 <header class="bg-white border-b border-gray-300 sticky top-0 z-50">
<!-- ✅ MOBILE HEADER — updated -->
<!-- ✅ MOBILE HEADER with inline search -->
<div class="flex items-center justify-between p-4 md:hidden relative w-full">
  <!-- Left: Logo and Search -->
  <div class="flex items-center space-x-2 w-full">
    <!-- Logo -->
    <h1 class="text-xl font-extrabold select-none text-transparent bg-clip-text animated-gradient">
      𝓬𝓵𝓲𝓭𝓭𝓮𝓻
    </h1>

    <!-- Search Bar (Hidden by Default) -->
    <div id="mobileSearchContainer" class="flex-grow hidden">
      <input type="search" id="mobileSearchInput"
        placeholder="Search Clidder..."
        class="w-full rounded-md border border-gray-300 px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-[#FF7D1E] dark:bg-gray-800 dark:text-white" />
    </div>
  </div>

  <!-- Right: Controls -->
  <div class="flex items-center space-x-3 ml-2 flex-shrink-0">
    

    <!-- Dark Mode -->
  

    <!-- Clidders -->
 
<!-- Search Icon -->
 
    <!-- Menu -->
    <button onclick="toggleMobileSidebarMenu()" class="text-gray-700 dark:text-white text-xl focus:outline-none">
      ☰
    </button>
  </div>
</div>







  <!-- ✅ DESKTOP HEADER -->
  <div class="max-w-5xl mx-auto hidden md:flex items-center justify-between p-4 space-x-6">
    <!-- Left: Clidder Logo -->
    <div class="flex items-center flex-shrink-0">
      <h1 class="text-2xl font-bold select-none bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-transparent bg-clip-text animate-gradient bg-[length:200%_200%]">
        𝓬𝓵𝓲𝓭𝓭𝓮𝓻
      </h1>
    </div>

      
      <nav class="hidden md:flex space-x-6 text-gray-700 relative">
        <button aria-label="Home" class="hover:text-gray-900 focus:outline-none focus:text-gray-900" id="btnHome">
          <i class="fas fa-home fa-lg"></i>
        </button>
        <button aria-label="Add new hat post" class="hover:text-gray-900 focus:outline-none focus:text-gray-900" id="btnAddPost">
          <i class="fas fa-plus-square fa-lg"></i>
        </button>
        
        <button aria-label="Favorites" class="hover:text-gray-900 focus:outline-none focus:text-gray-900" id="btnFavorites">
          <i class="fas fa-star fa-lg"></i>
        </button>
        <button class="flex items-center space-x-1 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E] relative" id="sidebarNotifications" style="position: relative;">
          <i class="fas fa-bell fa-lg"></i>
        
          <span id="notificationBadge" style="display:none;">0</span>
        </button>

<button aria-label="User profile" class="hover:text-gray-900 focus:outline-none focus:text-gray-900" id="btnProfileTop">
          <i class="fas fa-user-circle fa-lg"></i>
        </button>

<!-- ⋮⋮⋮ More Options -->
<button id="btnMoreOptions" aria-label="More options" class="hover:text-gray-900 focus:outline-none focus:text-gray-900 relative">
  <i class="fas fa-ellipsis-v fa-lg"></i>
</button>
<div id="moreOptionsDropdown" role="menu" aria-hidden="true">
  <button id="moreAccount"    role="menuitem">Account</button>
  <button id="morePages"      role="menuitem">Pages</button>
  <button id="moreSettings"   role="menuitem">Settings</button>
  <button id="moreLogout"     role="menuitem">Logout</button>
</div>



<!-- Dark/Light mode toggle in header -->
        <button id="headerModeToggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode" type="button" class="ml-4">
          <i class="fas fa-moon"></i>
        </button>

        <div id="notificationsDropdown" role="region" aria-label="Notifications list" tabindex="-1">
          <h3>Notifications</h3>
          <ul id="notificationsList"></ul>
        </div>
      </nav>
      <button aria-label="Open menu" class="md:hidden text-gray-700 focus:outline-none" id="btnMenu">
        <i class="fas fa-bars fa-lg"></i>
      </button>
    </div>



</header>


  <main class="flex-grow max-w-full mx-auto w-full p-0 flex flex-row gap-0 relative">
    <aside id="leftSidebar" aria-label="Sidebar" class="hidden md:flex flex-col space-y-3 text-gray-700 text-lg" style="">









      <nav class="flex flex-col space-y-4">
        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarHome">
  <span class="relative inline-block">
    <i class="fas fa-home text-transparent bg-clip-text bg-gradient-to-r from-blue-500 via-indigo-500 to-pink-500"></i>



    <!-- Always-visible orange dot -->
    <span class="absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full"></span>
  </span>
  <span>Home</span>
</button>


        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarExplore" style="">
          <i class="fas fa-hashtag text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-yellow-400 to-purple-600 transition duration-300 ease-in-out"></i>

          <span>Discover</span>
        </button>

<button class="flex items-center space-x-3 hover:text-[#FF7D1E]" onclick="toggleClidderAIModal()">
  <img src="https://i.ibb.co/zVgvTJRF/clidder-ai.png" alt="AI Icon" class="w-5 h-5" />
  <span class="text-base font-medium">Clidder AI</span>
</button>



        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarNotificationsLeft">
          <i class="fas fa-bell text-transparent bg-clip-text bg-gradient-to-r from-red-500 via-pink-500 to-yellow-400 transition duration-300 ease-in-out"></i>

          <span>Notifications</span>
          <span id="notificationBadgeLeft" class="ml-1 bg-red-500 text-white rounded-full px-2 text-xs font-semibold" style="display:none;"></span>
        </button>

<button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarClips">
  <i class="fas fa-play-circle text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-sky-400 to-lime-400 transition duration-300 ease-in-out"></i>

  <span>Clips</span>
</button>

        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarMessages">
          <i class="fas fa-envelope text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-blue-500 to-indigo-500 transition duration-300 ease-in-out"></i>

          <span>Messages</span>
        </button>

        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarBookmarks">
          <i class="fas fa-bookmark text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-500 via-violet-600 to-cyan-400 transition duration-300 ease-in-out"></i>

          <span>Saved</span>
        </button>

        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarLists">
         <i class="fas fa-bolt text-black dark:text-white" style="text-shadow: -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black;"></i>
          <span>Verified Clidders</span>
        </button>

        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarFavorites">
          <i class="fas fa-star text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-amber-500 to-rose-500 transition duration-300 ease-in-out"></i>

          <span>Favorites</span>
        </button>

        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarFromMe">
          	<i class="fas fa-history text-transparent bg-clip-text bg-gradient-to-r from-stone-400 via-amber-600 to-yellow-600 transition duration-300 ease-in-out"></i>
          <span>My Activity</span>
        </button>

<button onclick="window.location.href='jobs-clidder.html'" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
  <i class="fas fa-briefcase text-sky-500"></i>
  <span>Jobs</span>
</button>


<button onclick="window.location.href='clidder-market-place.html'" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
  <i class="fas fa-chart-line text-emerald-500"></i>
  <span>Earnings</span>
</button>

        
       <button onclick="window.location.href='my-calendar.html'" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
  <i class="fas fa-calendar-alt text-indigo-500"></i>
  <span>My Calendar</span>
</button>


<button onclick="window.location.href='games-clidder.html'" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
  <i class="fas fa-gamepad text-transparent bg-clip-text bg-gradient-to-r from-rose-400 via-fuchsia-500 to-indigo-500"></i>
  <span>Games</span>
</button>




        <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarMore" style="">
          <i class="fas fa-users text-transparent bg-clip-text bg-gradient-to-r from-lime-400 via-emerald-400 to-cyan-500 transition duration-300 ease-in-out"></i>

          <span>Who  to Follow</span>
        </button>


<button id="sidebarBirthdays" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
  <i class="fas fa-birthday-cake text-pink-500"></i>
  <span>Birthdays</span>
</button>


<!-- Add this in the left sidebar navigation -->
<button id="sidebarSettings" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
  <i class="fas fa-cog text-transparent bg-clip-text bg-gradient-to-r from-zinc-400 via-blue-gray-500 to-slate-600 transition duration-300 ease-in-out"></i>

  <span>Settings</span>
</button>


 <button class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]" id="sidebarProfile" style="">
           <i class="fas fa-user-cog text-transparent bg-clip-text bg-gradient-to-r from-amber-700 via-lime-600 to-emerald-700 transition duration-300 ease-in-out"></i>

          <span>Account</span>
        </button>



<button id="sidebarTheme" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
<i class="fas fa-palette text-transparent bg-clip-text bg-gradient-to-r from-pink-300 via-orange-300 to-red-400 transition duration-300 ease-in-out"></i>

  <span>Theme</span>
</button>



      </nav>
      <button id="btnTweet" class="bg-[#FF7D1E] text-white rounded-full py-3 px-5 font-bold text-lg hover:bg-[#e6680f] transition flex items-center gap-2">
  <i class="fas fa-feather fa-lg"></i>
  Clidde</button>

<div class="mode-toggle-container">
        <button id="sidebarModeToggle" aria-label="Toggle dark/light mode" title="Toggle dark/light mode" type="button" class="mode-toggle-btn w-full">
          <i class="fas fa-moon"></i><span>Dark Mode</span>
        </button>
      </div>

<a href="https://blackhataccountcenter.netlify.app/" target="_blank" rel="noopener noreferrer"
   id="sidebarUserSummary" class="flex items-center space-x-3 mt-4 hidden hover:bg-gray-100 dark:hover:bg-gray-800 p-2 rounded cursor-pointer transition">
  <img id="sidebarUserPic" src="" alt="Profile" class="w-10 h-10 rounded-full" />
  <div>
    <div id="sidebarUserName" class="font-semibold text-sm"></div>
    <div id="sidebarUserHandle" class="text-gray-500 text-xs"></div>
  </div>
</a>




    </aside>

    <section id="centerContent" aria-live="polite" aria-relevant="additions" class="flex flex-col">


<!-- Transparent For You / Following Tabs like Twitter -->
<div id="topFeedTabs" class="fixed top-0 left-1/2 transform -translate-x-1/2 w-full max-w-xl z-40 border-b border-gray-200 dark:border-gray-700 backdrop-blur bg-transparent">
  <div class="flex justify-around text-sm font-semibold text-gray-500 dark:text-gray-300">
    <button id="tabForYou" class="flex-1 py-3 text-center transition-colors border-b-2 border-transparent hover:text-[#FF7D1E]">For You</button>
    <button id="tabFollowing" class="flex-1 py-3 text-center transition-colors border-b-2 border-transparent hover:text-[#FF7D1E]">From Verified</button>
  </div>
</div>

<div class="border-y profile-button-border px-4 py-1">
  <div class="flex items-center justify-between w-full relative">

    <!-- Left: Profile Button -->
    <button id="mobileNavProfile" class="flex items-center text-gray-600 hover:text-[#FF7D1E]">
      <img id="mobileProfilePicIcon" src="" alt="Profile" class="w-12 h-12 rounded-full hidden" />
      <i id="mobileProfileIconFallback" class="fas fa-user-circle fa-3x"></i>
    </button>

    <!-- Center: Clidder GPT Logo -->
    <div class="flex-1 flex justify-center">
      <img src="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png" alt="Clidder GPT" class="w-10 h-10" />
    </div>


    <a href="https://blackhat.com" target="_blank" rel="noopener noreferrer"
       class="text-[#FF7D1E] font-semibold text-sm hover:underline">
      Premium
    </a>


    <!-- Right: Three-dot button -->
    <div class="relative">
            <button id="headerMoreBtn" class="w-10 h-10 text-2xl font-bold text-gray-600 dark:text-white flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">
        ⋮
      </button>

      <!-- Dropdown menu -->
      <div id="headerMoreDropdown" class="hidden absolute right-0 mt-2 w-36 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50">
        <button onclick="document.getElementById('sidebarTheme').click()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700">Custom Themes</button>
        <button onclick="document.getElementById('sidebarSettings').click()" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700">Timeline Settings</button>
        <button onclick=window.location.href='timeline-setting.html' class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700">Dev Tools</button>


  <button id="dropdownModeToggle" class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between">
    <span>Dark Mode</span>
    <i class="fas fa-moon"></i>
  </button>

      </div>
    </div>

  </div>
</div>




      
<div id="tweetBox" class="bg-white dark:bg-black border border-gray-300 dark:border-gray-700 rounded-2xl p-4 shadow-sm">
  <div class="flex items-start space-x-4">
    <img id="currentUserPic" src="https://i.ibb.co/0VqN92C4/clidder-off-dark.png" alt="User" class="w-12 h-12 rounded-full object-cover" />
    <div class="flex flex-col w-full">
      <textarea
        id="tweetInput"
        rows="1"
        placeholder="What's going on?"
        class="w-full bg-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 text-lg border-none focus:outline-none resize-none"
      ></textarea>



      <div class="flex justify-between items-center mt-3">
        <div class="flex flex-wrap gap-4 text-[#FF7D1E] text-sm">

  <i class="fas fa-chart-bar cursor-pointer hover:text-[#e6680f]" title="Poll"></i>
  <i id="emojiToggle" class="fas fa-smile cursor-pointer hover:text-[#e6680f]" title="Emoji"></i>

<img
  src="https://i.ibb.co/zVgvTJRF/clidder-ai.png"
  alt="Clidder AI"
  class="w-3.5 h-3.5 cursor-pointer hover:opacity-80 transition"
  onclick="toggleClidderAIModal()"
  title="Clidder AI"
/>

</div>

<!-- Flexible Emoji Picker Panel -->
<div id="emojiPicker"
     class="hidden mt-2 max-h-60 overflow-y-auto border rounded p-2 bg-white dark:bg-gray-800 shadow-md"
     style="width: 320px;">
</div>





        <button
          id="btnSubmitTweet"
          class="bg-[#FF7D1E] hover:bg-[#e6680f] text-white font-semibold px-5 py-2 rounded-full disabled:opacity-50"
          disabled
        >
         Clidde
        </button>
      </div>

      
    </div>
  </div>
</div>








<section id="birthdayUsersSection" class="hidden flex-col space-y-4 mt-4 px-4">
  <div>
    <h2 class="birthday-banner-title">🎉 Today's Birthdays</h2>
    <div id="todayBirthdayList" class="birthday-users-list flex-wrap"></div>
  </div>
  <div>
    <h2 class="birthday-banner-title">📅 Upcoming Birthdays</h2>
    <div id="upcomingBirthdayList" class="birthday-users-list flex-wrap"></div>
  </div>
</section>










<section id="clipsSection" class="hidden flex flex-col space-y-4">
  <h2 class="text-2xl font-bold text- mt-4"><p align ="left">𝒞𝓁𝒾𝓅𝓈 𝒻𝑜𝓇 𝒴𝑜𝓊</h2></p>
  <div id="clipsDisplay" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 p-4">
    <!-- Video clips will be cloned here -->
  </div>
</section>


<!-- 🔔 New Post Notification -->
<div id="newPostAlert" class="hidden fixed top-[4rem] left-1/2 transform -translate-x-1/2 bg-[#FF7D1E] text-white px-4 py-2 rounded-full shadow-lg flex items-center space-x-2 z-50 cursor-pointer">
  <div id="newPostAvatars" class="flex -space-x-2"></div>
  <span id="newPostText"><strong>posted</strong> <i class="fas fa-arrow-up"></i></span>
</div>


      <section id="feed" class="flex flex-col mt-0"></section>



<div id="infiniteScrollLoader" class="flex justify-center items-center py-6">
  <div class="animate-spin rounded-full h-8 w-8 border-4" style="border-color: #FF7D1E; border-top-color: transparent;"></div>
</div>




    </section>

    <aside id="rightSidebar" class="hidden lg:flex flex-col w-80 space-y-6 text-gray-700 text-sm" aria-label="Right Sidebar">


<div class="relative w-full max-w-md">
  <!-- Search Icon (left) -->
  <svg class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M16.65 16.65A7.5 7.5 0 1116.65 2a7.5 7.5 0 010 15z" />
  </svg>

  <!-- Search Input -->
  <input
    id="searchInput"
    type="search"
    placeholder="Discover on Clidder"
    class="w-full pl-10 pr-8 py-2 rounded-md 
           bg-white dark:bg-gray-900 
           text-sm text-black dark:text-white 
           placeholder-gray-500 dark:placeholder-gray-400 
           border border-gray-300 dark:border-gray-700 
           focus:outline-none 
           focus:border-[#FF7D1E] focus:ring-1 focus:ring-[#FF7D1E] 
           transition"
  />

  <!-- Slash key hint -->
  <span class="absolute right-2 top-1/2 -translate-y-1/2 
               text-xs text-gray-500 dark:text-gray-400 
               bg-white dark:bg-gray-800 
               px-1 rounded-sm font-mono 
               pointer-events-none select-none leading-tight">
    /
  </span>
</div>



<div class="rounded-[10px] border border-white/30 backdrop-blur-md shadow p-6 flex flex-col items-center space-y-4 text-orange-500 text-center
            bg-white dark:bg-black">
  <h2 class="text-2xl font-bold">Clidder</h2>

  <img src="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png" width="100" alt="Security Shield Icon" class="mx-auto" />

  <p class="text-orange-400 text-lg font-medium">from Jayasinghe Brothers</p>
</div>



<div id="userFlagBox" class="bg-white dark:bg-black rounded-[10px] border border-gray-200 dark:border-gray-700 p-4 mt-4 shadow text-sm text-gray-800 dark:text-white">
  <div class="flex items-center gap-3 mb-2">
    <div id="userFlag" class="text-3xl">🌍</div>
    <div>
      <div class="font-semibold text-base" id="userLocationText">Detecting...</div>
      <div class="text-xs text-gray-500 dark:text-gray-400">You are connected to Black Hat server</div>
    </div>
  </div>
  <div class="mt-2 text-xs space-y-1 text-gray-600 dark:text-gray-300">
    <div> <strong>City:</strong> <span id="userCity">--</span></div>
    <div> <strong>IP:</strong> <span id="userIP">--</span></div>
  </div>
</div>


<div id="networkSpeed" class="text-center text-2xl font-bold p-4 mt-4 bg-black text-lime-400 rounded-lg shadow-md"
     style="font-family: 'Orbitron', monospace; text-shadow: 0 0 10px #00ff00;">
  🚀 Testing speed...
</div>



<!-- 🌦 Enhanced Weather Widget -->
<div id="weatherBox" class="text-white p-4 rounded-[10px] shadow border text-sm space-y-4">

  
  <div class="flex justify-between items-center">
    <h2 id="weatherTitle" class="text-xl font-bold">Weather Nearby</h2>
    <span id="weatherTimeLabel" class="text-xs text-white/80">Loading...</span>
  </div>

  <!-- Current Conditions -->
  <div class="flex items-center gap-4">
    <div id="weatherIcon" class="text-4xl">☁️</div>
    <div>
      <div id="weatherCondition" class="font-semibold text-lg">Loading...</div>
      <div id="weatherTemp" class="text-sm">--°C</div>
    </div>
  </div>

  <!-- Extra Metrics -->
  <div class="grid grid-cols-2 gap-2 text-xs text-white/90">
    <div>🌡 Feels like: <span id="weatherFeels">--</span>°C</div>
    <div>💧 Humidity: <span id="weatherHumidity">--</span>%</div>
    <div>🌬 Wind: <span id="weatherWind">--</span> km/h</div>
    <div>🌫 Visibility: <span id="weatherVisibility">--</span> km</div>
    <div>🌧 Rain Chance: <span id="weatherRainChance">--</span>%</div>
    <div>🌅 Sunrise: <span id="sunriseTime">--</span></div>
    <div>🌇 Sunset: <span id="sunsetTime">--</span></div>
  </div>

  <!-- 3-Day Forecast -->
  <div>
    <h3 class="text-sm font-semibold mb-1 mt-2">📆 3-Day Forecast</h3>
    <div id="forecastGrid" class="grid grid-cols-3 gap-2 text-xs"></div>
  </div>
</div>




<!-- 🌄 Sun Progress Box -->
<div class="bg-gradient-to-b from-indigo-900 to-slate-900 p-4 rounded-[10px] border border-white/10 shadow text-white text-sm relative">
  <h2 class="text-base font-semibold mb-2">Sun</h2>
  <div class="relative h-24 mb-3">
    <svg id="sunArc" width="100%" height="100%" viewBox="0 0 200 100" preserveAspectRatio="none">
      <path d="M10,90 Q100,10 190,90" stroke="#999" stroke-width="2" fill="none"/>
      <circle id="sunMarker" r="6" fill="#FFD700" stroke="#fff" stroke-width="2" />
    </svg>
    <div id="sunDuration" class="absolute bottom-0 left-1/2 -translate-x-1/2 text-xs text-white/80 mt-1"></div>
  </div>
  <div class="flex justify-between text-xs font-semibold">
    <div><span id="sunriseTimeDisplay">--:--</span><br><span class="text-[10px] text-white/60">Sunrise</span></div>
    <div class="text-center">
      <span class="text-[10px] text-white/60">Daylight</span><br>
      <span id="daylightDuration">-- hrs</span>
    </div>
    <div class="text-right"><span id="sunsetTimeDisplay">--:--</span><br><span class="text-[10px] text-white/60">Sunset</span></div>
  </div>
</div>


<!-- 🌕 Moon & Humidity Tracker -->
<div class="bg-gradient-to-b from-slate-900 to-zinc-900 p-4 rounded-[10px] border border-white/10 shadow text-white text-sm relative mt-4 space-y-4">

  <!-- Moon Phase -->
  <div>
    <h2 class="text-base font-semibold mb-2">Moon</h2>
    <div class="flex items-center gap-3">
      <div id="moonIcon" class="text-3xl">🌑</div>
      <div>
        <div id="moonPhase" class="font-semibold text-white/90">--</div>
        <div class="text-xs text-white/60" id="moonDate">Today</div>
      </div>
    </div>
  </div>

  <!-- Humidity Arc -->
  <div>
    <h2 class="text-base font-semibold mb-2">Humidity</h2>
    <div class="relative h-24">
      <svg id="humidityArc" width="100%" height="100%" viewBox="0 0 200 100" preserveAspectRatio="none">
        <path d="M10,90 Q100,10 190,90" stroke="#555" stroke-width="2" fill="none"/>
        <circle id="humidityMarker" r="6" fill="#38bdf8" stroke="#fff" stroke-width="2" />
      </svg>
      <div id="humidityPercent" class="absolute bottom-0 left-1/2 -translate-x-1/2 text-xs text-white/80 mt-1">--%</div>
    </div>
  </div>
</div>



<div id="breakingNewsBox"
     class="bg-white dark:bg-zinc-900 border border-gray-200 dark:border-gray-700 rounded-xl shadow-md p-4 mb-4 transition-all">
  <h2 class="text-lg font-bold mb-3 text-[#FF7D1E]">🚨 What's going on ?</h2>

  <ul id="breakingNewsList" class="space-y-3">
    <li class="text-gray-500 dark:text-gray-400">Loading breaking news...</li>
  </ul>
</div>





<div id="relatedPeopleBox" class="bg-white dark:bg-black rounded-[10px] border border-gray-200 dark:border-gray-700 p-4">
  <h2 class="text-xl font-bold mb-4">Who  to Follow</h2>
  <div id="relatedLoadingSpinner" class="flex justify-center items-center py-6">
    <div class="animate-spin rounded-full h-8 w-8 border-4 border-orange-500 border-t-transparent"></div>
  </div>
  <ul id="relatedPeopleList" class="space-y-4 hidden"></ul>
</div>




<div class="bg-white rounded-[10px] border border-gray-200 p-4 flex flex-col items-center space-y-4">

        <h2 class="text-xl font-bold mb-2">Subscribe to Premium</h2>
        <p class="text-gray-600 text-center">Get exclusive access to premium content and features by subscribing to our premium plan.</p>
        <a href="https://blackhatai.nicepage.io" target="_blank" rel="noopener noreferrer" class="mt-4 bg-orange-500 text-white font-semibold rounded-full px-6 py-3 hover:bg-orange-600 transition text-center w-full">Subscribe to Premium</a>
      </div>

<div class="bg-white rounded-[10px] border border-gray-200 p-4">
        <h2 class="text-xl font-bold mb-4">Trends for you</h2>
        <ul id="trendsList" class="space-y-3"></ul>
      </div>


<div class="bg-white rounded-[10px] border border-gray-200 p-4 flex flex-col items-center space-y-4">
        <h2 class="text-xl font-bold mb-2">Account Center</h2>
        <p class="text-gray-600 text-center">Recover Your Account from Black Hat Account Center</p>
        <a href="https://blackhataccountcenter.netlify.app/" target="_blank" rel="noopener noreferrer" class="mt-4 bg-orange-500 text-white font-semibold rounded-full px-6 py-3 hover:bg-orange-600 transition text-center w-full">Recover Now</a>
      </div>

<div class="bg-white rounded-[10px] border border-gray-200 p-4">
        <h2 class="text-xl font-bold mb-4">Friends for You</h2>
        <ul id="whoToFollowList" class="space-y-4"></ul>
      </div>

<div class="bg-white rounded-[10px] border border-gray-200 p-4 flex flex-col items-center space-y-4">
        <h2 class="text-xl font-bold mb-2">Verify My Account</h2>
        <p class="text-gray-600 text-center">Verify Your Clidder Account to Get More features</p>
        <a href="https://blackhatsupport.wordpress.com/" target="_blank" rel="noopener noreferrer" class="mt-4 bg-orange-500 text-white font-semibold rounded-full px-6 py-3 hover:bg-orange-600 transition text-center w-full">Verify My Account</a>
      </div>

      
      
<div class="bg-white rounded-[10px] border border-gray-200 p-4 flex flex-col items-center space-y-4">
        <h2 class="text-xl font-bold mb-2">Follow Us on Web</h2>
        <p class="text-gray-600 text-center">Follow our official Website !</p>
        <a href="https://blackhatai.nicepage.io" target="_blank" rel="noopener noreferrer" class="mt-4 bg-orange-500 text-white font-semibold rounded-full px-6 py-3 hover:bg-orange-600 transition text-center w-full">Follow</a>
      </div>


<div class="text-xs text-gray-500 mt-6 space-y-1 text-center leading-relaxed">
  <div class="space-x-2">
    <a href="terms.html" class="hover:underline">Terms of Service</a> |
    <a href="privacy.html" class="hover:underline">Privacy Policy</a> |
    <a href="cookies.html" class="hover:underline">Cookie Policy</a> |
    <a href="accessibility.html" class="hover:underline">Accessibility</a> |
    <a href="ads-info.html" class="hover:underline">Ads info</a> |
    <a href="#" class="hover:underline">More</a>
  </div>
  <div>© 2025 Clidder Corp.</div>
</div>



    </aside>
  </main>

  <div aria-labelledby="modalTitle" aria-modal="true" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" id="modalAddPost" role="dialog">
    <div class="bg-white shadow-lg max-w-md w-full p-6 relative" style="">
      <h2 class="text-xl font-semibold mb-4 text-center" id="modalTitle">Add New Hat Post</h2>
      <form class="flex flex-col space-y-4" id="formAddPost">
        <label class="flex flex-col text-gray-700 font-medium">
  Media URL
  <div class="flex items-center gap-2 mt-1">
    <input id="postImageUrl" placeholder="Paste Your Media URL" required type="url"
           class="flex-1 p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]">
    <button type="button" onclick="pasteMediaUrl()" title="Paste from clipboard"
            class="px-3 py-2 bg-[#FF7D1E] text-white rounded hover:bg-[#e6680f]">
      📋
    </button>
  </div>
</label>

        <label class="flex flex-col text-gray-700 font-medium">
          Caption
          <textarea id="postCaption" placeholder="What’s going on ? " rows="3" class="mt-1 p-2 border border-gray-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]"></textarea>
        </label>
        <button type="submit" class="bg-[#e6680f] text-white py-2 rounded font-semibold hover:bg-[#cc5900] transition">Clide Post</button>
      </form>
      <button aria-label="Close modal" id="btnCloseModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 focus:outline-none">
        <i class="fas fa-times fa-lg"></i>
      </button>
    </div>
  </div>









  <div aria-modal="true" id="mobileMenu" role="dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-end p-4 hidden z-50">
    <div class="bg-white shadow-lg w-64 p-6 relative">
      <button aria-label="Close menu" id="btnCloseMenu" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 focus:outline-none">
        <i class="fas fa-times fa-lg"></i>
      </button>
      <nav class="flex flex-col space-y-4 text-gray-700 text-lg">
        <button id="mobileBtnHome" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
          <i class="fas fa-home fa-lg"></i>
          <span>Home</span>
        </button>
        <button id="mobileBtnAddPost" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
          <i class="fas fa-plus-square fa-lg"></i>
          <span>Add Hat</span>
        </button>
        <button id="mobileBtnProfile" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
          <i class="fas fa-user-circle fa-lg"></i>
          <span>Profile</span>
        </button>
        <button id="mobileBtnFavorites" class="flex items-center space-x-3 hover:text-[#FF7D1E] focus:outline-none focus:text-[#FF7D1E]">
          <i class="fas fa-star fa-lg"></i>
          <span>Favorites</span>
        </button>
      </nav>
    </div>
  </div>

  <div id="contextMenu" role="menu" aria-hidden="true" style="display: none;">
    <button id="contextFavorite" type="button" role="menuitem" tabindex="-1" class="flex items-center px-4 py-2 hover:bg-gray-100">
      <i class="fas fa-star mr-2"></i>Favorite
    </button>
    <button id="contextSave" type="button" role="menuitem" tabindex="-1" class="flex items-center px-4 py-2 hover:bg-gray-100">
      <i class="fas fa-bookmark mr-2"></i>Save
    </button>
    <button id="contextDelete" type="button" role="menuitem" tabindex="-1" class="flex items-center px-4 py-2 hover:bg-red-100 text-red-600">
      <i class="fas fa-trash-alt mr-2"></i>Delete
    </button>
  </div>









<!-- Fullscreen Twitter-style Clidder Auth Modal -->
<div id="modalAuth" aria-modal="true" role="dialog"
     class="fixed inset-0 bg-black flex flex-col justify-between z-50 overflow-auto text-white font-sans">

  <!-- Main Content -->
  <div class="flex flex-col md:flex-row w-full h-full overflow-y-auto">

<!-- Left panel -->
<div class="hidden md:flex flex-col items-center justify-center w-1/2 bg-black text-center px-4 space-y-8">
  <h1 class="text-5xl font-extrabold leading-tight text-orange-500">It's what's going</h1>
  <img src="https://i.ibb.co/HDNMpNL5/clidder-new-icon.png" alt="Clidder Logo" class="w-52 h-52" />
</div>


    <!-- Right panel -->
    <div class="flex flex-col justify-center items-center w-full md:w-1/2 px-6 sm:px-10 py-10 relative">

      <div id="authForms" class="w-full max-w-md space-y-8">

        <!-- 🔐 Sign In Form -->
        <div id="signInForm" class="flex flex-col space-y-5">
          <h2 class="text-3xl font-bold text-center">join today.</h2>

          <input id="signInUserInput" type="text" placeholder="Username or Email" maxlength="100" class="twitter-input" />
          <input id="signInPassword" type="password" placeholder="Password" maxlength="100" class="twitter-input" />

          <div class="flex justify-end">
            <a href="https://blackhatai.nicepage.io/" target="_blank" class="text-blue-400 text-sm hover:underline">
              Forgot password?
            </a>
          </div>

          <button id="btnSignIn"
                  class="w-full bg-[#e6680f] hover:bg-[#cc5900] text-white py-3 rounded-full font-semibold transition">
            Sign In
          </button>

          <p class="text-center text-sm text-gray-400">
            Don’t have an account?
            <button id="showSignUp" class="text-[#FF7D1E] hover:underline font-semibold">Create one</button>
          </p>
        </div>

        <!-- 🆕 Sign Up Form -->
        <div id="signUpForm" class="hidden flex flex-col space-y-5">
          <h2 class="text-3xl font-bold text-center">Create your Clidder Account</h2>

          <input id="signUpFullName" type="text" placeholder="Full Name" maxlength="100" class="twitter-input" />
          <input id="signUpEmail" type="text" placeholder="Email or Phone (e.g. +94712345678)" maxlength="100" class="twitter-input" />
          <input id="signUpUserName" type="text" placeholder="Username Without @" maxlength="50" class="twitter-input" />
          <input id="signUpPassword" type="password" placeholder="Password" maxlength="100" class="twitter-input" />
          <input id="signUpPasswordConfirm" type="password" placeholder="Confirm Password" maxlength="100" class="twitter-input" />
          <textarea id="signUpBio" placeholder="Bio" rows="3" maxlength="280" class="twitter-input resize-none"></textarea>
          <input id="signUpBirthday" type="date" class="twitter-input" />
          <select id="signUpGender" class="twitter-input">
            <option value="" disabled selected>Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Non-binary">Non-binary</option>
            <option value="Other">Other</option>
            <option value="Prefer not to say">Prefer not to say</option>
          </select>
          <input id="signUpAddress" type="text" placeholder="Address" maxlength="200" class="twitter-input" />
          <input id="signUpCountry" type="text" placeholder="Country" maxlength="100" class="twitter-input" />
          <input id="signUpProfilePic" type="url" placeholder="Profile Picture URL" maxlength="300" class="twitter-input" />
          <input id="signUpCoverPic" type="url" placeholder="Cover Picture URL" maxlength="300" class="twitter-input" />

          <button id="btnSignUp"
                  class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-full font-semibold transition">
            Create Account
          </button>

          <p class="text-center text-sm text-gray-400">
            Already have an account?
            <button id="showSignIn" class="text-[#FF7D1E] hover:underline font-semibold">Sign in</button>
          </p>
        </div>
      </div>

      <!-- Close Button -->
      <button aria-label="Close modal" id="btnCloseAuthModal"
              class="absolute top-4 right-4 text-gray-500 hover:text-white focus:outline-none">
        <i class="fas fa-times fa-lg"></i>
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="text-xs text-gray-500 px-4 py-6 text-center space-y-2 font-normal">
    <div class="flex flex-wrap justify-center gap-2 sm:gap-4">
      <a href="about.html" class="hover:underline">About</a> |
      <a href="#" class="hover:underline">Download the Clidder app</a> |
      <a href="#" class="hover:underline">Clibra</a> |
      <a href="#" class="hover:underline">Help Centre</a> |
      <a href="terms.html" class="hover:underline">Terms of Service</a> |
      <a href="privacy.html" class="hover:underline">Privacy Policy</a> |
      <a href="cookies.html" class="hover:underline">Cookie Policy</a> |
      <a href="accessibility.html" class="hover:underline">Accessibility</a> |
      <a href="ads-info.html" class="hover:underline">Ads info</a> |
      <a href="blog.html" class="hover:underline">Blog</a> |
      <a href="careers.html" class="hover:underline">Careers</a> |
      <a href="brand.html" class="hover:underline">Brand Resources</a> |
      <a href="advertise.html" class="hover:underline">Advertising</a> |
      <a href="marketing.html" class="hover:underline">Marketing</a> |
      <a href="business.html" class="hover:underline">Clidder for Business</a> |
      <a href="developers.html" class="hover:underline">Developers</a> |
      <a href="#" class="hover:underline">Directory</a> |
      <a href="#" class="hover:underline">Settings</a>
    </div>
    <p class="mt-2">&copy; 2025 Clidder Corp.</p>
  </footer>
</div>

<!-- Font + Input Styles -->
<style>
  body, .font-sans {
    font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  .twitter-input {
    width: 100%;
    background-color: #16181c;
    color: white;
    border: 1px solid #2f3336;
    border-radius: 6px;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .twitter-input::placeholder {
    color: #8899a6;
  }

  .twitter-input:focus {
    outline: none;
    border-color: #1d9bf0;
    box-shadow: 0 0 0 1px #1d9bf0;
  }

  footer a {
    text-decoration: none;
  }
</style>

<!-- Toggle Script -->
<script>
  const showSignUpBtn = document.getElementById('showSignUp');
  const showSignInBtn = document.getElementById('showSignIn');
  const signInForm = document.getElementById('signInForm');
  const signUpForm = document.getElementById('signUpForm');
  const closeBtn = document.getElementById('btnCloseAuthModal');
  const modal = document.getElementById('modalAuth');

  showSignUpBtn?.addEventListener('click', () => {
    signInForm.classList.add('hidden');
    signUpForm.classList.remove('hidden');
  });

  showSignInBtn?.addEventListener('click', () => {
    signUpForm.classList.add('hidden');
    signInForm.classList.remove('hidden');
  });

  closeBtn?.addEventListener('click', () => {
    modal.classList.add('hidden');
  });
</script>











  <div id="modalProfile" aria-modal="true" role="dialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden overflow-auto">
    <div class="bg-white shadow-lg max-w-lg w-full p-6 relative max-h-[90vh] overflow-y-auto">
      <button aria-label="Close profile modal" id="btnCloseProfileModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 focus:outline-none z-10">
        <i class="fas fa-times fa-lg"></i>
      </button>
      <div id="profileContent" class="space-y-4"></div>
    </div>
  </div>

  <!-- Clidders Modal -->
  <div id="modalClidders" role="dialog" aria-modal="true" aria-labelledby="modalCliddersTitle" tabindex="-1">
    <div id="modalCliddersContent" class="relative">
      <button id="modalCliddersCloseBtn" aria-label="Close Clidders modal">&times;</button>
      <h2 id="modalCliddersTitle">Clidders</h2>
      <ul id="cliddersList"></ul>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      onSnapshot,
      serverTimestamp,
      deleteDoc,
      doc,
      updateDoc,
      arrayUnion,
      arrayRemove,
      getDocs,
      where,
      query as firestoreQuery,
    } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDrFdwYhlj84GQ3eLzPctLgxZ572PHu7Tg",
      authDomain: "x-clone-d4697.firebaseapp.com",
      projectId: "x-clone-d4697",
      storageBucket: "x-clone-d4697.appspot.com",
      messagingSenderId: "438425139174",
      appId: "1:438425139174:web:b1ebea6f124a245cf9c827",
      measurementId: "G-PLQBYNDKQM",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

async function loadAllPosts() {
  const feed = document.getElementById("feed");
  feed.innerHTML = ""; // Clear old posts

  const postsRef = collection(db, "posts");
  const q = query(postsRef, orderBy("createdAt", "desc"));
  const querySnapshot = await getDocs(q);

  querySnapshot.forEach((doc) => {
    const post = doc.data();
    post.id = doc.id; // add ID if your renderer needs it
    const postEl = renderPost(post);
    feed.appendChild(postEl);
  });
}


document.getElementById("tabForYou").addEventListener("click", () => {
  loadAllPosts();

  // Update tab styling
  document.getElementById("tabForYou").classList.add("border-blue-500", "text-[#FF7D1E]");
  document.getElementById("tabFollowing").classList.remove("border-blue-500", "text-[#FF7D1E]");
});



let latestPostTime = null;
let newPostUsers = new Map();

onSnapshot(query(collection(db, "posts"), orderBy("createdAt", "desc")), (snapshot) => {
  if (!snapshot.empty) {
    const newest = snapshot.docs[0].data();

    // Ignore on first load
    if (!latestPostTime) {
      latestPostTime = newest.createdAt?.toMillis();
      return;
    }

    // Track new posts after the last known time
    snapshot.docs.forEach(doc => {
      const post = doc.data();
      const time = post.createdAt?.toMillis();

      if (time > latestPostTime && post.profilePic && post.userId) {
        newPostUsers.set(post.userId, post.profilePic);
      }
    });

    if (newPostUsers.size > 0) {
      // Update avatar list
      const avatarContainer = document.getElementById("newPostAvatars");
      avatarContainer.innerHTML = "";

      newPostUsers.forEach(pic => {
        const img = document.createElement("img");
        img.src = pic;
        img.className = "w-6 h-6 rounded-full border-2 border-white";
        avatarContainer.appendChild(img);
      });

      // Update text like "3 people posted ↑"
      const textSpan = document.getElementById("newPostText");
      const count = newPostUsers.size;
      textSpan.innerHTML = `<strong>${count} posted</strong> <i class="fas fa-arrow-up"></i>`;

      // Show banner
      document.getElementById("newPostAlert").classList.remove("hidden");

      // Click to refresh
     document.getElementById("newPostAlert").onclick = () => {
  const centerContent = document.getElementById("centerContent");
  if (centerContent) {
    centerContent.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  }

  newPostUsers.clear();
  document.getElementById("newPostAlert").classList.add("hidden");
};

    }

    // Always update latest known time
    latestPostTime = newest.createdAt?.toMillis();
  }
});



document.getElementById("tabFollowing").addEventListener("click", async () => {
  const feed = document.getElementById("feed");
  feed.innerHTML = "";

  const postsRef = collection(db, "posts");
  const q = query(postsRef, orderBy("createdAt", "desc"));
  const querySnapshot = await getDocs(q);

  querySnapshot.forEach((doc) => {
    const post = doc.data();
    if (post.verified) {
      const postEl = renderPost(post);
      feed.appendChild(postEl);
    }
  });

  // Update tab styling
  document.getElementById("tabForYou").classList.remove("border-blue-500", "text-[#FF7D1E]");
  document.getElementById("tabFollowing").classList.add("border-blue-500", "text-[#FF7D1E]");
});



if ("Notification" in window && Notification.permission === "default") {
  Notification.requestPermission().then(permission => {
    console.log("🛑 Notification permission:", permission);
  });
}

async function checkTodaysBirthdays() {
  const usersRef = collection(db, "users");
  const snapshot = await getDocs(usersRef);

  const today = new Date().toISOString().slice(5, 10); // "MM-DD"
  const birthdayUsers = [];

  snapshot.forEach(doc => {
    const user = doc.data();
    if (user.birthday && user.birthday.slice(5) === today) {
      birthdayUsers.push(user);
    }
  });

 if (birthdayUsers.length > 0) {
const bannerContainer = document.getElementById("birthdayBanner");
const usersListEl = document.getElementById("birthdayBannerUsers");
usersListEl.innerHTML = ""; // Clear previous

birthdayUsers.forEach(user => {
  const card = document.createElement("div");
  card.className = "birthday-user-card";
  card.innerHTML = `
    <img src="${user.profilePic || 'https://i.ibb.co/0VqN92C4/clidder-off-dark.png'}" alt="${user.fullName}" />
    <span class="inline-flex items-center">
    ${user.fullName}
    ${getPremiumHTML(user.premium)}
    ${getVerifiedHTML(user.verified)}
    ${getProHTML(user.pro)}
    ${getCompanyHTML(user.company)}
    ${getAIHTML(user.AI)}
    ${getClidderHTML(user.Clidder)}
  </span>
  `;
  usersListEl.appendChild(card);
});

bannerContainer.style.display = "flex";

  birthdayUsers.forEach(user => {
    addBirthdayNotification(user);
  });


    // Show red badge
    notificationBadge.style.display = "flex";
    notificationBadge.innerText = birthdayUsers.length;
    notificationBadgeLeft.style.display = "flex";
    notificationBadgeLeft.innerText = birthdayUsers.length;
  }
}

function addBirthdayNotification(user) {
  const li = document.createElement("li");
  li.innerHTML = `
    <img src="${user.profilePic || 'https://i.ibb.co/0VqN92C4/clidder-off-dark.png'}" alt="${user.fullName}">
    <div class="notification-content">
      <div class="notification-user">${user.fullName}</div>
      <div class="notification-caption">🎂 It's their birthday today! Send your wishes 🎉</div>
      <div class="notification-time">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
    </div>
  `;
  notificationsList.appendChild(li);
}


function showNewPostNotification(postCaption) {
  console.log("🔔 Trying to show notification:", postCaption);
  if (Notification.permission === "granted") {
    new Notification("Clidder by Jayasinghe", {
      body: postCaption || "Someone just posted!",
      icon: "https://i.ibb.co/0VqN92C4/clidder-off-dark.png",
    });
  } else {
    console.log("Notification permission not granted");
  }
}

const postsRefForNotify = collection(db, "posts");
const postsQueryForNotify = query(postsRefForNotify, orderBy("createdAt", "desc"));

onSnapshot(postsQueryForNotify, (snapshot) => {
  snapshot.docChanges().forEach((change) => {
    if (change.type === "added") {
      const newPost = change.doc.data();
      console.log("📥 New post detected:", newPost.caption);
      showNewPostNotification(newPost.caption);


const sidebarNotifBadgeLeft = document.getElementById("notificationBadgeLeft");
const notifDisplaySection = document.getElementById("newPostNotificationsDisplay");
const notifList = document.getElementById("newPostNotificationsList");
const feedSection = document.getElementById("feed");

let newPostNotifications = [];

// Detect new posts
onSnapshot(postsQueryForNotify, (snapshot) => {
  snapshot.docChanges().forEach((change) => {
    if (change.type === "added") {
      const post = change.doc.data();
      showNewPostNotification(post.caption);

      // Add to memory list
      newPostNotifications.unshift(post);

      // Show badge count
      sidebarNotifBadgeLeft.style.display = "inline-block";
      sidebarNotifBadgeLeft.innerText = newPostNotifications.length;
    }
  });
});

// When user clicks Notifications on left sidebar
document.getElementById("sidebarNotificationsLeft").addEventListener("click", () => {
  notifList.innerHTML = "";

  if (newPostNotifications.length === 0) {
    notifList.innerHTML = `<li class="text-gray-500">No new posts yet.</li>`;
  } else {
    newPostNotifications.forEach(post => {
      const li = document.createElement("li");
      li.className = "bg-white dark:bg-gray-800 p-4 rounded shadow";
      li.innerHTML = `
        <div class="font-semibold text-[#FF7D1E] dark:text-blue-300">${post.fullName || "Someone"}</div>
        <div class="text-sm text-gray-700 dark:text-gray-300">${post.caption}</div>
      `;
      notifList.appendChild(li);
    });
  }

  // Show notification list, hide feed
  notifDisplaySection.classList.remove("hidden");
  feedSection.classList.add("hidden");
});

// When user clicks Home on left sidebar
document.getElementById("sidebarHome").addEventListener("click", () => {
  notifDisplaySection.classList.add("hidden");
  feedSection.classList.remove("hidden");

  // Optionally reset notifications
  sidebarNotifBadgeLeft.innerText = "";
  sidebarNotifBadgeLeft.style.display = "none";
  newPostNotifications = [];
});

    }
  });
});

    // Elements
    const feedEl = document.getElementById("feed");
    const modalAddPost = document.getElementById("modalAddPost");
    const btnAddPost = document.getElementById("btnAddPost");
    const btnCloseModal = document.getElementById("btnCloseModal");
    const formAddPost = document.getElementById("formAddPost");
    const postImageUrlInput = document.getElementById("postImageUrl");
    const postCaptionInput = document.getElementById("postCaption");
    const btnMenu = document.getElementById("btnMenu");
    const mobileMenu = document.getElementById("mobileMenu");
    const btnCloseMenu = document.getElementById("btnCloseMenu");
    const btnProfileLeft = document.getElementById("sidebarProfile");
    const btnProfileTop = document.getElementById("btnProfileTop");
    const btnFavorites = document.getElementById("btnFavorites");
    const searchInput = document.getElementById("searchInput");
    const contextMenu = document.getElementById("contextMenu");
    const contextFavorite = document.getElementById("contextFavorite");
    const contextSave = document.getElementById("contextSave");
    const contextDelete = document.getElementById("contextDelete");
    const btnTweet = document.getElementById("btnTweet");
    const tweetInput = document.getElementById("tweetInput");
// Auto-expand the textarea as you type
tweetInput.addEventListener("input", () => {
  tweetInput.style.height = "auto"; // reset
  tweetInput.style.height = tweetInput.scrollHeight + "px"; // grow
});


// ⋮⋮⋮ More-options dropdown toggle
const btnMoreOptions     = document.getElementById("btnMoreOptions");
const moreOptionsDropdown = document.getElementById("moreOptionsDropdown");

btnMoreOptions.addEventListener("click", (e) => {
  e.stopPropagation();
  moreOptionsDropdown.style.display = 
    moreOptionsDropdown.style.display === "block" ? "none" : "block";
});

// Close when clicking elsewhere
document.addEventListener("click", () => {
  moreOptionsDropdown.style.display = "none";
});

// — Facilities for each menu item —
// 1) Account → open profile modal (or redirect)
document.getElementById("moreAccount")
  .addEventListener("click", () => {
    moreOptionsDropdown.style.display = "none";
    if (!currentUser) {
      showAuthModal();
    } else {
      showProfileModal();
    }
  });

// 2) Pages → open center modal
document.getElementById("morePages")
  .addEventListener("click", () => {
    moreOptionsDropdown.style.display = "none";
    document.getElementById("pagesModal").classList.remove("hidden");
  });

// 3) Settings → open center modal
document.getElementById("moreSettings")
  .addEventListener("click", () => {
    moreOptionsDropdown.style.display = "none";
    document.getElementById("settingsModal").classList.remove("hidden");
  });

// 4) Logout → clear session & refresh UI
document.getElementById("moreLogout")
  .addEventListener("click", () => {
    moreOptionsDropdown.style.display = "none";
clearCurrentUser();
alert("You have been logged out.");
location.reload(); // reloads the page

  });


    const btnSubmitTweet = document.getElementById("btnSubmitTweet");
    const modalAuth = document.getElementById("modalAuth");
    const btnCloseAuthModal = document.getElementById("btnCloseAuthModal");
    const signInForm = document.getElementById("signInForm");
    const signUpForm = document.getElementById("signUpForm");
    const showSignUpBtn = document.getElementById("showSignUp");
    const showSignInBtn = document.getElementById("showSignIn");
    const signInUserInput = document.getElementById("signInUserInput");
    const signInPassword = document.getElementById("signInPassword");
    const btnSignIn = document.getElementById("btnSignIn");
    const signUpFullName = document.getElementById("signUpFullName");
    const signUpEmail = document.getElementById("signUpEmail");
    const signUpUserName = document.getElementById("signUpUserName");
    const signUpPassword = document.getElementById("signUpPassword");
    const signUpPasswordConfirm = document.getElementById("signUpPasswordConfirm");
    const signUpBio = document.getElementById("signUpBio");
    const signUpBirthday = document.getElementById("signUpBirthday");
    const signUpGender = document.getElementById("signUpGender");
    const signUpAddress = document.getElementById("signUpAddress");
    const signUpCountry = document.getElementById("signUpCountry");
    const signUpProfilePic = document.getElementById("signUpProfilePic");
    const signUpCoverPic = document.getElementById("signUpCoverPic");
    const btnSignUp = document.getElementById("btnSignUp");
    const modalProfile = document.getElementById("modalProfile");
    const btnCloseProfileModal = document.getElementById("btnCloseProfileModal");
    const profileContent = document.getElementById("profileContent");
    const notificationsDropdown = document.getElementById("notificationsDropdown");
    const notificationsList = document.getElementById("notificationsList");
    const sidebarNotificationsBtn = document.getElementById("sidebarNotifications");
    const notificationBadge = document.getElementById("notificationBadge");
    const notificationBadgeLeft = document.getElementById("notificationBadgeLeft");
    const sidebarExploreBtn = document.getElementById("sidebarExplore");
    const sidebarFavoritesBtn = document.getElementById("sidebarFavorites");
    const sidebarFromMeBtn = document.getElementById("sidebarFromMe");
    const sidebarMoreBtn = document.getElementById("sidebarMore");

    const modalClidders = document.getElementById("modalClidders");
    const modalCliddersCloseBtn = document.getElementById("modalCliddersCloseBtn");
    const cliddersList = document.getElementById("cliddersList");

    let posts = [];
    let filteredPosts = [];
    let savedPosts = JSON.parse(localStorage.getItem("savedPosts") || "[]");
    let favoritePosts = new Set(
      JSON.parse(localStorage.getItem("favoritePosts") || "[]")
    );
    let currentContextPostId = null;
    let currentContextPostData = null;

    // Track read notifications in localStorage by post IDs
    let readNotifications = new Set(JSON.parse(localStorage.getItem("readNotifications") || "[]"));

    // User session management
    let currentUser = JSON.parse(localStorage.getItem("clidderUser") || "null");

    function setCurrentUser(user) {
      currentUser = user;
      localStorage.setItem("clidderUser", JSON.stringify(user));
      updateUIForUser();
    }

if (currentUser) {
  checkTodaysBirthdays();
}


    function clearCurrentUser() {
      currentUser = null;
      localStorage.removeItem("clidderUser");
      updateUIForUser();
    }

    function updateUIForUser() {
      if (currentUser) {
        tweetInput.disabled = false;
        btnSubmitTweet.disabled = tweetInput.value.trim().length === 0;
        btnAddPost.disabled = false;
        btnTweet.disabled = false;
      } else {
        tweetInput.disabled = true;
        btnSubmitTweet.disabled = true;
        btnAddPost.disabled = true;
        btnTweet.disabled = true;
      }
    }

const mobileProfilePic = document.getElementById("mobileProfilePicIcon");
const mobileProfileFallback = document.getElementById("mobileProfileIconFallback");

if (currentUser && currentUser.profilePic) {
  mobileProfilePic.src = currentUser.profilePic;
  mobileProfilePic.classList.remove("hidden");
  mobileProfileFallback.classList.add("hidden");
} else {
  mobileProfilePic.classList.add("hidden");
  mobileProfileFallback.classList.remove("hidden");
}

const sidebarSummary = document.getElementById("sidebarUserSummary");
const sidebarUserName = document.getElementById("sidebarUserName");
const sidebarUserHandle = document.getElementById("sidebarUserHandle");
const sidebarUserPic = document.getElementById("sidebarUserPic");

if (currentUser) {
  sidebarSummary.classList.remove("hidden");
  sidebarUserName.innerHTML = `
  <span class="inline-flex items-center">
    ${currentUser.fullName}
    ${getPremiumHTML(currentUser.premium)}
    ${getVerifiedHTML(currentUser.verified)}
    ${getProHTML(currentUser.pro)}
    ${getCompanyHTML(currentUser.company)}
    ${getAIHTML(currentUser.AI)}
    ${getClidderHTML(currentUser.Clidder)}

  </span>
`;

  sidebarUserHandle.textContent = "𝓬𝓹" + currentUser.username.toLowerCase();
  sidebarUserPic.src = currentUser.profilePic || "https://via.placeholder.com/40?text=U";
} else {
  sidebarSummary.classList.add("hidden");
}


    // Show auth modal
    function showAuthModal() {
      modalAuth.classList.remove("hidden");
      signInForm.classList.remove("hidden");
      signUpForm.classList.add("hidden");
      signInUserInput.value = "";
      signInPassword.value = "";
      signUpFullName.value = "";
      signUpEmail.value = "";
      signUpUserName.value = "";
      signUpPassword.value = "";
      signUpPasswordConfirm.value = "";
      signUpBio.value = "";
      signUpBirthday.value = "";
      signUpGender.value = "";
      signUpAddress.value = "";
      signUpCountry.value = "";
      signUpProfilePic.value = "";
      signUpCoverPic.value = "";
      signInUserInput.focus();
    }

    // Hide auth modal
    function hideAuthModal() {
      modalAuth.classList.add("hidden");
    }

    // Show profile modal
    function showProfileModal() {
      if (!currentUser) {
        alert("Please sign in to view your profile.");
        showAuthModal();
        return;
      }
      modalProfile.classList.remove("hidden");
      renderProfile();
    }

    // Hide profile modal
    function hideProfileModal() {
      modalProfile.classList.add("hidden");
      profileContent.innerHTML = "";
    }

    // Check if username or email exists in Firestore users collection
    async function getUserByUsernameOrEmail(identifier) {
      const usersRef = collection(db, "users");
      let q = firestoreQuery(usersRef, where("username", "==", identifier));
      let querySnapshot = await getDocs(q);
      if (!querySnapshot.empty) {
        return querySnapshot.docs[0];
      }
      q = firestoreQuery(usersRef, where("email", "==", identifier));
      querySnapshot = await getDocs(q);
      if (!querySnapshot.empty) {
        return querySnapshot.docs[0];
      }
      return null;
    }

    // Create new user in Firestore users collection
    async function createUser(userData) {
      const usersRef = collection(db, "users");
      await addDoc(usersRef, userData);
    }

    // Validate email format
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email.toLowerCase());
    }

    // Event listeners for auth modal
    showSignUpBtn.addEventListener("click", () => {
      signInForm.classList.add("hidden");
      signUpForm.classList.remove("hidden");
      signUpFullName.focus();
    });

    showSignInBtn.addEventListener("click", () => {
      signUpForm.classList.add("hidden");
      signInForm.classList.remove("hidden");
      signInUserInput.focus();
    });

    btnCloseAuthModal.addEventListener("click", () => {
      hideAuthModal();
    });

    btnCloseProfileModal.addEventListener("click", () => {
      hideProfileModal();
    });

    // Sign In handler
    btnSignIn.addEventListener("click", async () => {
      const identifier = signInUserInput.value.trim();
      const password = signInPassword.value;
      if (!identifier || !password) {
        alert("Please enter your username/email and password.");
        return;
      }
      try {
        const userDoc = await getUserByUsernameOrEmail(identifier);
        if (!userDoc) {
          alert("User not found.");
          return;
        }
        const userData = userDoc.data();
        if (userData.password !== password) {
          alert("Incorrect password.");
          return;
        }
       setCurrentUser({ id: userDoc.id, ...userData });
  hideAuthModal();
  alert(`Welcome back, ${userData.fullName}!`);
  location.reload(); // Reload page after login
} catch (error) {
  alert("Error signing in: " + error.message);
}
    });

    // Sign Up handler
    btnSignUp.addEventListener("click", async () => {
      const fullName = signUpFullName.value.trim();
    const email = signUpEmail.value.trim();

      const username = signUpUserName.value.trim();
const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;

if (!usernameRegex.test(username)) {
  alert("Username can only contain letters. No numbers, spaces, or symbols allowed.");
  return;
}

      const password = signUpPassword.value;
      const passwordConfirm = signUpPasswordConfirm.value;
      const bio = signUpBio.value.trim();
      const birthday = signUpBirthday.value;
      const gender = signUpGender.value;
      const address = signUpAddress.value.trim();
      const country = signUpCountry.value.trim();
      const profilePic = signUpProfilePic.value.trim();
      const coverPic = signUpCoverPic.value.trim();

      if (!fullName || !email || !username || !password || !passwordConfirm) {
        alert("Please fill in all required fields.");
        return;
      }
      function isValidEmailOrPhone(value) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const phoneRegex = /^\+\d{7,15}$/; // International format
  return emailRegex.test(value) || phoneRegex.test(value);
}

if (!isValidEmailOrPhone(email)) {
  alert("Please enter a valid email or international phone number (e.g. +94712345678).");
  return;
}

      if (password !== passwordConfirm) {
        alert("Passwords do not match.");
        return;
      }
      try {
        // Check if username or email already exists
        const usersRef = collection(db, "users");
        let q = firestoreQuery(usersRef, where("username", "==", username));
        let querySnapshot = await getDocs(q);
        if (!querySnapshot.empty) {
          alert("Username already exists. Please choose another.");
          return;
        }
        q = firestoreQuery(usersRef, where("email", "==", email));
        querySnapshot = await getDocs(q);
        if (!querySnapshot.empty) {
          alert("Email already registered. Please sign in.");
          return;
        }
        // Create user
        await createUser({
          fullName,
          email,
          username,
          password,
          bio,
          birthday,
          gender,
          address,
          country,
          profilePic,
          coverPic,
          createdAt: serverTimestamp(),
        });
        alert("Account created! Please sign in.");
        signUpForm.classList.add("hidden");
        signInForm.classList.remove("hidden");
        signInUserInput.value = username;
        signInPassword.value = "";
        signInUserInput.focus();
      } catch (error) {
        alert("Error creating account: " + error.message);
      }
    });

    // Override Profile buttons to show profile modal or auth modal
    btnProfileLeft.addEventListener("click", () => {
      if (!currentUser) {
        showAuthModal();
      } else {
        showProfileModal();
      }
    });
    btnProfileTop.addEventListener("click", () => {
      if (!currentUser) {
        showAuthModal();
      } else {
        showProfileModal();
      }
    });

    // Disable adding posts and tweeting if not signed in
    btnAddPost.addEventListener("click", () => {
      if (!currentUser) {
        alert("Please sign in or create an account to add posts.");
        showAuthModal();
        return;
      }
      modalAddPost.classList.remove("hidden");
      postImageUrlInput.focus();
      closeMobileMenu();
    });

    btnTweet.addEventListener("click", () => {
      if (!currentUser) {
        alert("Please sign in or create an account to post.");
        showAuthModal();
        return;
      }
      modalAddPost.classList.remove("hidden");
      postImageUrlInput.focus();
    });

    btnSubmitTweet.addEventListener("click", async () => {
      if (!currentUser) {
        alert("Please sign in or create an account to post.");
        showAuthModal();
        return;
      }
      const text = tweetInput.value.trim();
      if (!text) {
        alert("Please enter your tweet content.");
        return;
      }
      try {
        await addDoc(collection(db, "posts"), {
          imageUrl: "",
          caption: text,
          createdAt: serverTimestamp(),
          userId: currentUser.id,
          userName: currentUser.fullName,
verified: currentUser.verified || false,
premium: currentUser.premium || false,
pro: currentUser.pro || false,
company: currentUser.company || false,
 AI: currentUser.AI || false,
Clidder: currentUser.Clidder || false,


          userHandle: "𝓬𝓹" + currentUser.username.toLowerCase(),
          profilePic: currentUser.profilePic || "",
          likes: [],
          retweets: [],
          replies: [],
        });
        tweetInput.value = "";
        btnSubmitTweet.disabled = true;
      } catch (error) {
        alert("Error posting tweet: " + error.message);
      }
    });

    // Update tweet button state based on input and user
    function updateTweetButtonState() {
      btnSubmitTweet.disabled =
        tweetInput.value.trim().length === 0 || !currentUser;
    }
    tweetInput.addEventListener("input", updateTweetButtonState);

    // Initialize UI state on load
    updateUIForUser();

    // Helper function to format time difference
function timeAgo(date) {
  if (!date) return "";
  const now = new Date();
  const seconds = Math.floor((now - date) / 1000);

  if (seconds < 60) return `${seconds}s`; // less than a minute
  const minutes = Math.floor(seconds / 60);
  if (minutes < 60) return `${minutes}m`; // less than an hour
  const hours = Math.floor(minutes / 60);
  if (hours < 24) return `${hours}h`; // less than a day
  const days = Math.floor(hours / 24);
  
  const d = date instanceof Date ? date : new Date(date);
  const nowYear = now.getFullYear();
  const postYear = d.getFullYear();
  const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                  "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  const month = months[d.getMonth()];
  const day = d.getDate();

  if (nowYear === postYear) {
    return `${month} ${day}`; // same year: "Apr 9"
  } else {
    return `${month} ${day}, ${postYear}`; // different year: "Apr 9, 2023"
  }
}


    function renderPost(post, id) {
      const div = document.createElement("article");


// 🧠 Clidder AI Icon
const aiIcon = document.createElement("img");
aiIcon.src = "https://i.ibb.co/zVgvTJRF/clidder-ai.png";
aiIcon.alt = "Clidder AI";
aiIcon.title = "Clidder AI";
aiIcon.className = "absolute top-8 right-8 w-5 h-5 cursor-pointer hover:opacity-80 z-10";
aiIcon.onclick = () => toggleClidderAIModal();


// ⋮ Button
const menuButton = document.createElement("button");
menuButton.className = "post-options-btn absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl focus:outline-none";
menuButton.innerHTML = "...";

// Dropdown menu
const menu = document.createElement("div");
menu.className = "post-options-menu hidden absolute top-10 right-2 bg-white border border-gray-200 shadow-md rounded-md z-50 w-64 text-sm";
menu.innerHTML = `
  <ul class="divide-y divide-gray-100">
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Not interested in this post</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Follow @${post.userName}</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Add/remove @${post.userName} from Lists</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Mute @${post.userName}</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Block @${post.userName}</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">View post engagements</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Embed post</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Report post</button></li>
    <li><button class="w-full text-left px-4 py-2 hover:bg-gray-100">Request Community Note</button></li>
  </ul>
`;

// Add to the post div
div.appendChild(aiIcon); 
div.appendChild(menuButton);
div.appendChild(menu);


      div.className =
        "bg-white shadow-md p-6 flex flex-col space-y-3 cursor-pointer select-none relative";








// Post header container
const header = document.createElement("header");
header.className = "flex items-center gap-3"; // Tight spacing

// Avatar (left)
const avatar = document.createElement("img");
avatar.src = post.profilePic && post.profilePic.trim() !== ""
  ? post.profilePic
  : "https://placehold.co/40x40/png?text=" +
    (post.userName ? post.userName[0].toUpperCase() : "U") +
    "&font=roboto&font-weight=700&bg=ddd&fg=555";
avatar.alt = post.userName ? `${post.userName} avatar` : "User avatar placeholder";
avatar.className = "w-10 h-10 rounded-full object-cover";
header.appendChild(avatar);

// User info (right side)
const userInfo = document.createElement("div");
userInfo.className = "flex flex-col";

// Time
const timeSpan = document.createElement("span");
timeSpan.className = "text-gray-500 dark:text-gray-400 font-normal";
let createdAtDate = null;
if (post.createdAt && post.createdAt.toDate) {
  createdAtDate = post.createdAt.toDate();
} else if (post.createdAt instanceof Date) {
  createdAtDate = post.createdAt;
} else if (typeof post.createdAt === "string") {
  createdAtDate = new Date(post.createdAt);
}
timeSpan.textContent = "· " + timeAgo(createdAtDate);

// Name (with badges, clickable)
const nameText = document.createElement("span");
nameText.className = "font-semibold text-gray-900 dark:text-white inline-flex items-center gap-1 text-unique-user";
nameText.innerHTML = `
  ${post.userName || "HatUser"}
  ${getPremiumHTML(post.premium)}
  ${getVerifiedHTML(post.verified)}
  ${getProHTML(post.pro)}
  ${getCompanyHTML(post.company)}
  ${getAIHTML(post.AI)}
  ${getClidderHTML(post.Clidder)}
`;
nameText.addEventListener("click", () => openProfileCard(post));

// Handle (clickable)
const userHandle = document.createElement("span");
userHandle.className = "text-gray-500 dark:text-gray-400 font-normal cursor-pointer";
userHandle.textContent = post.userHandle.replace(/^@/, "");
userHandle.addEventListener("click", () => openProfileCard(post));

// Final one-line row: name + handle + time
const nameRow = document.createElement("div");
nameRow.className = "flex flex-wrap items-center gap-1 text-sm leading-tight";
nameRow.appendChild(nameText);
nameRow.appendChild(userHandle);
nameRow.appendChild(timeSpan);

// Assemble
userInfo.appendChild(nameRow);
header.appendChild(userInfo);
div.appendChild(header);

// Post content
const content = document.createElement("div");
content.className = "post-content text-gray-900 dark:text-white text-base whitespace-pre-wrap break-words";





  div.addEventListener("click", (e) => {
    if (!e.target.closest(".tweet-action-btn") && !e.target.closest("button")) {
      openPostPopup(post);
    }
  });




// Convert URLs in the caption into clickable links
const urlRegex = /(https?:\/\/[^\s]+)/g;
const hashtagRegex = /#(\w+)/g;

function escapeHTML(str) {
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

// Step 1: Escape HTML to prevent injection
let safeText = escapeHTML(post.caption || "");

// Step 2: Linkify URLs and hashtags
let linkedText = safeText
  .replace(urlRegex, (url) => {
    return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
  })
  .replace(hashtagRegex, (tag, word) => {
    return `<span class="hashtag text-purple-500 cursor-pointer hover:underline" data-tag="${word}">#${word}</span>`;
  });

// Step 3: Render safely
content.innerHTML = linkedText;
;

div.appendChild(content);

// Add "Read more" button if caption is long
if (post.caption && (post.caption.length > 300 || post.caption.split('\n').length > 5)) {
  const readMore = document.createElement("span");
  readMore.className = "read-more text-[#FF7D1E] hover:underline";
  readMore.textContent = "Read more";
  readMore.addEventListener("click", () => {
    content.classList.toggle("expanded");
    readMore.textContent = content.classList.contains("expanded")
      ? "Show less"
      : "Read more";
  });
  div.appendChild(readMore);
}



// Enable hashtag click to auto-fill search bar
content.querySelectorAll('.hashtag').forEach(tagEl => {
  tagEl.addEventListener('click', () => {
    const keyword = tagEl.getAttribute('data-tag');
    const searchInput = document.getElementById("searchInput");
    if (searchInput) {
      searchInput.value = `#${keyword}`;
      searchInput.focus();
    }
  });
});

div.appendChild(content);

content.querySelectorAll('.hashtag').forEach(tagEl => {
  tagEl.addEventListener('click', () => {
    const keyword = tagEl.getAttribute('data-tag');
    document.getElementById("searchInput").value = `#${keyword}`;
    document.getElementById("searchInput").focus();
    // Optional: trigger any search/filter function
    // triggerSearch(keyword); // if you have a function like this
  });
});


if (post.imageUrl && post.imageUrl.trim() !== "") {
  const url = post.imageUrl.trim();
  const isVideoFile = /\.(mp4|webm|ogg)$/i.test(url);
  const isYouTube   = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\//.test(url);
  const isFacebook  = /^(https?:\/\/)?(www\.)?facebook\.com/.test(url);
  const isTikTok    = /^(https?:\/\/)?(www\.)?tiktok\.com/.test(url);
  const isInstagram = /^(https?:\/\/)?(www\.)?instagram\.com/.test(url);
  const isTwitter   = /^(https?:\/\/)?(www\.)?twitter\.com/.test(url);
  const isDrive     = url.includes("drive.google.com/file");

  // Outer Twitter-style margin
  const outer = document.createElement("div");
  outer.className = "pl-14 mt-2"; // ✅ Twitter-like left padding and top margin

  // Wrapper and inner layer
  const wrapper = document.createElement("div");
  wrapper.className = "relative w-full rounded-lg border border-gray-200 overflow-hidden";
  const inner = document.createElement("div");
  inner.className = "absolute top-0 left-0 w-full h-full";
  wrapper.appendChild(inner);
  outer.appendChild(wrapper);
  div.appendChild(outer);

  const setAspect = (ratioPercent) => {
    wrapper.style.paddingTop = ratioPercent + "%";
  };

  if (isYouTube || isFacebook || isTikTok || isInstagram || isTwitter || isDrive) {
    setAspect(56.25);

    if (isYouTube) {
      const vidMatch = url.match(/(?:youtube\.com\/(?:.*v=|embed\/)|youtu\.be\/)([\w-]{11})/);
      if (vidMatch) {
        const iframe = document.createElement("iframe");
        iframe.src = `https://www.youtube.com/embed/${vidMatch[1]}?controls=1&rel=0&modestbranding=1`;
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
        iframe.allowFullscreen = true;
        iframe.className = "w-full h-full";
        inner.appendChild(iframe);
      }
    } else if (isFacebook) {
      const fbDiv = document.createElement("div");
      fbDiv.className = "fb-video w-full h-full";
      fbDiv.setAttribute("data-href", url);
      fbDiv.setAttribute("data-width", "auto");
      fbDiv.setAttribute("data-allowfullscreen", "true");
      inner.appendChild(fbDiv);

      if (!document.getElementById("facebook-jssdk")) {
        const fbScript = document.createElement("script");
        fbScript.id = "facebook-jssdk";
        fbScript.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v12.0";
        document.body.appendChild(fbScript);
      }
    } else if (isTikTok) {
      const block = document.createElement("blockquote");
      block.className = "tiktok-embed w-full h-full";
      block.setAttribute("cite", url);
      block.setAttribute("style", "max-width:100%; margin:0; height:100%");
      block.appendChild(document.createElement("section"));
      inner.appendChild(block);

      if (!document.querySelector('script[src*="tiktok.com/embed.js"]')) {
        const s = document.createElement("script");
        s.src = "https://www.tiktok.com/embed.js";
        document.body.appendChild(s);
      }
    } else if (isInstagram) {
      const block = document.createElement("blockquote");
      block.className = "instagram-media w-full h-full";
      block.setAttribute("data-instgrm-permalink", url);
      block.setAttribute("data-instgrm-version", "14");
      inner.appendChild(block);

      if (!document.querySelector('script[src*="instagram.com/embed.js"]')) {
        const s = document.createElement("script");
        s.src = "https://www.instagram.com/embed.js";
        document.body.appendChild(s);
      } else {
        window.instgrm?.Embeds.process();
      }
    } else if (isTwitter) {
      const block = document.createElement("blockquote");
      block.className = "twitter-tweet w-full h-full";
      const a = document.createElement("a");
      a.href = url;
      block.appendChild(a);
      inner.appendChild(block);

      if (!document.querySelector('script[src*="platform.twitter.com/widgets.js"]')) {
        const s = document.createElement("script");
        s.src = "https://platform.twitter.com/widgets.js";
        document.body.appendChild(s);
      } else {
        window.twttr?.widgets?.load();
      }
    }
  } else if (isVideoFile) {
    const video = document.createElement("video");
    video.src = url;
    video.muted = false;
    video.autoplay = true;
    video.loop = true;
    video.playsInline = true;
    video.controls = false;
    video.className = "w-full h-full object-cover";
    inner.appendChild(video);

    video.addEventListener("loadedmetadata", () => {
      const { videoWidth: w, videoHeight: h } = video;
      const ratio = (h / w) * 100;
      setAspect(ratio);
    });
  } else {
    const img = document.createElement("img");
    img.src = url;
    img.alt = post.caption || "Image post";
    img.className = "w-full h-full object-cover";
    inner.appendChild(img);

    img.addEventListener("load", () => {
      const { naturalWidth: w, naturalHeight: h } = img;
      const ratio = (h / w) * 100;
      setAspect(ratio);
    });
  }
}



      if (post.replies && post.replies.length > 0) {
  const repliesDiv = document.createElement("div");
  repliesDiv.className = "reply-list";

  // First comment
const reply = post.replies[0];
const profilePic = reply.profilePic && reply.profilePic.trim() !== ""
  ? reply.profilePic
  : "https://placehold.co/36x36/png?text=" + (reply.userName?.charAt(0) || "U");

const firstReply = document.createElement("div");
firstReply.className = "reply-item flex items-start gap-3 mt-2"; // ✅ flex to keep side-by-side layout

firstReply.innerHTML = `
  <img src="${profilePic}" alt="${reply.userName}" class="w-9 h-9 rounded-full object-cover mt-1 flex-shrink-0" />
  <div class="flex flex-col justify-center">

    <div class="inline-flex items-center font-semibold gap-1 text-sm leading-tight">
      ${reply.userName}
      ${getAIHTML(reply.AI)}
      ${getCompanyHTML(reply.company)}
      ${getProHTML(reply.pro)}
      ${getPremiumHTML(reply.premium)}
      ${getVerifiedHTML(reply.verified)}
      ${getClidderHTML(reply.Clidder)}
    </div>
    <div class="text-sm text-gray-700 dark:text-gray-300">${convertUrlsToLinks(reply.text)}</div>
  </div>
`;


  repliesDiv.appendChild(firstReply);

  // "View more" button
  if (post.replies.length > 1) {
    const viewMoreBtn = document.createElement("button");
    viewMoreBtn.className = "text-[#FF7D1E] text-sm mt-2 view-more-btn ml-12";
    viewMoreBtn.textContent = "View more Commentary";
    repliesDiv.appendChild(viewMoreBtn);

    // More comments (hidden initially)
    const moreComments = document.createElement("div");
    moreComments.className = "more-comments hidden";
    post.replies.slice(1).forEach((reply) => {
      const replyDiv = document.createElement("div");
replyDiv.className = "reply-item flex items-start gap-3 mb-2";

const profilePic = reply.profilePic && reply.profilePic.trim() !== ""
  ? reply.profilePic
  : "https://placehold.co/36x36/png?text=" + (reply.userName?.charAt(0) || "U");

replyDiv.innerHTML = `
  <img src="${profilePic}" alt="${reply.userName}" class="w-9 h-9 rounded-full object-cover mt-1" />
  <div>
    <div class="inline-flex items-center font-semibold gap-1">
      ${reply.userName}
      ${getPremiumHTML(reply.premium)}
      ${getVerifiedHTML(reply.verified)}
      ${getProHTML(reply.pro)}
      ${getCompanyHTML(reply.company)}
      ${getAIHTML(reply.AI)}
      ${getClidderHTML(reply.Clidder)}
    </div>
    <div class="text-sm text-gray-700 dark:text-gray-300">${convertUrlsToLinks(reply.text)}</div>
  </div>
`;




      moreComments.appendChild(replyDiv);
    });
    repliesDiv.appendChild(moreComments);

    // Show on click
    viewMoreBtn.addEventListener("click", () => {
      moreComments.classList.remove("hidden");
      viewMoreBtn.style.display = "none";
    });
  }

  div.appendChild(repliesDiv);
}


const replyBox = document.createElement("div");
replyBox.className = "flex items-center mt-2 pt-2 pl-14";

replyBox.innerHTML = `
  <input type="text" placeholder="Leave a Commentary..." class="reply-input flex-1 pl-4 py-2 text-sm bg-transparent text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none" />
  <button class="text-[#FF7D1E] font-semibold text-sm px-3" disabled>Commentary</button>
`;

// Enable Post button only when typing
const replyInput = replyBox.querySelector("input");
const postBtn = replyBox.querySelector("button");

replyInput.addEventListener("input", () => {
  postBtn.disabled = replyInput.value.trim() === "";
});



// Handle Post click
postBtn.addEventListener("click", () => {
  const text = replyInput.value.trim();
  if (!text) return;
  if (!currentUser) {
    alert("Please sign in or create an account before Commentary.");
    showAuthModal();
    return;
  }

  const reply = {
  userName: currentUser.fullName,
  userHandle: "𝓬𝓹" + currentUser.username.toLowerCase(),
  profilePic: currentUser.profilePic || "", // ✅ ADD THIS LINE
  text,
  verified: currentUser.verified || false,
  premium: currentUser.premium || false,
  pro: currentUser.pro || false,
  company: currentUser.company || false,
  AI: currentUser.AI || false,
  Clidder: currentUser.Clidder || false,
  createdAt: new Date().toISOString(),
};


  const postRef = doc(db, "posts", id);
  updateDoc(postRef, {
    replies: arrayUnion(reply),
  }).catch((err) => alert("Error adding comment: " + err.message));

  replyInput.value = "";
  postBtn.disabled = true;
});

div.appendChild(replyBox);



      const actions = document.createElement("div");
actions.className = "post-actions flex justify-around flex-wrap text-gray-500 mt-4 w-full max-w-md mx-auto gap-2";


      const replyBtn = document.createElement("button");
      replyBtn.className = "flex items-center space-x-3 tweet-action-btn";
      replyBtn.innerHTML = `<i class="far fa-comment fa-lg"></i><span></span>`;
      replyBtn.addEventListener("click", () => {
        if (!currentUser) {
          alert("Please sign in or create an account before commentinng.");
          showAuthModal();
          return;
        }
        const userName = currentUser.fullName;
        const replyText = prompt("Enter your comment:");
        if (replyText && replyText.trim() !== "") {
          const reply = {
            userName,
            userHandle: "𝓬𝓹" + currentUser.username.toLowerCase(),
            text: replyText.trim(),
            createdAt: new Date().toISOString(),
          };
          const postRef = doc(db, "posts", id);
          updateDoc(postRef, {
            replies: arrayUnion(reply),
          }).catch((err) => alert("Error adding comment: " + err.message));
        }
      });

      const retweetBtn = document.createElement("button");
      retweetBtn.className = "flex items-center space-x-3 tweet-action-btn";
      retweetBtn.innerHTML = `<i class="fas fa-retweet fa-lg"></i><span></span>`;
      retweetBtn.addEventListener("click", async () => {
        if (!currentUser) {
          alert("Please sign in or create an account before reclidding.");
          showAuthModal();
          return;
        }
        const userName = currentUser.username;
        const postRef = doc(db, "posts", id);
        const hasRetweeted = post.retweets?.includes(userName);
        try {
          if (hasRetweeted) {
            await updateDoc(postRef, {
              retweets: arrayRemove(userName),
            });
            alert("Reclidde removed");
          } else {
            await updateDoc(postRef, {
              retweets: arrayUnion(userName),
            });
            alert("Reclidded!");
          }
        } catch (err) {
          alert("Error updating retweet: " + err.message);
        }
      });

      const likeBtn = document.createElement("button");
      likeBtn.className = "flex items-center space-x-3 tweet-action-btn";
      likeBtn.innerHTML = `<i class="far fa-heart fa-lg"></i><span></span>`;
      let liked = false;
      if (currentUser && post.likes?.includes(currentUser.username)) {
        liked = true;
        likeBtn.classList.add("liked");
        likeBtn.querySelector("i").className = "fas fa-heart fa-lg";
      }
      likeBtn.addEventListener("click", async () => {
        if (!currentUser) {
          alert("Please sign in or create an account before liking.");
          showAuthModal();
          return;
        }
        const userName = currentUser.username;
        const postRef = doc(db, "posts", id);
        try {
          if (liked) {
            await updateDoc(postRef, {
              likes: arrayRemove(userName),
            });
            liked = false;
            likeBtn.classList.remove("liked");
            likeBtn.querySelector("i").className = "far fa-heart fa-lg";
          } else {
            await updateDoc(postRef, {
              likes: arrayUnion(userName),
            });
            liked = true;
            likeBtn.classList.add("liked");
            likeBtn.querySelector("i").className = "fas fa-heart fa-lg";
          }
        } catch (err) {
          alert("Error updating like: " + err.message);
        }
      });

      const likeCountSpan = document.createElement("span");
      likeCountSpan.className = "text-sm text-gray-600 ml-1";
      likeCountSpan.textContent = post.likes ? post.likes.length : 0;
      likeBtn.appendChild(likeCountSpan);

      const retweetCountSpan = document.createElement("span");
      retweetCountSpan.className = "text-sm text-gray-600 ml-1";
      retweetCountSpan.textContent = post.retweets ? post.retweets.length : 0;
      retweetBtn.appendChild(retweetCountSpan);

      const shareBtn = document.createElement("button");
      shareBtn.className = "flex items-center space-x-3 tweet-action-btn";
      shareBtn.innerHTML = `<i class="fas fa-share-square fa-lg"></i><span></span>`;
      shareBtn.addEventListener("click", () => {
        const url = `${window.location.origin}${window.location.pathname}#post-${id}`;
        if (navigator.share) {
          navigator.share({
            title: `Tweet by ${post.userName}`,
            text: post.caption,
            url,
          }).catch(() => alert("Share cancelled or failed"));
        } else {
          navigator.clipboard.writeText(url).then(() => {
            alert("Post link copied to clipboard!");
          });
        }
      });

      actions.appendChild(replyBtn);
      actions.appendChild(retweetBtn);
      actions.appendChild(likeBtn);
      actions.appendChild(shareBtn);

      div.appendChild(actions);

      div.id = `post-${id}`;

      const heartIcon = document.createElement("i");
      heartIcon.className =
        "fas fa-heart text-red-500 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-8xl opacity-0 pointer-events-none transition-opacity duration-500";
      div.appendChild(heartIcon);

      div.addEventListener("dblclick", () => {
        showHeart(heartIcon);
        if (!liked) {
          liked = true;
          likeBtn.classList.add("liked");
          likeBtn.querySelector("i").className = "fas fa-heart fa-lg";
          if (currentUser) {
            const postRef = doc(db, "posts", id);
            updateDoc(postRef, {
              likes: arrayUnion(currentUser.username),
            }).catch(() => {});
          }
        }
      });

      div.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        currentContextPostId = id;
        currentContextPostData = post;
        showContextMenu(e.pageX, e.pageY);
      });

      let pressTimer = null;
      div.addEventListener("touchstart", (e) => {
        pressTimer = setTimeout(() => {
          currentContextPostId = id;
          currentContextPostData = post;
          const touch = e.touches[0];
          showContextMenu(touch.pageX, touch.pageY);
        }, 600);
      });
      div.addEventListener("touchend", () => {
        if (pressTimer !== null) {
          clearTimeout(pressTimer);
          pressTimer = null;
        }
      });
      div.addEventListener("touchmove", () => {
        if (pressTimer !== null) {
          clearTimeout(pressTimer);
          pressTimer = null;
        }
      });

      return div;
    }

    function showHeart(icon) {
      icon.style.opacity = "1";
      setTimeout(() => {
        icon.style.opacity = "0";
      }, 800);
    }

    function showContextMenu(x, y) {
      contextMenu.style.display = "block";
      const menuWidth = contextMenu.offsetWidth;
      const menuHeight = contextMenu.offsetHeight;
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;

      if (x + menuWidth > windowWidth) {
        x = windowWidth - menuWidth - 10;
      }
      if (y + menuHeight > windowHeight) {
        y = windowHeight - menuHeight - 10;
      }

      contextMenu.style.left = x + "px";
      contextMenu.style.top = y + "px";
      contextMenu.setAttribute("aria-hidden", "false");

      // Show or hide delete button based on ownership
      if (currentUser && currentContextPostData && currentContextPostData.userId === currentUser.id) {
        contextDelete.style.display = "flex";
      } else {
        contextDelete.style.display = "none";
      }
    }

    function hideContextMenu() {
      contextMenu.style.display = "none";
      contextMenu.setAttribute("aria-hidden", "true");
      currentContextPostId = null;
      currentContextPostData = null;
    }

    function savePost(post) {
      if (
        !savedPosts.find(
          (p) => p.imageUrl === post.imageUrl && p.caption === post.caption
        )
      ) {
        savedPosts.push(post);
        localStorage.setItem("savedPosts", JSON.stringify(savedPosts));
        alert("Post saved!");
      } else {
        alert("Post already saved.");
      }
    }

    function favoritePost(postId) {
      if (!favoritePosts.has(postId)) {
        favoritePosts.add(postId);
        localStorage.setItem(
          "favoritePosts",
          JSON.stringify(Array.from(favoritePosts))
        );
        alert("Post favorited!");
      } else {
        alert("Post already favorited.");
      }
    }

    async function deletePost(postId) {
      if (!postId) return;
      const confirmDelete = confirm("Are you sure you want to delete this post?");
      if (!confirmDelete) return;
      try {
        await deleteDoc(doc(db, "posts", postId));
        alert("Post deleted.");
      } catch (error) {
        alert("Error deleting post: " + error.message);
      }
    }

    function showSavedPosts() {
      if (savedPosts.length === 0) {
        alert("No saved posts.");
        return;
      }
      feedEl.innerHTML = "";
      savedPosts.forEach((post) => {
        feedEl.appendChild(renderPost(post, post.imageUrl + post.caption));
      });
    }

    function showFavoritePosts() {
      if (favoritePosts.size === 0) {
        alert("No favorite posts.");
        return;
      }
      feedEl.innerHTML = "";
      // Filter posts that are favorited by id
      const favoritePostsArray = posts.filter(post => favoritePosts.has(post.id));
      favoritePostsArray.forEach(post => {
        feedEl.appendChild(renderPost(post, post.id));
      });
    }

    function showFromMePosts() {
      if (!currentUser) {
        alert("Please sign in to view your posts.");
        showAuthModal();
        return;
      }
      const fromMePosts = posts.filter(post => post.userId === currentUser.id);
      if (fromMePosts.length === 0) {
        alert("You have not published any posts yet.");
        return;
      }
      feedEl.innerHTML = "";
      fromMePosts.forEach(post => {
        feedEl.appendChild(renderPost(post, post.id));
      });
    }

    // Update notifications badge and list
    function updateNotifications() {
      if (!currentUser) {
        notificationBadge.style.display = "none";
        notificationBadgeLeft.style.display = "none";
        notificationsList.innerHTML = '<li class="p-4 text-center text-gray-500">Sign in to see notifications.</li>';
        return;
      }
      // Filter posts published by others and unread by user
      const unreadPosts = posts.filter(post => post.userId !== currentUser.id && !readNotifications.has(post.id));
      if (unreadPosts.length === 0) {
        notificationBadge.style.display = "none";
        notificationBadgeLeft.style.display = "none";
        notificationsList.innerHTML = '<li class="p-4 text-center text-gray-500">No new notifications.</li>';
        return;
      }
      notificationBadge.style.display = "flex";
      notificationBadge.textContent = unreadPosts.length;
      notificationBadgeLeft.style.display = "inline-block";
      notificationBadgeLeft.textContent = unreadPosts.length;

      notificationsList.innerHTML = "";
      unreadPosts.forEach(post => {
        const li = document.createElement("li");
        li.tabIndex = 0;
        li.setAttribute("role", "button");
        li.setAttribute("aria-label", `Notification from ${post.userName}: ${post.caption}`);
        const avatar = document.createElement("img");
        avatar.src = post.profilePic && post.profilePic.trim() !== "" ? post.profilePic : "https://placehold.co/40x40/png?text=" + (post.userName ? post.userName[0].toUpperCase() : "U") + "&font=roboto&font-weight=700&bg=ddd&fg=555";
        avatar.alt = post.userName ? `${post.userName} avatar` : "User avatar placeholder";

        const contentDiv = document.createElement("div");
        contentDiv.className = "notification-content";

        const userSpan = document.createElement("span");
        userSpan.className = "notification-user";
        userSpan.textContent = post.userName;

        const captionSpan = document.createElement("span");
        captionSpan.className = "notification-caption";
        captionSpan.textContent = post.caption;

        const timeSpan = document.createElement("span");
        timeSpan.className = "notification-time";
        let createdAtDate = null;
        if (post.createdAt && post.createdAt.toDate) {
          createdAtDate = post.createdAt.toDate();
        } else if (post.createdAt instanceof Date) {
          createdAtDate = post.createdAt;
        } else if (typeof post.createdAt === "string") {
          createdAtDate = new Date(post.createdAt);
        }
        timeSpan.textContent = timeAgo(createdAtDate);

        contentDiv.appendChild(userSpan);
        contentDiv.appendChild(captionSpan);
        contentDiv.appendChild(timeSpan);

        li.appendChild(avatar);
        li.appendChild(contentDiv);

        li.addEventListener("click", () => {
          // Mark notification as read
          readNotifications.add(post.id);
          localStorage.setItem("readNotifications", JSON.stringify(Array.from(readNotifications)));
          updateNotifications();
          // Scroll to post in feed
          const postEl = document.getElementById(`post-${post.id}`);
          if (postEl) {
            postEl.scrollIntoView({ behavior: "smooth", block: "center" });
            postEl.classList.add("ring-4", "ring-[#FF7D1E]");
            setTimeout(() => {
              postEl.classList.remove("ring-4", "ring-[#FF7D1E]");
            }, 2000);
          }
          notificationsDropdown.style.display = "none";
        });

        notificationsList.appendChild(li);
      });
    }

    const postsQuery = query(
      collection(db, "posts"),
      orderBy("createdAt", "desc")
    );
    onSnapshot(postsQuery, (snapshot) => {
      posts = [];
      snapshot.forEach((doc) => {
        const postData = doc.data();
        posts.push({ ...postData, id: doc.id });
      });
      filteredPosts = posts;
      renderFeed(filteredPosts);
      updateNotifications();
    });

// Global click listener for ⋮ post menu
document.addEventListener('click', function (e) {
  const isBtn = e.target.closest('.post-options-btn');
  const allMenus = document.querySelectorAll('.post-options-menu');
  allMenus.forEach(menu => menu.classList.add('hidden'));

  if (isBtn) {
    const menu = isBtn.parentElement.querySelector('.post-options-menu');
    if (menu) {
      menu.classList.toggle('hidden');
      e.stopPropagation();
    }
  }
});



    function renderFeed(postsToRender) {
      feedEl.innerHTML = "";
      postsToRender.forEach((post) => {
        feedEl.appendChild(renderPost(post, post.id));
      });
    }

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.trim().toLowerCase();
      if (query === "") {
        filteredPosts = posts;
      } else {
        filteredPosts = posts.filter((post) =>
          post.caption.toLowerCase().includes(query)
        );
      }
      renderFeed(filteredPosts);
    });

    contextFavorite.addEventListener("click", () => {
      if (currentContextPostId) {
        favoritePost(currentContextPostId);
      }
      hideContextMenu();
    });
    contextSave.addEventListener("click", () => {
      if (currentContextPostData) {
        savePost(currentContextPostData);
      }
      hideContextMenu();
    });
    contextDelete.addEventListener("click", () => {
      if (!currentUser) {
        alert("Please sign in or create an account to delete posts.");
        showAuthModal();
        hideContextMenu();
        return;
      }
      if (currentContextPostId && currentContextPostData && currentContextPostData.userId === currentUser.id) {
        deletePost(currentContextPostId);
      } else {
        alert("You can only delete your own posts.");
      }
      hideContextMenu();
    });

    document.addEventListener("click", (e) => {
      if (!contextMenu.contains(e.target)) {
        hideContextMenu();
      }
      if (!sidebarNotificationsBtn.contains(e.target) && !notificationsDropdown.contains(e.target)) {
        notificationsDropdown.style.display = "none";
      }
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        hideContextMenu();
        notificationsDropdown.style.display = "none";
        closeCliddersModal();
      }
    });

    sidebarNotificationsBtn.addEventListener("click", () => {
      if (notificationsDropdown.style.display === "block") {
        notificationsDropdown.style.display = "none";
      } else {
        updateNotifications();
        notificationsDropdown.style.display = "block";
        notificationsDropdown.focus();
      }
    });

    document.getElementById("sidebarHome").addEventListener("click", () => {
      renderFeed(posts);
    });
    document.getElementById("sidebarExplore").addEventListener("click", () => {
      openSearchBar();
    });
    document
      .getElementById("sidebarNotificationsLeft")
      .addEventListener("click", () => {
        sidebarNotificationsBtn.click();
      });
    document.getElementById("sidebarMessages").addEventListener("click", () => {
      alert("Messages feature coming soon!");
    });
    document.getElementById("sidebarBookmarks").addEventListener("click", () => {
      showSavedPosts();
    });
    document.getElementById("sidebarLists").addEventListener("click", async () => {
  const feedEl = document.getElementById("feed");
  feedEl.innerHTML = "";

  const usersRef = collection(db, "users");
  const postsRef = collection(db, "posts");
  const usersSnapshot = await getDocs(usersRef);
  const postsSnapshot = await getDocs(postsRef);

  const allUsers = [];
  let induwaraUser = null;

  usersSnapshot.forEach((doc) => {
    const user = { id: doc.id, ...doc.data() };
    if (user.fullName && user.fullName.trim().endsWith("🌟")) {
      if (user.fullName.trim().toUpperCase() === "INDUWARA JAYASINGHE") {
        induwaraUser = user;
      } else {
        allUsers.push(user);
      }
    }
  });

  // Sort remaining users A-Z
  allUsers.sort((a, b) =>
    a.fullName.localeCompare(b.fullName, "en", { sensitivity: "base" })
  );

  const starredUsers = [];
  if (induwaraUser) starredUsers.push(induwaraUser);
  starredUsers.push(...allUsers);

  if (starredUsers.length === 0) {
    feedEl.innerHTML = `<p class="text-center text-gray-500 mt-6 text-lg">No verified users found.</p>`;
    return;
  }

  starredUsers.forEach((user) => {
    const userPosts = [];
    let followers = user.followers || [];
    let isFollowing = currentUser && followers.includes(currentUser.username);

    postsSnapshot.forEach((postDoc) => {
      const post = postDoc.data();
      if (post.userId === user.id) userPosts.push(post);
    });

    const card = document.createElement("div");
    card.className = `
      bg-gradient-to-br from-black-50 to-white dark:from-black-900 dark:to-gray-900
      border border-purple-400 dark:border-purple-500
      shadow-lg rounded-xl p-5 mb-6 transition transform hover:scale-105
    `;

    card.innerHTML = `
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <img src="${user.profilePic || 'https://placehold.co/64x64'}"
               alt="${user.fullName}"
               class="w-16 h-16 rounded-full border-2 border-yellow-400 dark:border-yellow-300 object-cover shadow-md" />
          <div class="flex flex-col justify-center">

            <div class="flex items-center space-x-2">
              <h3>
  <span class="inline-flex items-center">
    ${user.fullName}
    ${getPremiumHTML(user.premium)}
    ${getVerifiedHTML(user.verified)}
    ${getProHTML(user.pro)}
    ${getCompanyHTML(user.company)}
    ${getAIHTML(user.AI)}
    ${getClidderHTML(user.Clidder)}

  </span>
</h3>

              <span class="text-yellow-400 text-lg animate-bounce">Verified</span>
            </div>
            <p class="text-gray-500 dark:text-gray-400">𝓬𝓹${user.username}</p>
          </div>
        </div>
        <button class="follow-btn px-4 py-2 text-sm font-semibold rounded-full border border-yellow-400 dark:border-yellow-300 ${
          isFollowing ? "bg-yellow-400 text-white" : "bg-white text-yellow-500 dark:bg-yellow-800"
        } hover:shadow-md transition">
          ${isFollowing ? "Following" : "Follow"}
        </button>
      </div>
      <div class="mt-3 flex justify-between items-center text-sm text-gray-600 dark:text-gray-300">
        <span><i>This Clidder account has been verified by Black Hat.</i></span>
        <span class="text-right font-medium">${userPosts.length} Posts • ${followers.length} Followers</span>
      </div>
    `;

    const followBtn = card.querySelector(".follow-btn");
    followBtn.addEventListener("click", async () => {
      if (!currentUser) {
        alert("Please sign in to follow users.");
        return;
      }

      const userRef = doc(db, "users", user.id);
      if (isFollowing) {
        await updateDoc(userRef, {
          followers: arrayRemove(currentUser.username),
        });
        followBtn.textContent = "Follow";
        followBtn.classList.remove("bg-yellow-400", "text-white");
        followBtn.classList.add("bg-white", "text-yellow-500");
      } else {
        await updateDoc(userRef, {
          followers: arrayUnion(currentUser.username),
        });
        followBtn.textContent = "Following";
        followBtn.classList.add("bg-yellow-400", "text-white");
        followBtn.classList.remove("bg-white", "text-yellow-500");
      }
      isFollowing = !isFollowing;
    });

    feedEl.appendChild(card);
  });
});

    sidebarFavoritesBtn.addEventListener("click", () => {
      showFavoritePosts();
    });
    sidebarFromMeBtn.addEventListener("click", () => {
      showFromMePosts();
    });










  document.getElementById("sidebarMore").addEventListener("click", async () => {
  const feedEl = document.getElementById("feed");

  feedEl.innerHTML = `
    <div class="mb-4 flex flex-wrap gap-2 items-center justify-between max-w-xl mx-auto">
      <input type="text" id="userSearchInput" placeholder="Search Clidders..."
       class="w-44 px-4 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-white dark:bg-black text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]" />

      <select id="filterBadge" class="px-3 py-2 rounded border text-sm">
        <option value="">All Badges</option>
        <option value="verified">Verified</option>
        <option value="premium">Premium</option>
        <option value="pro">Pro</option>
        <option value="AI">AI</option>
        <option value="company">Company</option>
      </select>

      <select id="filterCountry" class="px-3 py-2 rounded border text-sm">
        <option value="">All Countries</option>
      </select>

      <select id="filterGender" class="px-3 py-2 rounded border text-sm">
        <option value="">All Genders</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>
  `;

  const postsSnapshot = await getDocs(collection(db, "posts"));
  const posts = postsSnapshot.docs.map(doc => doc.data());

  const formatDate = (date) =>
    date ? new Date(date).toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" }) : null;

  let fullUserList = [];

  const getUserPosts = (userId) => posts.filter(p => p.userId === userId);

  const renderUserCard = (container, user) => {
    const isInduwara = user.fullName?.trim().toUpperCase() === "INDUWARA JAYASINGHE";
    const userPosts = getUserPosts(user.id);
    const followers = user.followers || [];
    let isFollowing = currentUser && followers.includes(currentUser.username);

    const getFieldHTML = (iconClass, value) =>
      value ? `<div><i class="fas ${iconClass} mr-1"></i>${value}</div>` : "";

    let birthdayHTML = "";
    if (user.birthday) {
      const birthDate = new Date(user.birthday);
      const age = new Date().getFullYear() - birthDate.getFullYear();
      birthdayHTML = `
        <div><i class="fas fa-birthday-cake mr-1"></i>${birthDate.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })}</div>
        <div><i class="fas fa-user-clock mr-1"></i>${age} years</div>
      `;
    }

    let mutualFollowersText = "";
    if (currentUser?.following?.length) {
      const mutual = user.followers?.filter(f => currentUser.following.includes(f)) || [];
      if (mutual.length) {
        const names = mutual.slice(0, 2).join(", ");
        const others = mutual.length - 2;
        mutualFollowersText = `Followed by ${names}${others > 0 ? ` and ${others} others you follow` : ""}`;
      }
    }

    const badgeInfo = isInduwara
      ? [
          "Verified since 8000 BCE",
          "Get Premium since 8000 BCE",
          "Upgrade to Pro since 8000 BCE",
          "AI-powered since 8000 BCE",
          "Registered as Company since 8000 BCE",
        ]
      : [
          user.verifiedAt && `Verified since ${formatDate(user.verifiedAt)}`,
          user.premiumat && `Get Premium since ${formatDate(user.premiumat)}`,
          user.proat && `Upgrade to Pro since ${formatDate(user.proat)}`,
          user.aiat && `AI-powered since ${formatDate(user.aiat)}`,
          user.companyat && `Registered as Company since ${formatDate(user.companyat)}`,
        ].filter(Boolean);

    const card = document.createElement("div");
    card.className = `bg-white dark:bg-black rounded-2xl border border-gray-200 dark:border-gray-700 max-w-xl w-full mx-auto mb-6 shadow hover:shadow-lg transition hover:scale-[1.01]`;

    card.innerHTML = `
      <div class="h-36 bg-gray-200 dark:bg-gray-800 relative">
        <img src="${user.coverPic || 'https://placehold.co/600x200?text=Clidder%20|%20A%20Jayasinghe%20Brothers%20Holdings%20Company%20Limited'}" class="w-full h-full object-cover" />
        <img src="${user.profilePic || 'https://placehold.co/64x64'}" class="absolute -bottom-8 left-4 w-16 h-16 rounded-md border-4 border-white dark:border-black object-cover shadow-lg" />
      </div>

      <div class="p-4 pt-10">
        <div class="flex justify-between items-start gap-4">
          <div class="flex-1">
            <h3 class="text-lg font-bold text-gray-900 dark:text-white flex flex-wrap items-center gap-1">
              ${user.fullName}
              ${getVerifiedHTML(user.verified)}
              ${getPremiumHTML(user.premium)}
              ${getProHTML(user.pro)}
              ${getCompanyHTML(user.company)}
              ${getAIHTML(user.AI)}
              ${getClidderHTML(user.Clidder)}
            </h3>
            <p class="text-sm text-gray-500">
              𝓬𝓹${user.username}
              ${isInduwara ? `<span class="text-orange-600 font-medium ml-2">| <i class="fas fa-crown text-orange-500 mr-1"></i>Founder</span>` : ""}
            </p>
            ${
              isInduwara
                ? `<p class="text-sm text-blue-600 mt-1">
                    Web | <a href="https://clidde.netlify.app/" target="_blank" class="hover:underline">Click Me !</a><br>
                    <span class="text-gray-500">Company: Clidder Inc.</span>
                  </p>`
                : ""
            }
            ${mutualFollowersText ? `<p class="text-sm text-gray-500 mt-1">${mutualFollowersText}</p>` : ""}
          </div>
          <button class="follow-btn px-4 py-1 text-sm font-semibold rounded-full border border-gray-300 ${
            isFollowing ? "bg-gray-800 text-white" : "bg-white text-gray-700"
          } hover:bg-gray-100 dark:hover:bg-gray-800 transition">${isFollowing ? "Following" : "Follow"}</button>
        </div>

        <p class="mt-2 italic text-sm text-gray-700 dark:text-gray-300">
          𝓒𝓵𝓲𝓭𝓭𝓮𝓻 | 𝓐 𝓙𝓪𝔂𝓪𝓼𝓲𝓷𝓰𝓱𝓮 𝓑𝓻𝓸𝓽𝓱𝓮𝓻𝓼 𝓗𝓸𝓵𝓭𝓲𝓷𝓰𝓼 𝓒𝓸𝓶𝓹𝓪𝓷𝔂 𝓛𝓲𝓶𝓲𝓽𝓮𝓭.
        </p>

        <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-700 dark:text-gray-300">
          ${getFieldHTML("fa-info-circle", user.bio)}
          ${getFieldHTML("fa-venus-mars", user.gender)}
          ${getFieldHTML("fa-envelope", user.email)}
          ${getFieldHTML("fa-mobile-alt", user.mobile)}
          ${getFieldHTML("fa-map-marker-alt", user.address)}
          ${getFieldHTML("fa-globe", user.country)}
          ${birthdayHTML}
        </div>

        ${
          badgeInfo.length > 0
            ? `<ul class="mt-3 text-sm text-gray-600 dark:text-gray-400 space-y-1">
                 ${badgeInfo.map(item => `<li>• ${item}</li>`).join("")}
               </ul>`
            : ""
        }

        <div class="mt-3 text-sm text-gray-500 dark:text-gray-400 flex justify-between">
          <span>${userPosts.length} Cliddes</span>
          <span>${followers.length} Clidders</span>
        </div>
      </div>
    `;

    const followBtn = card.querySelector(".follow-btn");
    followBtn.addEventListener("click", async () => {
      if (!currentUser) return alert("Sign in to follow users.");
      const userRef = doc(db, "users", user.id);
      if (isFollowing) {
        await updateDoc(userRef, { followers: arrayRemove(currentUser.username) });
      } else {
        await updateDoc(userRef, { followers: arrayUnion(currentUser.username) });
      }
    });

    container.appendChild(card);
  };

  const render = (list) => {
    const existing = document.getElementById("userCards");
    if (existing) existing.remove();
    const container = document.createElement("div");
    container.id = "userCards";
    list.forEach(user => renderUserCard(container, user));
    feedEl.appendChild(container);
  };

  const filterAndRender = () => {
    const searchVal = document.getElementById("userSearchInput").value.toLowerCase();
    const badge = document.getElementById("filterBadge").value;
    const gender = document.getElementById("filterGender").value;
    const country = document.getElementById("filterCountry").value;

    const filtered = fullUserList.filter(user => {
      const matchesSearch = user.fullName?.toLowerCase().includes(searchVal);
      const matchesBadge = !badge || user[badge];
      const matchesGender = !gender || user.gender === gender;
      const matchesCountry = !country || user.country === country;
      return matchesSearch && matchesBadge && matchesGender && matchesCountry;
    });

    render(filtered);
  };

  onSnapshot(collection(db, "users"), (snapshot) => {
    let induwara = null;
    const others = [];

    snapshot.forEach(doc => {
      const user = { id: doc.id, ...doc.data() };
      ["verifiedAt", "premiumat", "proat", "aiat", "companyat", "birthday"].forEach(f => {
        if (user[f]?.toDate) user[f] = user[f].toDate();
      });
      user.followerCount = Array.isArray(user.followers) ? user.followers.length : 0;

      if (user.fullName?.trim().toUpperCase() === "INDUWARA JAYASINGHE") {
        induwara = user;
      } else if (user.fullName?.trim()) {
        others.push(user);
      }
    });

    others.sort((a, b) => b.followerCount - a.followerCount);
    fullUserList = induwara ? [induwara, ...others] : others;

    // Populate country dropdown
    const countrySet = new Set(others.map(u => u.country).filter(Boolean));
    const countryFilter = document.getElementById("filterCountry");
    countryFilter.innerHTML = `<option value="">All Countries</option>`;
    countrySet.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      countryFilter.appendChild(opt);
    });

    filterAndRender();
  });

  document.getElementById("userSearchInput").addEventListener("input", filterAndRender);
  document.getElementById("filterBadge").addEventListener("change", filterAndRender);
  document.getElementById("filterGender").addEventListener("change", filterAndRender);
  document.getElementById("filterCountry").addEventListener("change", filterAndRender);
});














    function closeCliddersModal() {
      modalClidders.style.display = "none";
      cliddersList.innerHTML = "";
    }

    btnAddPost.disabled = !currentUser;
    btnTweet.disabled = !currentUser;
    tweetInput.disabled = !currentUser;

    btnTweet.addEventListener("click", () => {
      if (!currentUser) {
        alert("Please sign in or create an account to post.");
        showAuthModal();
        return;
      }
      modalAddPost.classList.remove("hidden");
      postImageUrlInput.focus();
    });

    // Render profile modal content with edit facility
    function renderProfile() {
      if (!currentUser) return;

      // Create editable form for profile
      profileContent.innerHTML = `
        <form id="profileEditForm" class="flex flex-col items-center space-y-4">
          <div class="w-full relative">
            <img id="coverPicPreview" src="${currentUser.coverPic || 'https://placehold.co/600x200/png?text=Cover+Photo'}" alt="Cover photo" class="w-full h-48 object-cover rounded-lg" />
            <input id="coverPicInput" type="url" placeholder="Cover Picture URL" class="mt-2 w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E] text-sm" value="${currentUser.coverPic || ''}" />
          </div>
          <div class="relative -mt-16">
            <img id="profilePicPreview" src="${currentUser.profilePic || 'https://placehold.co/100x100/png?text=Profile'}" alt="Profile photo" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg" />
            <input id="profilePicInput" type="url" placeholder="Profile Picture URL" class="mt-2 w-64 border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E] text-sm" value="${currentUser.profilePic || ''}" />
          </div>
          <input id="fullNameInput" type="text" maxlength="100" class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E] text-lg text-center font-bold" value="${currentUser.fullName || ''}" placeholder="Full Name" required />
          <input id="usernameInput" type="text" maxlength="50" class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E] text-gray-500 text-center" value="${currentUser.username || ''}" placeholder="Username" disabled />
          <textarea id="bioInput" rows="3" maxlength="280" class="w-full border border-gray-300 rounded-md p-3 resize-none focus:outline-none focus:ring-2 focus:ring-[#FF7D1E] text-center text-gray-700" placeholder="Bio">${currentUser.bio || ''}</textarea>
          <div class="flex flex-wrap justify-center gap-4 text-sm text-gray-600 w-full">
            <label class="flex flex-col w-40">
              <span class="font-semibold">Birthday:</span>
              <input id="birthdayInput" type="date" class="border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]" value="${currentUser.birthday || ''}" />
            </label>
            <label class="flex flex-col w-40">
              <span class="font-semibold">Gender:</span>
              <select id="genderInput" class="border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]">
                <option value="" ${!currentUser.gender ? 'selected' : ''}>Select Gender</option>
                <option value="Male" ${currentUser.gender === 'Male' ? 'selected' : ''}>Male</option>
                <option value="Female" ${currentUser.gender === 'Female' ? 'selected' : ''}>Female</option>
                <option value="Non-binary" ${currentUser.gender === 'Non-binary' ? 'selected' : ''}>Non-binary</option>
                <option value="Other" ${currentUser.gender === 'Other' ? 'selected' : ''}>Other</option>
                <option value="Prefer not to say" ${currentUser.gender === 'Prefer not to say' ? 'selected' : ''}>Prefer not to say</option>
              </select>
            </label>
            <label class="flex flex-col w-40">
              <span class="font-semibold">Address:</span>
              <input id="addressInput" type="text" maxlength="200" class="border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]" value="${currentUser.address || ''}" />
            </label>
            <label class="flex flex-col w-40">
              <span class="font-semibold">Country:</span>
              <input id="countryInput" type="text" maxlength="100" class="border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]" value="${currentUser.country || ''}" />
            </label>
            <label class="flex flex-col w-40">
              <span class="font-semibold">Email:</span>
             <input id="emailInput" type="email" maxlength="100" class="border border-gray-300 rounded-md p-2 bg-gray-100 text-gray-500 cursor-not-allowed" value="${currentUser.email || ''}" disabled readonly />
            </label>
          </div>
          <div class="flex space-x-4 mt-4">
            <button type="submit" id="btnSaveProfile" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition font-semibold">Save</button>
            <button type="button" id="btnCancelEdit" class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400 transition font-semibold">Cancel</button>
          </div>
          <button id="btnSignOut" type="button" class="mt-6 bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 transition font-semibold">Sign Out</button>
        </form>
      `;

      // Update image previews on URL input change
      const coverPicInput = document.getElementById("coverPicInput");
      const coverPicPreview = document.getElementById("coverPicPreview");
      coverPicInput.addEventListener("input", () => {
        coverPicPreview.src = coverPicInput.value.trim() || 'https://placehold.co/600x200/png?text=Cover+Photo';
      });

      const profilePicInput = document.getElementById("profilePicInput");
      const profilePicPreview = document.getElementById("profilePicPreview");
      profilePicInput.addEventListener("input", () => {
        profilePicPreview.src = profilePicInput.value.trim() || 'https://placehold.co/100x100/png?text=Profile';
      });

      // Cancel edit button
      document.getElementById("btnCancelEdit").addEventListener("click", () => {
        renderProfile(); // Re-render to reset form
      });

      // Sign out button
      document.getElementById("btnSignOut").addEventListener("click", () => {
        if (confirm("Are you sure you want to sign out?")) {
  clearCurrentUser();
  hideProfileModal();
  alert("Signed out successfully.");
  location.reload(); // Reload the page after sign-out
}

      });

      // Save profile button
      document.getElementById("profileEditForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const fullName = document.getElementById("fullNameInput").value.trim();
        const bio = document.getElementById("bioInput").value.trim();
        const birthday = document.getElementById("birthdayInput").value;
        const gender = document.getElementById("genderInput").value;
        const address = document.getElementById("addressInput").value.trim();
        const country = document.getElementById("countryInput").value.trim();
        const email = document.getElementById("emailInput").value.trim();
        const profilePic = document.getElementById("profilePicInput").value.trim();
        const coverPic = document.getElementById("coverPicInput").value.trim();

        if (!fullName) {
          alert("Full Name is required.");
          return;
        }
        if (!email) {
          alert("Email is required.");
          return;
        }
        function isValidEmailOrPhone(value) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const phoneRegex = /^\+\d{7,15}$/; // International format
  return emailRegex.test(value) || phoneRegex.test(value);
}

if (!isValidEmailOrPhone(email)) {
  alert("Please enter a valid email or international phone number (e.g. +94712345678).");
  return;
}


        try {
          // Update user in Firestore
          const userRef = doc(db, "users", currentUser.id);
          await updateDoc(userRef, {
            fullName,
            bio,
            birthday,
            gender,
            address,
            country,
           
            profilePic,
            coverPic,
          });

          // Update currentUser and localStorage
          currentUser = {
            ...currentUser,
            fullName,
            bio,
            birthday,
            gender,
            address,
            country,
            
            profilePic,
            coverPic,
          };
          localStorage.setItem("clidderUser", JSON.stringify(currentUser));

          alert("Profile updated successfully.");
          renderProfile();
        } catch (error) {
          alert("Error updating profile: " + error.message);
        }
      });
    }

    // Initialize UI state on load
    updateUIForUser();

    // Render who to follow and trends (unchanged)
    const whoToFollow = [
      {
        name: "Clidder",
        handle: "𝓬𝓹clidder",
        avatar:
          "https://i.ibb.co/0VqN92C4/clidder-off-dark.png",
      },
      {
        name: "Apple𝓬𝓹",
        handle: "𝓬𝓹appleinc",
        avatar:
          "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQUdOAh9FKCC6CszRyOE_tODjH_U_blkP5SwQ&s?text=B&font=roboto&font-weight=700&bg=ddd&fg=555",
      },
      {
        name: "Tesla𝓬𝓹",
        handle: "𝓬𝓹tesla",
        avatar:
          "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTFJP7X_crOPPYfdGyvHw8KhkxswWPubv8P4w&s?text=C&font=roboto&font-weight=700&bg=ddd&fg=555",
      },
    ];

    const trends = [
      { topic: "#InduwaraJayasinghe", tweets: "98.3K Cliddes" },
      { topic: "#Kavindu_Darshana", tweets: "96.7K Cliddes" },
      { topic: "#BlackHatInc", tweets: "93.1K Cliddes" },
      { topic: "#Windows", tweets: "93.4K Cliddes" },
      { topic: "#ClidderMarkets", tweets: "92.9K Cliddes" },
    ];

    function renderWhoToFollow() {
      const whoToFollowList = document.getElementById("whoToFollowList");
      whoToFollowList.innerHTML = "";
      whoToFollow.forEach((user) => {
        const li = document.createElement("li");
        li.className = "flex items-center space-x-3";

        const avatar = document.createElement("img");
        avatar.src = user.avatar;
        avatar.alt = `${user.name} avatar`;
        avatar.className = "w-10 h-10 rounded-full object-cover";

        const info = document.createElement("div");
        info.className = "flex flex-col";

        const name = document.createElement("span");
        name.className = "font-bold text-gray-900";
        name.textContent = user.name;

        const handle = document.createElement("span");
        handle.className = "text-gray-500 text-sm";
        handle.textContent = user.handle;

        info.appendChild(name);
        info.appendChild(handle);

        const followBtn = document.createElement("button");
        followBtn.className =
          "ml-auto bg-[#FF7D1E] text-white rounded-full px-3 py-1 text-sm font-semibold hover:bg-[#e6680f] transition";
        followBtn.textContent = "Follow";
        followBtn.addEventListener("click", () => {
          alert(`Followed ${user.name}`);
        });

        li.appendChild(avatar);
        li.appendChild(info);
        li.appendChild(followBtn);

        whoToFollowList.appendChild(li);
      });
    }

    function renderTrends() {
      const trendsList = document.getElementById("trendsList");
      trendsList.innerHTML = "";
      trends.forEach((trend) => {
        const li = document.createElement("li");
        li.className =
          "hover:bg-gray-100 rounded-md p-2 cursor-pointer transition flex flex-col";

        const topic = document.createElement("span");
        topic.className = "font-semibold text-gray-900";
        topic.textContent = trend.topic;

        const tweets = document.createElement("span");
        tweets.className = "text-gray-500 text-xs";
        tweets.textContent = trend.tweets;

        li.appendChild(topic);
        li.appendChild(tweets);

        li.addEventListener("click", () => {
          searchInput.value = trend.topic;
          searchInput.dispatchEvent(new Event("input"));
        });

        trendsList.appendChild(li);
      });
    }

    renderWhoToFollow();
    renderTrends();

    // Utility to close mobile menu
    function closeMobileMenu() {
      mobileMenu.classList.add("hidden");
    }

    // Mobile menu buttons
    document.getElementById("mobileBtnHome").addEventListener("click", () => {
      closeMobileMenu();
      renderFeed(posts);
    });
    document.getElementById("mobileBtnAddPost").addEventListener("click", () => {
      closeMobileMenu();
      if (!currentUser) {
        alert("Please sign in or create an account to add posts.");
        showAuthModal();
        return;
      }
      modalAddPost.classList.remove("hidden");
      postImageUrlInput.focus();
    });
    document.getElementById("mobileBtnProfile").addEventListener("click", () => {
      closeMobileMenu();
      if (!currentUser) {
        showAuthModal();
      } else {
        showProfileModal();
      }
    });
    document.getElementById("mobileBtnFavorites").addEventListener("click", () => {
      closeMobileMenu();
      showFavoritePosts();
    });

    // Other event listeners (home, favorites, profile, etc.)
    document.getElementById("btnHome").addEventListener("click", () => {
      renderFeed(posts);
    });
    btnFavorites.addEventListener("click", () => {
      showFavoritePosts();
    });

    // Modal close buttons
    btnCloseModal.addEventListener("click", () => {
      modalAddPost.classList.add("hidden");
      formAddPost.reset();
    });
    modalAddPost.addEventListener("click", (e) => {
      if (e.target === modalAddPost) {
        modalAddPost.classList.add("hidden");
        formAddPost.reset();
      }
    });
    btnMenu.addEventListener("click", () => {
      mobileMenu.classList.remove("hidden");
    });
    btnCloseMenu.addEventListener("click", () => {
      mobileMenu.classList.add("hidden");
    });

    // Form submit for adding post
    formAddPost.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!currentUser) {
        alert("Please sign in or create an account to add posts.");
        showAuthModal();
        return;
      }
      const imageUrl = postImageUrlInput.value.trim();
      const caption = postCaptionInput.value.trim();

      if (!imageUrl) {
        alert("Please enter an image URL.");
        return;
      }

      try {
        await addDoc(collection(db, "posts"), {
          imageUrl,
          caption,
          createdAt: serverTimestamp(),
          userId: currentUser.id,
          userName: currentUser.fullName,
          userHandle: "𝓬𝓹" + currentUser.username.toLowerCase(),
          profilePic: currentUser.profilePic || "",
verified: currentUser.verified || false,
premium: currentUser.premium || false,
pro: currentUser.pro || false,
company: currentUser.company || false,
AI: currentUser.AI || false,
Clidder: currentUser.Clidder || false,


          likes: [],
          retweets: [],
          replies: [],
        });
        formAddPost.reset();
        modalAddPost.classList.add("hidden");
      } catch (error) {
        alert("Error adding post: " + error.message);
      }
    });

    // New: Open search bar and focus input
    function openSearchBar() {
      // Scroll to top so header is visible on mobile
      window.scrollTo({ top: 0, behavior: "smooth" });
      searchInput.focus();
    }

    // Click on Explore button opens search bar
    sidebarExploreBtn.addEventListener("click", (e) => {
      e.preventDefault();
      openSearchBar();
    });

    // Keyboard shortcut: typing '/' focuses search input
    document.addEventListener("keydown", (e) => {
      // Ignore if input or textarea or contenteditable is focused
      const active = document.activeElement;
      if (
        active &&
        (active.tagName === "INPUT" ||
          active.tagName === "TEXTAREA" ||
          active.isContentEditable)
      ) {
        return;
      }
      if (e.key === "/") {
        e.preventDefault();
        openSearchBar();
      }
    });





// Dark/Light mode toggle logic
    const body = document.body;
    const sidebarToggleBtn = document.getElementById("sidebarModeToggle");
    const headerToggleBtn = document.getElementById("headerModeToggle");

    // Initialize mode from localStorage or default to light
    function initMode() {
      const savedMode = localStorage.getItem("clidderMode");
      if (savedMode === "dark") {
        enableDarkMode();
      } else {
        enableLightMode();
      }
    }

    function enableDarkMode() {
      body.classList.add("dark-mode");
      body.classList.remove("light-mode");
      updateToggleButtons(true);
      localStorage.setItem("clidderMode", "dark");
    }

    function enableLightMode() {
      body.classList.add("light-mode");
      body.classList.remove("dark-mode");
      updateToggleButtons(false);
      localStorage.setItem("clidderMode", "light");
    }

    function toggleMode() {
      if (body.classList.contains("dark-mode")) {
        enableLightMode();
      } else {
        enableDarkMode();
      }
    }

    function updateToggleButtons(isDark) {
      // Update sidebar button
      if (isDark) {
        sidebarToggleBtn.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
        headerToggleBtn.innerHTML = '<i class="fas fa-sun"></i><span class="hidden md:inline">Light Mode</span>';
      } else {
        sidebarToggleBtn.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
        headerToggleBtn.innerHTML = '<i class="fas fa-moon"></i><span class="hidden md:inline">Dark Mode</span>';
      }
    }

    sidebarToggleBtn.addEventListener("click", toggleMode);
    headerToggleBtn.addEventListener("click", toggleMode);

    // Initialize mode on page load
    initMode();



const scrollTopBtn = document.getElementById("scrollTopBtn");
  const centerContent = document.getElementById("centerContent");

  centerContent.addEventListener("scroll", () => {
    if (centerContent.scrollTop > 300) {
      scrollTopBtn.classList.remove("hidden");
    } else {
      scrollTopBtn.classList.add("hidden");
    }
  });

  scrollTopBtn.addEventListener("click", () => {
    centerContent.scrollTo({ top: 0, behavior: "smooth" });
  });

 window.addEventListener('DOMContentLoaded', () => {
    const usernames = document.querySelectorAll('.user-handle');
    usernames.forEach(el => {
      if (el.textContent.startsWith('𝓬𝓹')) {
        el.textContent = el.textContent.replace(/^𝓬𝓹/, '𝓬𝓹');
      }
    });
  });


    // The rest of your existing script code below...

    // ... (rest of your existing code remains unchanged)
  </script>


<script>
function wrapText(type, value = null) {
  const ta = document.getElementById("tweetInput");
  const start = ta.selectionStart;
  const end = ta.selectionEnd;
  const text = ta.value;
  const selected = text.substring(start, end);
  const before = text.substring(0, start);
  const after = text.substring(end);

  let wrapped = selected;

  switch (type) {
    case 'b': wrapped = `<b>${selected}</b>`; break;
    case 'i': wrapped = `<i>${selected}</i>`; break;
    case 'u': wrapped = `<u>${selected}</u>`; break;
    case 's': wrapped = `<s>${selected}</s>`; break;
    case 'mark': wrapped = `<mark>${selected}</mark>`; break;
    case 'color': wrapped = `<span style="color:${value}">${selected}</span>`; break;
    case 'size': wrapped = `<span style="font-size:${value}">${selected}</span>`; break;
    case 'font': wrapped = `<span style="font-family:'${value}'">${selected}</span>`; break;
    case 'align': wrapped = `<div style="text-align:${value}">${selected}</div>`; break;
    case 'sup': wrapped = `<sup>${selected}</sup>`; break;
    case 'sub': wrapped = `<sub>${selected}</sub>`; break;
    case 'line': wrapped = `<div style="line-height:${value}">${selected}</div>`; break;
    case 'code': wrapped = `<pre><code>${selected}</code></pre>`; break;
  }

  ta.value = before + wrapped + after;
  ta.focus();
  ta.selectionStart = ta.selectionEnd = before.length + wrapped.length;
}

function convertCase(type) {
  const ta = document.getElementById("tweetInput");
  const start = ta.selectionStart;
  const end = ta.selectionEnd;
  const selected = ta.value.substring(start, end);
  const converted = type === 'upper' ? selected.toUpperCase() : selected.toLowerCase();
  ta.setRangeText(converted, start, end, "end");
}

function insertList(style) {
  const ta = document.getElementById("tweetInput");
  const selected = ta.value.substring(ta.selectionStart, ta.selectionEnd);
  const lines = selected.split("\n").map(line => style === "bullet" ? `<li>${line}</li>` : `<li>${line}</li>`);
  const listTag = style === "bullet" ? "ul" : "ol";
  const result = `<${listTag}>\n${lines.join('\n')}\n</${listTag}>`;
  ta.setRangeText(result, ta.selectionStart, ta.selectionEnd, "end");
}

function clearFormat() {
  const ta = document.getElementById("tweetInput");
  const start = ta.selectionStart;
  const end = ta.selectionEnd;
  const selected = ta.value.substring(start, end);
  const stripped = selected.replace(/<\/?[^>]+(>|$)/g, "");
  ta.setRangeText(stripped, start, end, "end");
}

document.addEventListener("DOMContentLoaded", () => {
  const clickOrWarn = (id, actionName) => {
    const el = document.getElementById(id);
    if (el) el.click();
    else alert(`${actionName} not available or you're not signed in.`);
  };

  document.getElementById("mobileNavHome")?.addEventListener("click", () => {
    clickOrWarn("sidebarHome", "Home");
  });

  document.getElementById("mobileNavAdd")?.addEventListener("click", () => {
    clickOrWarn("btnAddPost", "Add Post");
  });

  document.getElementById("mobileNavFavs")?.addEventListener("click", () => {
    clickOrWarn("sidebarFavorites", "Favorites");
  });

  document.getElementById("mobileNavProfile")?.addEventListener("click", () => {
    clickOrWarn("btnProfileTop", "Profile");
  });

 document.getElementById("mobileNavClidders")?.addEventListener("click", () => {
    clickOrWarn("sidebarMore", "Clidders");
  });

  
 document.getElementById("mobileclips")?.addEventListener("click", () => {
    clickOrWarn("sidebarClips", "Clips");
  });

});

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(registration => {
        console.log('Service Worker registered with scope:', registration.scope);
      })
      .catch(error => {
        console.error('Service Worker registration failed:', error);
      });
  });
}



let deferredPrompt = null;

// Listen for beforeinstallprompt and save the event
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
});

// Handle install button click
document.getElementById('btnInstallPWA').addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const choiceResult = await deferredPrompt.userChoice;
    console.log(`User response to install prompt: ${choiceResult.outcome}`);
    deferredPrompt = null;
  } else {
    alert("Install prompt is not ready yet. Please try again later.");
  }
});





</script>

<!-- 📱 Mobile Bottom Navigation Bar -->
<nav id="mobileBottomNav" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around items-center h-12 z-50 md:hidden">
  <button id="mobileNavHome" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
      <span class="relative inline-block">
    <!-- Twitter-like home icon -->
    <svg viewBox="0 0 24 24" aria-hidden="true" class="w-6 h-6 fill-current">
      <path d="M22.58 12.42l-9-9a1.5 1.5 0 00-2.12 0l-9 9A1.5 1.5 0 003 14h1v7a1 1 0 001 1h5a1 1 0 001-1v-5h2v5a1 1 0 001 1h5a1 1 0 001-1v-7h1a1.5 1.5 0 001.08-2.58z"></path>
    </svg>

    <!-- Orange active dot -->
    <span class="absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full"></span>
  </span>
  <span class="text-base font-medium"></span>
  </button>
  
<button onclick="openMobileSearch()" class="text-xl text-gray-700 dark:text-white mr-2">
  <i class="fas fa-search"></i>
</button>


  <button id="mobileNavFavs" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
    <i class="fas fa-star text-xl"></i><span class="text-xs"></span>
  </button>

<button id="mobileclips" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
    <i class="fas fa-play-circle fa-lg"></i><span class="text-xs"></span>
  </button>

   <button id="mobileNavClidders" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
      <i class="fas fa-users text-lg"></i>
    </button>


  


  <!-- ☰ Menu Button -->
  <button onclick="toggleMobileSidebarMenu()" class="text-2xl text-gray-700 dark:text-white focus:outline-none">
    <i class="fas fa-ellipsis-h"></i>
  </button>

</nav>




<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDrFdwYhlj84GQ3eLzPctLgxZ572PHu7Tg",
    authDomain: "x-clone-d4697.firebaseapp.com",
    projectId: "x-clone-d4697",
    storageBucket: "x-clone-d4697.firebasestorage.app",
    messagingSenderId: "438425139174",
    appId: "1:438425139174:web:b1ebea6f124a245cf9c827",
    measurementId: "G-PLQBYNDKQM"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  // Get Messaging instance
  const messaging = firebase.messaging();

  // Ask for notification permission and get token
  messaging.requestPermission()
    .then(() => {
      console.log("🔔 Notification permission granted.");
      return messaging.getToken({
        vapidKey: "BM0BorMxQhF2Um-9nMjPzmIkhOOZtLa8yAGH1X5kHbJbCZfGTO2oOSYsdmMpxH2U1ncd5AquVz96AWug8jHcaGI"
      });
    })
    .then((token) => {
      console.log("✅ Registration Token:", token);
      // 👉 Copy this token and use it to send push notifications
      // You can save it to Firestore or your own database if needed
    })
    .catch((err) => {
      console.error("❌ Error getting token or permission denied:", err);
    });
</script>

<script>
  document.getElementById('mobileModeToggle').addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    document.body.classList.toggle('light-mode');
  });
</script>

<!-- ☰ Mobile Sidebar Menu -->
<div id="mobileSidebarMenu" class="fixed top-16 right-4 bg-white dark:bg-black shadow-lg rounded-lg z-50 p-4 w-64 space-y-3 hidden">
  <button id="mobileBtnMessages" class="w-full text-left text-gray-800 dark:text-white hover:text-[#FF7D1E]">
    <i class="fas fa-envelope mr-2"></i> Messages
  </button>
  <button id="mobileBtnSaved" class="w-full text-left text-gray-800 dark:text-white hover:text-[#FF7D1E]">
    <i class="fas fa-bookmark mr-2"></i> Saved
  </button>
  <button id="mobileBtnVerified" class="w-full text-left text-gray-800 dark:text-white hover:text-[#FF7D1E]">
    <i class="fas fa-check-circle mr-2"></i> Verified Clidders
  </button>
<!-- Mobile Favorites Button (Unique ID) -->
<button id="mobileSidebarFavorites" class="w-full text-left text-gray-800 dark:text-white hover:text-[#FF7D1E]">
  <i class="fas fa-star mr-2"></i> Favorites
</button>

  <button id="mobileBtnFromMe" class="w-full text-left text-gray-800 dark:text-white hover:text-[#FF7D1E]">
    <i class="fas fa-user-edit mr-2"></i> From Me
  </button>
  <button onclick="window.open('https://blackhatai.nicepage.io', '_blank')" class="w-full text-left text-gray-800 dark:text-white hover:text-[#FF7D1E]">
    <i class="fas fa-robot mr-2"></i> Black Hat AI
  </button>
</div>



<script>
  document.getElementById("mobileBtnMessages").addEventListener("click", () => {
    document.getElementById("sidebarMessages")?.click();
  });

  document.getElementById("mobileBtnSaved").addEventListener("click", () => {
    document.getElementById("sidebarBookmarks")?.click();
  });

  document.getElementById("mobileBtnVerified").addEventListener("click", () => {
    document.getElementById("sidebarLists")?.click();
  });

   document.getElementById("mobileSidebarFavorites").addEventListener("click", () => {
    document.getElementById("sidebarFavorites")?.click();
  });

  document.getElementById("mobileBtnFromMe").addEventListener("click", () => {
    document.getElementById("sidebarFromMe")?.click();
  });
</script>





<script>
  function toggleMobileSidebarMenu() {
    const menu = document.getElementById("mobileSidebarMenu");
    if (menu.classList.contains("hidden")) {
      menu.classList.remove("hidden");
    } else {
      menu.classList.add("hidden");
    }
  }

  function navigateTo(section) {
    alert("Navigate to: " + section); // Replace with real logic if needed
    document.getElementById("mobileSidebarMenu").classList.add("hidden");
  }

  // Optional: Hide menu if you click outside it
  document.addEventListener("click", function(event) {
    const menu = document.getElementById("mobileSidebarMenu");
    const toggleBtn = event.target.closest("button[onclick='toggleMobileSidebarMenu()']");
    if (!menu.contains(event.target) && !toggleBtn) {
      menu.classList.add("hidden");
    }
  });
</script>

<script>
  const sidebarClipsBtn = document.getElementById("sidebarClips");
  const clipsSection = document.getElementById("clipsSection");
  const centerContent = document.getElementById("centerContent");
  const clipsDisplay = document.getElementById("clipsDisplay");

  sidebarClipsBtn.addEventListener("click", () => {
    // Hide all children in #centerContent
    [...centerContent.children].forEach(child => {
      if (child !== clipsSection) {
        child.style.display = "none";
      }
    });

    // Clear previous clips
    clipsDisplay.innerHTML = "";

    // Find all <video> tags already in the DOM
    const existingVideos = document.querySelectorAll("video");

    existingVideos.forEach(video => {
      const clone = video.cloneNode(true);
clone.controls = false;   // Hide all native controls
clone.autoplay = false;
clone.muted = false;
clone.className = "w-full h-auto rounded shadow";

// Play video when clicked anywhere on the video element
clone.style.cursor = "pointer";  // Show pointer cursor on hover
clone.addEventListener("click", () => {
  if (clone.paused) {
    clone.play();
  } else {
    clone.pause();
  }
});


      const wrapper = document.createElement("div");
      wrapper.appendChild(clone);
      clipsDisplay.appendChild(wrapper);
    });

    clipsSection.classList.remove("hidden");
  });
</script>

<script>
  document.addEventListener('contextmenu', event => event.preventDefault());
</script>
<script>
  document.onkeydown = function (e) {
    if (e.key === "F12" || 
        (e.ctrlKey && e.shiftKey && e.key === "I") || 
        (e.ctrlKey && e.shiftKey && e.key === "J") || 
        (e.ctrlKey && e.key === "U")) {
      return false;
    }
  };
</script>
<script>
  setInterval(() => {
    if (window.devtools?.isOpen) {
      alert("Inspecting this page is not allowed.");
      window.location.href = "https://www.google.com";
    }
  }, 1000);
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.getElementById("mobileSearchToggle");
    const searchContainer = document.getElementById("mobileSearchContainer");
    const searchInput = document.getElementById("mobileSearchInput");

    toggleBtn?.addEventListener("click", function (e) {
      e.stopPropagation();
      const hidden = searchContainer.classList.contains("hidden");
      if (hidden) {
        searchContainer.classList.remove("hidden");
        setTimeout(() => searchInput.focus(), 100);
      } else {
        searchContainer.classList.add("hidden");
      }
    });

    document.addEventListener("click", function (e) {
      if (
        !e.target.closest("#mobileSearchContainer") &&
        !e.target.closest("#mobileSearchToggle")
      ) {
        searchContainer.classList.add("hidden");
      }
    });
  });
</script>


<!-- Pages Modal -->
<div id="pagesModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
  <div class="bg-white p-6 w-[90%] max-w-md shadow-xl relative">
    <button onclick="document.getElementById('pagesModal').classList.add('hidden')" 
            class="absolute top-2 right-3 text-gray-500 hover:text-red-600 text-xl font-bold">&times;</button>
    <h2 class="text-xl font-semibold mb-4">Pages</h2>
    <p>Here you can manage your pages.</p>
    <!-- Add your Pages content/tools here -->
  </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
  <div class="bg-white p-6 w-[90%] max-w-md shadow-xl relative">
    <button onclick="document.getElementById('settingsModal').classList.add('hidden')" 
            class="absolute top-2 right-3 text-gray-500 hover:text-red-600 text-xl font-bold">&times;</button>
    <h2 class="text-xl font-semibold mb-4">Settings</h2>
    <p>Here you can adjust your account settings.</p>
    <!-- Add your Settings options here -->
  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const video = entry.target;
      if (entry.isIntersecting) {
        video.play().catch(() => {});
      } else {
        video.pause();
      }
    });
  }, {
    threshold: 0.6
  });

  function setupVideoAutoplay() {
    const videos = document.querySelectorAll("video");
    videos.forEach(video => {
      video.muted = true;
      video.playsInline = true;
      video.setAttribute("autoplay", true);
      video.setAttribute("loop", true);

      // Unmute on user click
      video.addEventListener("click", () => {
        video.muted = false;
        video.volume = 1.0;
      });

      observer.observe(video);
    });
  }

  setupVideoAutoplay();

  // Watch for dynamically added videos
  const feed = document.getElementById("feed");
  if (feed) {
    const mutationObserver = new MutationObserver(setupVideoAutoplay);
    mutationObserver.observe(feed, { childList: true, subtree: true });
  }
});
</script>

<div id="themeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white p-6 rounded-lg shadow-lg space-y-4 text-center">
    <h2 class="text-xl font-bold">Pick a Theme Color</h2>
    <input type="color" id="colorPicker" class="w-24 h-12 border rounded" />
    <div class="space-x-4">
      <button id="applyThemeBtn" class="px-4 py-2 bg-[#FF7D1E] text-white rounded">Apply</button>
      <button id="resetThemeBtn" class="px-4 py-2 bg-gray-300 rounded">Reset</button>
    </div>
  </div>
</div>
<script>
  const sidebarThemeBtn = document.getElementById("sidebarTheme");
  const themeModal = document.getElementById("themeModal");
  const colorPicker = document.getElementById("colorPicker");
  const applyThemeBtn = document.getElementById("applyThemeBtn");
  const resetThemeBtn = document.getElementById("resetThemeBtn");

  const elementsToTheme = [
    document.body,
    document.getElementById("leftSidebar"),
    document.getElementById("rightSidebar"),
    document.getElementById("centerContent")
  ];

  // Load saved theme
  window.addEventListener("DOMContentLoaded", () => {
    const savedColor = localStorage.getItem("customThemeColor");
    if (savedColor) applyTheme(savedColor);
  });

  sidebarThemeBtn.addEventListener("click", () => {
    themeModal.classList.remove("hidden");
  });

  themeModal.addEventListener("click", (e) => {
    if (e.target === themeModal) {
      themeModal.classList.add("hidden");
    }
  });

  applyThemeBtn.addEventListener("click", () => {
    const color = colorPicker.value;
    applyTheme(color);
    localStorage.setItem("customThemeColor", color);
    themeModal.classList.add("hidden");
  });

  resetThemeBtn.addEventListener("click", () => {
    localStorage.removeItem("customThemeColor");
    elementsToTheme.forEach(el => el.style.backgroundColor = "");
    themeModal.classList.add("hidden");
  });

  function applyTheme(color) {
    elementsToTheme.forEach(el => el.style.backgroundColor = color);
  }


function getVerifiedHTML(verified) {
  return verified
    ? `<img src="https://upload.wikimedia.org/wikipedia/commons/e/e4/Twitter_Verified_Badge.svg"
             alt="Verified Badge"
             class="verified-badge" />`
    : "";
}


function getPremiumHTML(isPremium) {
  return isPremium === true
    ? ' <img src="https://upload.wikimedia.org/wikipedia/commons/d/d8/Orange-verified-sign-and-tick-18752.svg" class="premium-badge" alt="Premium">'
    : '';
}

function getProHTML(pro) {
  return pro === true
    ? `<img src="https://upload.wikimedia.org/wikipedia/commons/b/be/Verified-badge-pink.svg" class="pro-badge" alt="Pro">`
    : "";
}

function getCompanyHTML(company) {
  return company === true
    ? `<img src="https://upload.wikimedia.org/wikipedia/commons/archive/8/81/20230122072306%21Twitter_Verified_Badge_Gold.svg" class="company-badge" alt="Company">`
    : "";
}

function getAIHTML(isAI) {
  return isAI === true
    ? `<img src="https://upload.wikimedia.org/wikipedia/commons/a/af/Light-green-verified-sign-and-tick-18748.svg" class="ai-badge" alt="AI">`
    : "";
}

function getClidderHTML(isClidder) {
  return isClidder === true
    ? `<img src="https://upload.wikimedia.org/wikipedia/commons/4/49/Clidder.svg" class="clidder-badge" alt="Clidder">`
    : "";
}



</script>

<script>
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

  const auth = getAuth();
  const db = getFirestore();

  const currentUserPicEl = document.getElementById("currentUserPic");

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const userRef = doc(db, "users", user.uid);
      const userSnap = await getDoc(userRef);
      if (userSnap.exists()) {
        const data = userSnap.data();
        if (data.profilePic) {
          currentUserPicEl.src = data.profilePic;
        }
      }
    }
  });
</script>

<script>

const tabForYou = document.getElementById("tabForYou");
const tabFollowing = document.getElementById("tabFollowing");

function activateTab(tab) {
  tabForYou.classList.remove("text-[#FF7D1E]", "border-blue-500");
  tabFollowing.classList.remove("text-[#FF7D1E]", "border-blue-500");

  tab.classList.add("text-[#FF7D1E]", "border-blue-500");

  // You can replace this with actual filtering logic
  if (tab.id === "tabForYou") {
    console.log("Showing For You feed");
    // fetchAndRenderForYouPosts();
  } else {
    console.log("Showing Following feed");
    // fetchAndRenderFollowingPosts();
  }
}

tabForYou.addEventListener("click", () => activateTab(tabForYou));
tabFollowing.addEventListener("click", () => activateTab(tabFollowing));

// Default to For You
activateTab(tabForYou);


</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const header = document.querySelector("header");
    if (header) header.style.display = "none";
  });
</script>


<script type="module">
  // Make sure Firebase is imported already in your index.html
  import { getDocs, collection } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
  import { db } from "./your-firebase-config.js"; // adapt if db is already initialized

  const userSearchInput = document.getElementById("userSearchInput");

  let usersById = {}; // uid → { fullName, userName }

  async function loadUsers() {
    const usersSnapshot = await getDocs(collection(db, "users"));
    usersSnapshot.forEach(doc => {
      const data = doc.data();
      usersById[doc.id] = {
        fullName: (data.fullName || "").toLowerCase(),
        userName: (data.userName || "").toLowerCase(),
      };
    });
  }

  function filterPostsBySearch(searchTerm) {
    const term = searchTerm.toLowerCase();

    const filtered = posts.filter(post => {
      const user = usersById[post.uid] || {};
      return (
        (user.fullName || "").includes(term) ||
        (user.userName || "").includes(term) ||
        (post.caption || "").toLowerCase().includes(term) ||
        (post.imageUrl || "").toLowerCase().includes(term)
      );
    });

    renderPosts(filtered);
  }

  userSearchInput.addEventListener("input", (e) => {
    const term = e.target.value.trim();
    if (!term) {
      renderPosts(posts);
    } else {
      filterPostsBySearch(term);
    }
  });

  // load users on first run
  loadUsers();
</script>

<script>

const charCount = document.getElementById("charCount");
tweetInput.addEventListener("input", () => {
  charCount.textContent = `${tweetInput.value.length} / 100000`;
  btnSubmitTweet.disabled = tweetInput.value.length === 0 || tweetInput.value.length > 100000;
});

</script>






<!-- SETTINGS MODAL -->
<div id="modalSettings" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white dark:bg-gray-900 p-6 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-lg border border-gray-300 dark:border-gray-700">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-900 dark:text-white">Settings</h2>
    <ul class="flex justify-around text-sm font-semibold text-gray-700 dark:text-gray-300 border-b pb-4 mb-4">
      <li class="cursor-pointer px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800" onclick="toggleSettingSection('accessibilitySettings')">Accessibility</li>
      <li class="cursor-pointer px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800" onclick="toggleSettingSection('displaySettings')">Display</li>
      <li class="cursor-pointer px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800" onclick="toggleSettingSection('languageSettings')">Languages</li>
      <li class="cursor-pointer px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800" onclick="toggleSettingSection('dataSettings')">Data Usage</li>
      <li class="cursor-pointer px-3 py-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800" onclick="toggleSettingSection('keyboardSettings')">Shortcuts</li>
    </ul>

    <!-- Accessibility -->
    <div id="accessibilitySettings" class="hidden text-sm text-gray-800 dark:text-gray-200">
      <h3 class="text-lg font-semibold mb-2">Accessibility</h3>
      <p class="mb-4">Manage aspects of your Clidder experience such as limiting color contrast and motion. These settings affect all the Clidder accounts on this browser.</p>
      <div class="space-y-3">
        <div>
          <h4 class="font-semibold">Vision</h4>
          <label class="block">
            <input type="checkbox" id="highContrast" class="mr-2"> Increase color contrast
          </label>
        </div>
        <div>
          <h4 class="font-semibold">Motion</h4>
          <label class="block">
            <input type="checkbox" id="reduceMotion" class="mr-2"> Reduce motion
          </label>
        </div>
        <div>
          <h4 class="font-semibold">Media</h4>
          <label class="block">
            <input type="checkbox" id="imageReminder" class="mr-2"> Receive image description reminder
          </label>
        </div>
        <a href="https://help.twitter.com/en/rules-and-policies/twitter-accessibility" target="_blank" class="text-[#FF7D1E] hover:underline text-xs">Learn more about accessibility at X</a>
      </div>
    </div>

    <!-- Display -->
    <div id="displaySettings" class="hidden text-sm text-gray-800 dark:text-gray-200">
      <h3 class="text-lg font-semibold mb-2">Display</h3>
      <p class="mb-4">Manage your font size, color, and background. These settings affect all the Clidder accounts on this browser.</p>
      <div class="space-y-4">
        <div>
          <label class="block font-medium mb-1">Font Size</label>
          <select id="fontSize" class="w-full border rounded p-2">
            <option value="small">Aa Small</option>
            <option value="medium">Aa Medium</option>
            <option value="large">Aa Large</option>
          </select>
        </div>
        <div>
          <label class="block font-medium mb-1">Color Theme</label>
          <select id="colorTheme" class="w-full border rounded p-2">
            <option value="blue">Blue</option>
            <option value="purple">Purple</option>
            <option value="green">Green</option>
		<option value="orange">Orange</option>
	        <option value="pink">Pink</option>
		<option value="teal">Teal</option>
		<option value="red">red</option>
		<option value="indigo">Indigo</option>
		<option value="yellow">Yellow</option>
		<option value="brown">Brown</option>
		<option value="cyan">Cyan</option>
		<option value="lime">Lime</option>
		<option value="gray">Gray</option>
          </select>
        </div>
        <div>
          <label class="block font-medium mb-1">Background</label>
          <select id="backgroundTheme" class="w-full border rounded p-2">
            <option value="default">Default</option>
            <option value="dim">Dim</option>
            <option value="lightsOut">Lights Out</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Languages -->
    <div id="languageSettings" class="hidden text-sm text-gray-800 dark:text-gray-200">
      <h3 class="text-lg font-semibold mb-2">Languages</h3>
      <p class="mb-4">Manage which languages are used to personalize your Clidder experience.</p>
      <div class="space-y-3">
        <div>
          <label class="block font-medium mb-1">Display Language</label>
          <select id="displayLanguage" class="w-full border rounded p-2">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
          </select>
        </div>
        <div>
          <label class="block font-medium mb-1">Additional Languages</label>
          <input type="text" id="additionalLanguages" placeholder="e.g., German, Japanese" class="w-full border rounded p-2">
        </div>
      </div>
    </div>

    <!-- Data Usage -->
    <div id="dataSettings" class="hidden text-sm text-gray-800 dark:text-gray-200">
      <h3 class="text-lg font-semibold mb-2">Data Usage</h3>
      <p class="mb-4">Limit how Clidder uses some of your network data on this device.</p>
      <label class="block mb-2">
        <input type="checkbox" id="dataSaver" class="mr-2"> Data saver
      </label>
      <label class="block font-medium mb-1">Autoplay</label>
      <select id="autoplay" class="w-full border rounded p-2">
        <option value="wifi">On Wi-Fi only</option>
        <option value="always">On cellular or Wi-Fi</option>
        <option value="never">Never</option>
      </select>
    </div>

    <!-- Keyboard Shortcuts -->
    <div id="keyboardSettings" class="hidden text-sm text-gray-800 dark:text-gray-200">
      <h3 class="text-lg font-semibold mb-2">Keyboard Shortcuts</h3>
      <ul class="space-y-1 text-sm">
        <li><strong>?</strong>: Shortcut help</li>
        <li><strong>j</strong>: Next post</li>
        <li><strong>k</strong>: Previous post</li>
        <li><strong>g + h</strong>: Home</li>
        <li><strong>g + p</strong>: Profile</li>
        <li><strong>n</strong>: New post</li>
        <li><strong>Ctrl + Enter</strong>: Send post</li>
        <li><strong>/</strong>: Search</li>
      </ul>
    </div>

    <!-- Save + Close -->
    <div class="flex justify-end mt-6 space-x-2">
      <button id="saveSettings" class="bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-lg">Save</button>
      <button id="closeModalSettings" class="bg-red-500 hover:bg-red-600 text-white px-5 py-2 rounded-lg">Close</button>
    </div>
  </div>
</div>

<script>
  function toggleSettingSection(id) {
    ['accessibilitySettings', 'displaySettings', 'languageSettings', 'dataSettings', 'keyboardSettings'].forEach(sec => {
      document.getElementById(sec).classList.add('hidden');
    });
    document.getElementById(id).classList.remove('hidden');
  }

  document.getElementById("sidebarSettings").addEventListener("click", () => {
    document.getElementById("modalSettings").classList.remove("hidden");
    loadSettings();
  });

  document.getElementById("closeModalSettings").addEventListener("click", () => {
    document.getElementById("modalSettings").classList.add("hidden");
  });

  document.getElementById("saveSettings").addEventListener("click", () => {
    const settings = {
      highContrast: document.getElementById("highContrast").checked,
      reduceMotion: document.getElementById("reduceMotion").checked,
      imageReminder: document.getElementById("imageReminder").checked,
      fontSize: document.getElementById("fontSize").value,
      colorTheme: document.getElementById("colorTheme").value,
      backgroundTheme: document.getElementById("backgroundTheme").value,
      displayLanguage: document.getElementById("displayLanguage").value,
      additionalLanguages: document.getElementById("additionalLanguages").value,
      dataSaver: document.getElementById("dataSaver").checked,
      autoplay: document.getElementById("autoplay").value
    };
    localStorage.setItem("clidderSettings", JSON.stringify(settings));
    applySettings(settings);
    alert("Settings saved!");
    document.getElementById("modalSettings").classList.add("hidden");
  });

  document.getElementById("resetSettings").addEventListener("click", () => {
    localStorage.removeItem("clidderSettings");
    location.reload();
  });

  function loadSettings() {
    const s = JSON.parse(localStorage.getItem("clidderSettings"));
    if (!s) return;
    document.getElementById("highContrast").checked = s.highContrast;
    document.getElementById("reduceMotion").checked = s.reduceMotion;
    document.getElementById("imageReminder").checked = s.imageReminder;
    document.getElementById("fontSize").value = s.fontSize;
    document.getElementById("colorTheme").value = s.colorTheme;
    document.getElementById("backgroundTheme").value = s.backgroundTheme;
    document.getElementById("displayLanguage").value = s.displayLanguage;
    document.getElementById("additionalLanguages").value = s.additionalLanguages;
    document.getElementById("dataSaver").checked = s.dataSaver;
    document.getElementById("autoplay").value = s.autoplay;
  }

  function applySettings(s) {
    document.body.classList.remove("light-mode", "dark-mode");
    if (s.backgroundTheme === "lightsOut") {
      document.body.classList.add("dark-mode");
    } else {
      document.body.classList.add("light-mode");
    }

    const center = document.getElementById('centerContent');
    if (center) {
      center.classList.remove("font-small", "font-medium", "font-large");
      center.classList.add(`font-${s.fontSize}`);

      const elements = center.querySelectorAll('*');
      elements.forEach(el => {
        el.classList.remove(
          "theme-blue", "theme-purple", "theme-green", "theme-orange",
          "theme-pink", "theme-teal", "theme-red", "theme-indigo",
          "theme-yellow", "theme-brown", "theme-cyan", "theme-lime", "theme-gray"
        );
        el.classList.add(`theme-${s.colorTheme}`);
      });
    }

    document.body.style.filter = s.highContrast ? "contrast(1.2)" : "";
    document.body.style.setProperty('scroll-behavior', s.reduceMotion ? 'auto' : 'smooth');
  }

  window.addEventListener("DOMContentLoaded", () => {
    const s = JSON.parse(localStorage.getItem("clidderSettings"));
    if (s) applySettings(s);
  });
</script>

<style>
  #centerContent.font-small { font-size: 0.45rem; }
  #centerContent.font-medium { font-size: 0.65rem; }
  #centerContent.font-large { font-size: 5.25rem; }

  .theme-blue { color: #1e40af !important; }
  .theme-purple { color: #6b21a8 !important; }
  .theme-green { color: #15803d !important; }
  .theme-orange { color: #c2410c !important; }
  .theme-pink { color: #be185d !important; }
  .theme-teal { color: #0f766e !important; }
  .theme-red { color: #b91c1c !important; }
  .theme-indigo { color: #4338ca !important; }
  .theme-yellow { color: #ca8a04 !important; }
  .theme-brown { color: #78350f !important; }
  .theme-cyan { color: #155e75 !important; }
  .theme-lime { color: #4d7c0f !important; }
  .theme-gray { color: #374151 !important; }
</style>



<script>
  document.addEventListener("DOMContentLoaded", () => {
    const splash = document.getElementById("splashScreen");
    const splashImage = document.getElementById("splashImage");
    const isDark = document.body.classList.contains("dark-mode");

    // Set image and background based on theme
    if (isDark) {
      splash.style.backgroundColor = "#000";
      splashImage.src = "https://i.ibb.co/HDNMpNL5/clidder-new-icon.png";
    } else {
      splash.style.backgroundColor = "#fff";
      splashImage.src = "https://i.ibb.co/HDNMpNL5/clidder-new-icon.png";
    }

    // Hide splash after 3 seconds
    setTimeout(() => {
      splash.style.display = "none";
    }, 2000);
  });
</script>


<!-- Floating Add Button for Mobile -->
<button id="mobileAddPostBtn" aria-label="Add new hat" class="fixed bottom-16 right-5 bg-[#e6680f] text-white p-4 rounded-full shadow-lg text-2xl z-50 md:hidden">
  <i class="fas fa-plus"></i>
</button>

<script>

document.getElementById("mobileAddPostBtn").addEventListener("click", () => {
  document.getElementById("modalAddPost").classList.remove("hidden");
});

</script>
<script>
  const tweetInput = document.getElementById('tweetInput');

  tweetInput.addEventListener('input', () => {
    tweetInput.style.height = 'auto'; // Reset height
    tweetInput.style.height = tweetInput.scrollHeight + 'px'; // Adjust height
  });

  // Optional: Trigger resize on page load
  window.addEventListener('load', () => {
    tweetInput.style.height = tweetInput.scrollHeight + 'px';
  });
</script>


<script>
  const replyBtn = document.getElementById('replySettingBtn');
  const replyPopover = document.getElementById('replyPopover');
  const usernameInput = document.getElementById('allowedUsernames');
  const replyItems = document.querySelectorAll('.reply-option-item');

  let currentPermission = "everyone";

  const permissionLabels = {
    everyone: '<div class="w-5 h-5 rounded-full bg-blue-100 text-[#FF7D1E] flex items-center justify-center"><i class="fas fa-globe-americas text-xs"></i></div> Everyone can reply',
    followers: '<div class="w-5 h-5 rounded-full bg-blue-100 text-[#FF7D1E] flex items-center justify-center"><i class="fas fa-user-friends text-xs"></i></div> People you follow can reply',
    verified: '<div class="w-5 h-5 rounded-full bg-blue-100 text-[#FF7D1E] flex items-center justify-center"><i class="fas fa-check-circle text-xs"></i></div> Verified users can reply',
    custom: '<div class="w-5 h-5 rounded-full bg-blue-100 text-[#FF7D1E] flex items-center justify-center"><i class="fas fa-lock text-xs"></i></div> Only specific users'
  };

  // Toggle the popover
  replyBtn.addEventListener('click', () => {
    replyPopover.classList.toggle('hidden');
  });

  // Handle selection
  replyItems.forEach(item => {
    item.addEventListener('click', () => {
      currentPermission = item.getAttribute('data-value');
      replyBtn.innerHTML = permissionLabels[currentPermission];
      replyPopover.classList.add('hidden');
      if (currentPermission === 'custom') {
        usernameInput.classList.remove('hidden');
      } else {
        usernameInput.classList.add('hidden');
      }
    });
  });

  // Function to retrieve settings when posting
  function getReplySettings() {
    return {
      permission: currentPermission,
      allowedUsers:
        currentPermission === 'custom'
          ? usernameInput.value.split(',').map(u => u.trim().toLowerCase()).filter(Boolean)
          : []
    };
  }

  // 🔁 Example usage in your Firestore Clidde submit
  // const { permission, allowedUsers } = getReplySettings();
  // await addDoc(..., { replyPermission: permission, allowedUsers })
</script>

<script>
function showLoadingSpinner() {
  document.getElementById('infiniteScrollLoader').style.display = 'flex';
}

function hideLoadingSpinner() {
  document.getElementById('infiniteScrollLoader').style.display = 'none';
}


</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const emojiToggle = document.getElementById('emojiToggle');
  const emojiPicker = document.getElementById('emojiPicker');
  const tweetInput = document.getElementById('tweetInput');

  const emojis = [
    "😀", "😃", "😄", "😁", "😆", "😅", "😂", "🤣", "😊", "😇",
    "🙂", "🙃", "😉", "😌", "😍", "🥰", "😘", "😗", "😙", "😚",
    "😋", "😛", "😝", "😜", "🤪", "🤨", "🧐", "🤓", "😎", "🥸",
    "🤩", "🥳", "😏", "😒", "😞", "😔", "😟", "😕", "🙁", "☹️",
    "😣", "😖", "😫", "😩", "🥺", "😢", "😭", "😤", "😠", "😡",
    "🤬", "🤯", "😳", "🥵", "🥶", "😱", "😨", "😰", "😥", "😓",
    "🤗", "🤔", "🤭", "🤫", "🤥", "😶", "😐", "😑", "😬", "🙄",
    "😯", "😦", "😧", "😮", "😲", "🥱", "😴", "🤤", "😪", "😵",
    "🤐", "🥴", "🤢", "🤮", "🤧", "😷", "🤒", "🤕", "🤑", "🤠",
    "😈", "👿", "👹", "👺", "💀", "☠️", "👻", "👽", "👾", "🤖",
    "💩", "😺", "😸", "😹", "😻", "😼", "😽", "🙀", "😿", "😾",
    "🙈", "🙉", "🙊", "💋", "💌", "💘", "💝", "💖", "💗", "💓",
    "💞", "💕", "💟", "❣️", "❤️", "🧡", "💛", "💚", "💙", "💜",
    "🤎", "🖤", "🤍", "💔", "❤️‍🔥", "❤️‍🩹", "💯", "💢", "💥", "💫",
    "💦", "💨", "🕳️", "👂", "👃", "🧠", "🫀", "🫁", "🦷", "🦴",
    "👀", "👁️", "👅", "👄", "🫦", "💋", "👶", "🧒", "👦", "👧",
    "🧑", "👱", "👨", "👩", "🧔", "👨‍🦰", "👨‍🦱", "👨‍🦳", "👨‍🦲", "👩‍🦰",
    "👩‍🦱", "👩‍🦳", "👩‍🦲", "🧓", "👴", "👵", "🙍", "🙎", "🙅", "🙆",
    "💁", "🙋", "🧏", "🙇", "🤦", "🤷", "🧑‍⚕️", "🧑‍🎓", "🧑‍🏫", "🧑‍⚖️",
    "🧑‍🌾", "🧑‍🍳", "🧑‍🔧", "🧑‍🏭", "🧑‍💼", "🧑‍🔬", "🧑‍🎤", "🧑‍🎨", "🧑‍✈️", "🧑‍🚀",
    "🧑‍🚒", "👮", "🕵️", "💂", "👷", "🤴", "👸", "👳", "👲", "🧕",
    "🤵", "👰", "🤰", "🤱", "👼", "🎅", "🤶", "🧑‍🎄", "🦸", "🦹",
    "🧙", "🧚", "🧛", "🧜", "🧝", "🧞", "🧟", "💃", "🕺", "🕴️",
    "🚶", "🏃", "💪", "🦵", "🦶", "👂", "🦻", "👃", "👣", "🫶",
    "👍", "👎", "👊", "✊", "🤛", "🤜", "👏", "🙌", "👐", "🤲",
    "🤝", "🙏", "✍️", "💅", "🤳", "💍", "💄", "💼", "👓", "🕶️",
    "🌂", "☂️", "🎩", "🧢", "👒", "🎓", "⛑️", "📿", "💎", "🔍",
    "📱", "📲", "💻", "🖥️", "🖨️", "🕹️", "🗜️", "💽", "💾", "💿",
    "📀", "📷", "📸", "📹", "🎥", "📞", "☎️", "📟", "📠", "📺",
    "📻", "🎙️", "🎚️", "🎛️", "🧭", "⏱️", "⏲️", "⏰", "🕰️", "⌛",
    "⏳", "📡", "🔋", "🔌", "💡", "🔦", "🕯️", "🧯", "🛢️", "💸",
    "💵", "💴", "💶", "💷", "💰", "💳", "🧾", "💎", "⚖️", "🔧",
    "🔨", "⚒️", "🛠️", "⛏️", "🔩", "⚙️", "🗜️", "⚗️", "🧪", "🧫",
    "🧬", "🔬", "🔭", "📡", "💉", "🩸", "💊", "🩹", "🩺", "🚪",
    "🛏️", "🛋️", "🪑", "🚽", "🚿", "🛁", "🪒", "🧴", "🧷", "🧹",
    "🧺", "🧻", "🪠", "🧼", "🪥", "🧽", "🛒", "🚬", "⚰️", "⚱️",
    "🏺", "🕳️", "🪦", "🧿", "🪬", "📿", "🪞", "🪟", "🛍️", "📦"
  ];

  // Populate emoji picker
  emojis.forEach(emoji => {
    const btn = document.createElement('button');
    btn.textContent = emoji;
    btn.className = 'emoji-button';
    btn.style.margin = '4px';
    btn.style.fontSize = '20px';
    btn.style.background = 'transparent';
    btn.style.border = 'none';
    btn.style.cursor = 'pointer';

    btn.addEventListener('click', () => {
      const start = tweetInput.selectionStart;
      const end = tweetInput.selectionEnd;
      const text = tweetInput.value;
      tweetInput.value = text.slice(0, start) + emoji + text.slice(end);
      tweetInput.focus();
      tweetInput.setSelectionRange(start + emoji.length, start + emoji.length);
    });

    emojiPicker.appendChild(btn);
  });

  // Show/hide emoji panel
  emojiToggle.addEventListener('click', (e) => {
    e.stopPropagation();
    emojiPicker.classList.toggle('hidden');
  });

  // Hide if clicked outside
  document.addEventListener('click', function (e) {
    if (!emojiPicker.contains(e.target) && e.target !== emojiToggle) {
      emojiPicker.classList.add('hidden');
    }
  });
});
</script>


<style>
  .emoji-button:hover {
    transform: scale(1.2);
  }
</style>





<!-- Fullscreen Image Modal -->
<div id="imageModal" class="fixed inset-0 z-50 bg-black bg-opacity-80 hidden items-center justify-center">
  <span class="absolute top-4 right-6 text-white text-2xl cursor-pointer" onclick="closeImageModal()">&times;</span>
  <img id="modalImage" src="" alt="Enlarged" class="max-w-full max-h-full rounded shadow-lg" />
</div>



<script>
  // Open modal with clicked image
  document.addEventListener("click", function (e) {
    if (e.target.tagName === "IMG" && e.target.closest("#centerContent")) {
      const src = e.target.src;
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      modalImg.src = src;
      modal.classList.add("show");
    }
  });

  // Close modal
  function closeImageModal() {
    const modal = document.getElementById("imageModal");
    modal.classList.remove("show");
  }

  // Close modal on outside click
  document.getElementById("imageModal").addEventListener("click", function (e) {
    if (e.target.id === "imageModal") {
      closeImageModal();
    }
  });
</script>

<script>
  const headerMoreBtn = document.getElementById('headerMoreBtn');
  const headerMoreDropdown = document.getElementById('headerMoreDropdown');

  headerMoreBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent outside click from closing instantly
    headerMoreDropdown.classList.toggle('hidden');
  });

  document.addEventListener('click', () => {
    headerMoreDropdown.classList.add('hidden');
  });
</script>


<script>
  const dropdownToggle = document.getElementById('dropdownModeToggle');

  function applyDarkModeState() {
    const isDark = document.body.classList.contains('dark-mode');
    const icon = dropdownToggle.querySelector('i');
    dropdownToggle.querySelector('span').textContent = isDark ? 'Light Mode' : 'Dark Mode';
    icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
  }

  dropdownToggle?.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    document.body.classList.toggle('light-mode');
    localStorage.setItem('clidderTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    applyDarkModeState();
  });

  window.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('clidderTheme') || 'light';
    document.body.classList.remove('light-mode', 'dark-mode');
    document.body.classList.add(`${savedTheme}-mode`);
    applyDarkModeState();
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const badgeSel =
    '.verified-badge, .premium-badge, .pro-badge, .company-badge, .ai-badge, .clidder-badge';

  /* initial sweep */
  hardenBadges();

  /* keep sweeping as the feed grows */
  new MutationObserver(hardenBadges).observe(
    document.getElementById('centerContent'),
    { childList: true, subtree: true }
  );

  function hardenBadges() {
    document.querySelectorAll(badgeSel).forEach(badge => {
      badge.style.pointerEvents = 'none';
      badge.style.userSelect    = 'none';
      badge.style.webkitUserSelect = 'none';
    });
  }
});
</script>


<script>
(() => {
  /* Schemes we want to tint */
  const PROTOCOLS = [
    'https:',   // you can add 'https:' here if you decide you want it too
    'http:',
    'mailto:',
    'tel:',
    '𝓬𝓹',
    '@',
    '#', 
    'file:',
    'ws:',
    'data:'
  ];

  /* Build one regex that matches a word starting with any of those schemes */
  const schemeRegex = new RegExp(
    `(^|[\\s>])((?:${PROTOCOLS.map(p => p.replace(':', '\\:')).join('|')})[^\\s<]*)`,
    'gi'
  );

  /* Paint every .post-content block that’s already on the page */
  function paint(container = document) {
    container.querySelectorAll('.post-content').forEach(el => {
      // Skip if we already processed it
      if (el.dataset.schemePainted) return;

      el.innerHTML = el.innerHTML.replace(
        schemeRegex,
        (_, pre, match) => `${pre}<span class="protocol-link">${match}</span>`
      );

      el.dataset.schemePainted = 'true';
    });
  }

  /* Initial run */
  paint();

  /* Keep watching: highlight links in posts that arrive later (infinite scroll, etc.) */
  const feed = document.getElementById('feed');
  if (feed) {
    new MutationObserver(() => paint()).observe(feed, {
      childList: true,
      subtree:  true
    });
  }
})();
</script>


<script>

function showFocusedPost(post, postId) {
  const feed = document.getElementById("feed");
  feed.innerHTML = ""; // Clear the feed

  // Back button
  const backBtn = document.createElement("button");
  backBtn.textContent = "← Back to feed";
  backBtn.className = "mb-4 px-3 py-2 text-sm rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600";
  backBtn.onclick = () => {
    feed.innerHTML = "";
    renderFeed(filteredPosts || posts); // Your existing render function
  };
  feed.appendChild(backBtn);

  // Show the selected post
  const postElement = renderPost(post, postId); // Your existing post renderer
  feed.appendChild(postElement);

  // Show replies (if any)
  const replyContainer = document.createElement("div");
  replyContainer.className = "mt-4 space-y-2";

  if (post.replies && post.replies.length) {
    post.replies
      .sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt)) // Oldest first
      .forEach((reply) => {
        const replyEl = document.createElement("div");
        replyEl.className = "p-3 border rounded-lg bg-white dark:bg-gray-800";
        const profilePicUrl = reply.profilePic?.trim()
  ? reply.profilePic
  : `https://placehold.co/36x36/png?text=${reply.userName?.charAt(0) || 'U'}`;

replyEl.innerHTML = `
  <div class="flex items-start gap-3">
    <img src="${profilePicUrl}" alt="${reply.userName}" class="w-9 h-9 rounded-full object-cover mt-1" />
    <div>
      <div class="inline-flex items-center font-semibold gap-1">
        ${reply.userName || "Anonymous"}
        ${getPremiumHTML?.(reply.premium)}
        ${getVerifiedHTML?.(reply.verified)}
        ${getProHTML?.(reply.pro)}
        ${getCompanyHTML?.(reply.company)}
        ${getAIHTML?.(reply.AI)}
        ${getClidderHTML?.(reply.Clidder)}
      </div>
      <div class="text-sm text-gray-700 dark:text-gray-300">${convertUrlsToLinks(reply.text)}</div>
    </div>
  </div>
`;

        replyContainer.appendChild(replyEl);
      });
  } else {
    replyContainer.innerHTML = '<p class="text-sm text-gray-500 mt-2">No comments yet.</p>';
  }

  feed.appendChild(replyContainer);
}

// Add click behavior to every post after it's rendered
const originalRenderPost = renderPost;
renderPost = function (post, id) {
  const postEl = originalRenderPost(post, id);
  postEl.addEventListener("click", (e) => {
    if (!e.target.closest(".tweet-action-btn") && !e.target.closest("button")) {
      showFocusedPost(post, id);
    }
  });
  return postEl;
};



</script>

<script>
  document.addEventListener('keydown', function (e) {
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    const ctrl = e.ctrlKey;
    const shift = e.shiftKey;
    const alt = e.altKey;
    const cmd = e.metaKey;
    const key = e.key.toLowerCase();

    const combos = [
      (ctrl && key === 'u'),                           // Ctrl + U
      (isMac && cmd && alt && key === 'u'),           // Cmd + Option + U

      (ctrl && shift && key === 'i'),                 // Ctrl + Shift + I
      (isMac && cmd && alt && key === 'i'),           // Cmd + Option + I

      (key === 'f12'),                                // F12

      (ctrl && shift && key === 'j'),                 // Ctrl + Shift + J
      (isMac && cmd && alt && key === 'j'),           // Cmd + Option + J

      (ctrl && shift && key === 'r'),                 // Ctrl + Shift + R
      (isMac && cmd && shift && key === 'r'),         // Cmd + Shift + R

      (ctrl && shift && key === 'm'),                 // Ctrl + Shift + M
      (isMac && cmd && alt && key === 'm'),           // Cmd + Option + M

      (ctrl && shift && key === 'e'),                 // Ctrl + Shift + E
      (isMac && cmd && alt && key === 'e'),           // Cmd + Option + E

      (ctrl && key === 'r'),                          // Ctrl + R
      (isMac && cmd && key === 'r')                   // Cmd + R
    ];

    if (combos.some(Boolean)) {
      e.preventDefault();
      location.reload();
    }
  });
</script>




<style>
  #mobileSidebarOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    z-index: 9998;
    display: none;
  }

  /* Default: do not interfere with desktop layout */
  #leftSidebar {
    /* your existing desktop layout applies here */
  }

  /* Mobile Sidebar Behavior */
  @media (max-width: 768px) {
    #leftSidebar.mobile-slide {
      display: none !important; /* hide by default */
    }

    #leftSidebar.mobile-slide.show {
      display: flex !important;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      width: 80%;
      max-width: 300px;
      height: 100vh;
      background: white;
      color: #111827;
      z-index: 9999;
      transform: translateX(0%);
      transition: transform 0.3s ease-in-out;
      overflow-y: auto;
      padding: 1rem;
    }

    /* 🌙 Dark Mode Support */
    body.dark-mode #leftSidebar.mobile-slide.show {
      background: #000000;
      color: #f9fafb;
    }

    /* Smaller font/buttons on mobile only */
    #leftSidebar.mobile-slide.show button {
      font-size: 0.85rem;
      padding: 0.1rem 0.3rem;
      gap: 0.3rem;
    }

    #leftSidebar.mobile-slide.show button i {
      font-size: 0.9rem;
      min-width: 18px;
    }
  }
</style>


<div id="mobileSidebarOverlay" onclick="toggleMobileSidebarMenu()"></div>

<script>
  function toggleMobileSidebarMenu() {
    const sidebar = document.getElementById('leftSidebar');
    const overlay = document.getElementById('mobileSidebarOverlay');

    if (sidebar.classList.contains('show')) {
      sidebar.classList.remove('show');
      overlay.style.display = 'none';
    } else {
      sidebar.classList.add('mobile-slide', 'show');
      overlay.style.display = 'block';
    }
  }

  // 🔁 Hide sidebar on any button click inside it (mobile only)
  document.addEventListener("DOMContentLoaded", () => {
    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    if (isMobile) {
      document.querySelectorAll("#leftSidebar button").forEach(btn => {
        btn.addEventListener("click", () => {
          const sidebar = document.getElementById('leftSidebar');
          const overlay = document.getElementById('mobileSidebarOverlay');
          sidebar.classList.remove('show');
          overlay.style.display = 'none';
        });
      });
    }
  });
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    onSnapshot,
    query,
    where,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDrFdwYhlj84GQ3eLzPctLgxZ572PHu7Tg",
    authDomain: "x-clone-d4697.firebaseapp.com",
    projectId: "x-clone-d4697",
    storageBucket: "x-clone-d4697.firebasestorage.app",
    messagingSenderId: "438425139174",
    appId: "1:438425139174:web:b1ebea6f124a245cf9c827",
    measurementId: "G-PLQBYNDKQM"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const wallpapersRef = collection(db, "wallpapers");
  const privateWallpapersRef = collection(db, "privateWallpapers");

  const PRESET_WALLPAPERS = [
    "https://w0.peakpx.com/wallpaper/778/607/HD-wallpaper-16k-waterfall-waterfalls.jpg",
    "https://e1.pxfuel.com/desktop-wallpaper/971/645/desktop-wallpaper-1366x768-gallery-full-1366x768.jpg",
    "https://e0.pxfuel.com/wallpapers/199/1013/desktop-wallpaper-muskoka-s-best-kept-secrets.jpg",
    "https://pbs.twimg.com/media/DjppcqFW4AcpNfz.jpg:large",
    "https://cdn.wallpapersafari.com/50/57/d8RINq.jpg"
  ];

  document.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem("clidderWallpaper");
    if (saved) applyWallpaper(saved);

    // Sidebar button
    const wallpaperBtn = document.createElement("button");
    wallpaperBtn.className = "flex items-center space-x-3 hover:text-[#FF7D1E]";
    wallpaperBtn.id = "sidebarWallpaper";
    wallpaperBtn.innerHTML = `<i class="far fa-image text-transparent bg-clip-text bg-gradient-to-r from-teal-400 via-cyan-500 to-indigo-400 transition duration-300 ease-in-out"></i>
<span>Wallpaper</span>`;
    document.querySelector("#leftSidebar nav").appendChild(wallpaperBtn);

    // Modal layout
    const modalHTML = `
      <div id="wallpaperModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-lg w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden">
          <div class="p-4 border-b dark:border-gray-700 text-center">
            <h2 class="text-lg font-bold">Set a Wallpaper</h2>
          </div>
          <div class="p-4 flex items-center gap-2">
            <input id="customWallpaperInput" type="text" placeholder="Paste image URL..."
              class="flex-1 px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm text-black dark:text-white focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]" />
            <button id="applyCustomBtn" class="bg-[#FF7D1E] text-white px-4 py-2 rounded hover:bg-[#e6680f]">Apply</button>
            <button id="pasteClipboardBtn" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Paste</button>
          </div>
          <div class="overflow-y-auto p-4 flex-1 space-y-8">
            <div>
              <h3 class="text-sm font-semibold mb-2 text-center">🌍 Public Wallpapers</h3>
              <div id="publicWallpaperGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                ${PRESET_WALLPAPERS.map(wallpaperImage).join("")}
              </div>
            </div>
            <div>
              <h3 class="text-sm font-semibold mb-2 text-center">🔒 Your Private Wallpapers</h3>
              <div id="privateWallpaperGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
            </div>
          </div>
          <div class="p-4 border-t dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
            <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded" onclick="resetWallpaper()">Reset</button>
            <button class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded" onclick="document.getElementById('wallpaperModal').classList.add('hidden')">Close</button>
          </div>
        </div>
      </div>
    `;
    const modalContainer = document.createElement("div");
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);

    // Actions
    wallpaperBtn.addEventListener("click", () => {
      document.getElementById("wallpaperModal").classList.remove("hidden");
    });

    document.getElementById("pasteClipboardBtn").addEventListener("click", async () => {
      try {
        const text = await navigator.clipboard.readText();
        if (text.startsWith("http")) {
          document.getElementById("customWallpaperInput").value = text;
        } else {
          alert("Clipboard does not contain a valid URL.");
        }
      } catch (err) {
        alert("Clipboard access denied.");
      }
    });

    document.getElementById("applyCustomBtn").addEventListener("click", async () => {
      const input = document.getElementById("customWallpaperInput");
      const url = input.value.trim();
      if (!url || !url.startsWith("http")) return alert("Enter a valid image URL.");
      applyWallpaper(url);

      const makePublic = confirm("Make this wallpaper public? Press Cancel to keep it private.");
      const targetRef = makePublic ? wallpapersRef : privateWallpapersRef;

      try {
        const exists = await getDocs(query(targetRef, where("url", "==", url)));
        if (exists.empty) await addDoc(targetRef, { url });
      } catch (err) {
        console.error("Failed to save wallpaper:", err);
      }

      if (!makePublic) appendToPrivateGrid(url);
      input.value = "";
    });

    // Listen to public wallpapers
    onSnapshot(wallpapersRef, (snapshot) => {
      const grid = document.getElementById("publicWallpaperGrid");
      const urls = new Set(PRESET_WALLPAPERS);
      grid.innerHTML = PRESET_WALLPAPERS.map(wallpaperImage).join("");
      snapshot.forEach(doc => {
        const url = doc.data().url;
        if (!urls.has(url)) {
          grid.insertAdjacentHTML("beforeend", wallpaperImage(url));
          urls.add(url);
        }
      });
    });

    // Load private wallpapers
    loadPrivateWallpapers();
  });

  function wallpaperImage(url) {
    return `<img src="${url}" class="cursor-pointer rounded-lg w-full h-36 object-cover hover:opacity-80 transition" onclick="applyWallpaper('${url}')">`;
  }

  function appendToPrivateGrid(url) {
    const grid = document.getElementById("privateWallpaperGrid");
    grid.insertAdjacentHTML("beforeend", wallpaperImage(url));
  }

  async function loadPrivateWallpapers() {
    try {
      const snap = await getDocs(privateWallpapersRef);
      const grid = document.getElementById("privateWallpaperGrid");
      grid.innerHTML = "";
      snap.forEach(doc => {
        const url = doc.data().url;
        grid.insertAdjacentHTML("beforeend", wallpaperImage(url));
      });
    } catch (e) {
      console.error("Failed to load private wallpapers:", e);
    }
  }

  window.applyWallpaper = function (url) {
    document.body.style.backgroundImage = `url('${url}')`;
    document.body.style.backgroundSize = "cover";
    document.body.style.backgroundRepeat = "no-repeat";
    document.body.style.backgroundAttachment = "fixed";
    document.body.style.backgroundPosition = "center";

    ["leftSidebar", "rightSidebar"].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.style.backgroundImage = `url('${url}')`;
        el.style.backgroundSize = "cover";
        el.style.backgroundRepeat = "no-repeat";
        el.style.backgroundPosition = "center";
      }
    });

    localStorage.setItem("clidderWallpaper", url);
  };

  window.resetWallpaper = function () {
    document.body.style.backgroundImage = "";
    ["leftSidebar", "rightSidebar"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.backgroundImage = "";
    });
    localStorage.removeItem("clidderWallpaper");
    document.getElementById("wallpaperModal").classList.add("hidden");
  };
</script>











<!-- 🌐 Clidder Offline/Online Notification – Twitter Style with Blur -->
<div id="offlineBanner"
     class="fixed inset-0 z-[99999] flex flex-col items-center justify-center text-center px-6 backdrop-blur-md bg-black/80 dark:bg-black/80 hidden">

  <!-- Icon Area -->
  <div class="mb-4">
    <!-- Offline Icon -->
    <svg id="offlineIcon" xmlns="http://www.w3.org/2000/svg"
         class="w-12 h-12 text-gray-400 mx-auto"
         fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M18.364 5.636l-12.728 12.728M6.343 6.343l12.728 12.728" />
    </svg>

    <!-- Online Icon -->
    <svg id="onlineIcon" xmlns="http://www.w3.org/2000/svg"
         class="w-12 h-12 text-green-500 mx-auto hidden"
         fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M5 13l4 4L19 7" />
    </svg>
  </div>

  <!-- Message -->
  <p id="offlineMessage" class="text-lg mb-4 text-gray-300 dark:text-gray-300">
    Looks like you lost your connection.<br>Please check it and try again.
  </p>

  <!-- Retry / Continue Button -->
  <button id="retryBtn"
    onclick="location.reload()"
    class="transition px-6 py-2 text-white rounded-full font-semibold text-sm shadow-sm bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600">
    <span id="retryText">Retry</span>
  </button>
</div>

<!-- Audio Cues -->
<audio id="offlineSound" src="https://assets.mixkit.co/sfx/preview/mixkit-tech-break-fail-2947.mp3"></audio>
<audio id="onlineSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<!-- Script Logic -->
<script>
  const offlineBanner = document.getElementById('offlineBanner');
  const offlineMessage = document.getElementById('offlineMessage');
  const retryBtn = document.getElementById('retryBtn');
  const retryText = document.getElementById('retryText');
  const offlineIcon = document.getElementById('offlineIcon');
  const onlineIcon = document.getElementById('onlineIcon');
  const offlineSound = document.getElementById('offlineSound');
  const onlineSound = document.getElementById('onlineSound');

  let wasOffline = false;

  function showOfflineBanner() {
    offlineBanner.classList.remove("hidden");
    offlineMessage.innerHTML = "Looks like you lost your connection.<br>Please check it and try again.";
    retryBtn.className = "transition px-6 py-2 text-white rounded-full font-semibold text-sm shadow-sm bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600";
    retryText.textContent = "Retry";

    offlineIcon.classList.remove("hidden");
    onlineIcon.classList.add("hidden");

    try { offlineSound.play(); } catch (e) {}
    if ('vibrate' in navigator) navigator.vibrate([200, 100, 200]);
    wasOffline = true;
  }

  function showOnlineBanner() {
    offlineBanner.classList.remove("hidden");
    offlineMessage.innerHTML = "You're back online!<br>You may continue using Clidder.";
    retryBtn.className = "transition px-6 py-2 text-white rounded-full font-semibold text-sm shadow-sm bg-[#FF7D1E] hover:bg-[#e6680f]";
    retryText.textContent = "Continue";

    offlineIcon.classList.add("hidden");
    onlineIcon.classList.remove("hidden");

    try { onlineSound.play(); } catch (e) {}
    setTimeout(() => offlineBanner.classList.add("hidden"), 2500);
    wasOffline = false;
  }

  function updateNetworkStatus() {
    if (!navigator.onLine) {
      showOfflineBanner();
    } else if (wasOffline) {
      showOnlineBanner();
    }
  }

  window.addEventListener('online', updateNetworkStatus);
  window.addEventListener('offline', updateNetworkStatus);
  updateNetworkStatus();

  setInterval(() => {
    if (!navigator.onLine) {
      fetch("https://www.google.com/favicon.ico", { mode: 'no-cors' })
        .then(() => window.dispatchEvent(new Event('online')))
        .catch(() => {});
    }
  }, 5000);
</script>






<script>

function pasteMediaUrl() {
  navigator.clipboard.readText().then((text) => {
    document.getElementById("postImageUrl").value = text;
  }).catch((err) => {
    alert("Failed to paste: " + err.message);
  });
}


</script>

<script>

function convertUrlsToLinks(text) {
  const urlRegex = /(\bhttps?:\/\/[^\s]+)/g;
  return text.replace(urlRegex, (url) => {
    // Strip protocol for display only
    const displayUrl = url.replace(/^https?:\/\//, '');
    const shortDisplay = displayUrl.length > 50 ? displayUrl.slice(0, 50) + '…' : displayUrl;

    return `<a href="${url}" target="_blank" rel="noopener noreferrer"
      class="text-[#FF7D1E] underline hover:text-orange-600">
      ${shortDisplay}
    </a>`;
  });
}


</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDrFdwYhlj84GQ3eLzPctLgxZ572PHu7Tg",
    authDomain: "x-clone-d4697.firebaseapp.com",
    projectId: "x-clone-d4697",
    storageBucket: "x-clone-d4697.firebasestorage.app",
    messagingSenderId: "438425139174",
    appId: "1:438425139174:web:b1ebea6f124a245cf9c827",
    measurementId: "G-PLQBYNDKQM"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const relatedUserIds = [
    "Nn8GSkAwqHcwttbNu4KK",
    "7k3Y0CtpVSKSe8kNAopH",
    "jyXdiSnFg95YJvesqUAO",
    "ec7tZDMNooxgVrhTNkcB",
    "22WznXDzH5dym0qJN2DY",
    "GDoPmGdIjI89qelNRBWL",
    "RA7yzV9iEitIlSxHEycq",
    "Suwc31nuY9jiXm479Qjt"
  ];

  const list = document.getElementById("relatedPeopleList");
  const spinner = document.getElementById("relatedLoadingSpinner");

  const users = [];

  async function fetchUser(uid) {
    const snap = await getDoc(doc(db, "users", uid));
    if (!snap.exists()) return null;

    const data = snap.data();
   return {
  uid,
  name: data.fullName || "Unnamed",
  username: (data.username || "user").toLowerCase(),
  profilePic: data.profilePic || "https://i.ibb.co/0VqN92C4/clidder-off-dark.png",
  followerCount: Array.isArray(data.followers) ? data.followers.length : 0,
  verified: data.verified || false,
  premium: data.premium || false,
  pro: data.pro || false,
  company: data.company || false,
  AI: data.AI || false,
  Clidder: data.Clidder || false
};

  }

  async function loadUsers() {
    for (const uid of relatedUserIds) {
      const user = await fetchUser(uid);
      if (user) users.push(user);
    }

    // Sort by followers
    users.sort((a, b) => b.followerCount - a.followerCount);

    list.innerHTML = "";

    users.forEach(user => {
      const li = document.createElement("li");
      li.className = "flex items-center gap-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 p-2 rounded-md transition";

      li.innerHTML = `
        <img src="${user.profilePic}" alt="${user.name}" class="w-10 h-10 rounded-full object-cover" />
        <div class="flex-1">
          <div class="font-semibold text-gray-900 dark:text-white inline-flex items-center gap-1">
  ${user.name}
  ${getVerifiedHTML(user.verified)}
 ${getPremiumHTML(user.premium)}
 ${getProHTML(user.pro)}
   ${getCompanyHTML(user.company)}
   ${getAIHTML(user.AI)}
   ${getClidderHTML(user.Clidder)}
</div>

          <div class="text-gray-500 text-sm">𝓬𝓹${user.username}</div>
          <div class="text-gray-400 text-xs">${user.followerCount}K Followers</div>
        </div>
      `;

      li.addEventListener("click", () => {
        // 👇 Trigger "Who to Follow" section
        document.getElementById("sidebarMore")?.click();
      });

      list.appendChild(li);
    });

    spinner.style.display = "none";
    list.style.display = "block";
  }

  loadUsers();
</script>











<script>
async function fetchEnhancedWeather() {
  const hour = new Date().getHours();
  const timeLabel = hour < 5 ? "Night" : hour < 12 ? "Morning" : hour < 17 ? "Afternoon" : hour < 20 ? "Evening" : "Night";
  document.getElementById('weatherTimeLabel').textContent = timeLabel;

  try {
    const res = await fetch('https://wttr.in/?format=j1');
    const data = await res.json();

    const area = data.nearest_area[0].areaName[0].value;
    const current = data.current_condition[0];
    const slot = Math.floor(hour / 3);
    const hourly = data.weather[0].hourly[slot];
    const astronomy = data.weather[0].astronomy[0];

    const desc = current.weatherDesc[0].value.toLowerCase();
    const icon = desc.includes("rain") ? "🌧️" :
                 desc.includes("sun") || desc.includes("clear") ? "☀️" :
                 desc.includes("cloud") ? "☁️" :
                 desc.includes("snow") ? "❄️" :
                 desc.includes("storm") ? "⛈️" : "🌤️";

    // Set values
    document.getElementById("weatherTitle").textContent = `Weather – ${area}`;
    document.getElementById("weatherIcon").textContent = icon;
    document.getElementById("weatherCondition").textContent = desc.charAt(0).toUpperCase() + desc.slice(1);
    document.getElementById("weatherTemp").textContent = `${current.temp_C}°C`;
    document.getElementById("weatherFeels").textContent = current.FeelsLikeC;
    document.getElementById("weatherHumidity").textContent = current.humidity;
    updateHumidityArc(parseInt(current.humidity));
    document.getElementById("weatherWind").textContent = current.windspeedKmph;
    document.getElementById("weatherVisibility").textContent = current.visibility;
    document.getElementById("weatherRainChance").textContent = hourly.chanceofrain;
    document.getElementById("sunriseTime").textContent = astronomy.sunrise;
    document.getElementById("sunsetTime").textContent = astronomy.sunset;
    updateSunProgress(astronomy.sunrise, astronomy.sunset);

// Optional moon phase (hardcoded from data or calculate yourself)
const moonPhase = data.weather[0].astronomy[0].moon_phase || "Waning Gibbous";
document.getElementById("moonPhase").textContent = moonPhase;
document.getElementById("moonIcon").textContent = getMoonPhaseSymbol(moonPhase);



    // Forecast
    const forecastHTML = data.weather.slice(0, 3).map((day, i) => {
      const dayName = i === 0 ? "Today" : new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' });
      const min = day.mintempC, max = day.maxtempC;
      const iconSmall = day.hourly[4].weatherDesc[0].value.includes("rain") ? "🌧️" :
                        day.hourly[4].weatherDesc[0].value.includes("sun") ? "☀️" :
                        day.hourly[4].weatherDesc[0].value.includes("cloud") ? "☁️" :
                        day.hourly[4].weatherDesc[0].value.includes("snow") ? "❄️" : "🌡️";
      return `
        <div class="bg-white/20 p-2 rounded text-center">
          <div class="font-bold">${dayName}</div>
          <div>${iconSmall}</div>
          <div>${min}–${max}°C</div>
        </div>`;
    }).join('');
    document.getElementById("forecastGrid").innerHTML = forecastHTML;

  } catch (err) {
    document.getElementById('weatherBox').innerHTML = `<div class="text-red-500">Failed to load weather data.</div>`;
  }
}

window.addEventListener("DOMContentLoaded", fetchEnhancedWeather);
</script>

<script>
function updateSunProgress(sunriseStr, sunsetStr) {
  const parseTime = t => {
    const [h, m] = t.split(/[:\s]/).map(Number);
    const isPM = t.toLowerCase().includes("pm");
    return h % 12 + (isPM ? 12 : 0) + m / 60;
  };

  const sunrise = parseTime(sunriseStr);
  const sunset = parseTime(sunsetStr);
  const now = new Date();
  const currentHour = now.getHours() + now.getMinutes() / 60;
  const progress = Math.max(0, Math.min(1, (currentHour - sunrise) / (sunset - sunrise)));

  // Move sun
  const sun = document.getElementById("sunMarker");
  const arcPath = document.querySelector("#sunArc path");
  const len = arcPath.getTotalLength();
  const point = arcPath.getPointAtLength(len * progress);
  sun.setAttribute("cx", point.x);
  sun.setAttribute("cy", point.y);

  // Set durations
  const daylight = sunset - sunrise;
  document.getElementById("daylightDuration").textContent = `${Math.floor(daylight)} hrs ${Math.round((daylight % 1) * 60)} mins`;
  document.getElementById("sunriseTimeDisplay").textContent = sunriseStr;
  document.getElementById("sunsetTimeDisplay").textContent = sunsetStr;
}
</script>

<script>
function updateHumidityArc(humidity) {
  const progress = Math.max(0, Math.min(1, humidity / 100));
  const arcPath = document.querySelector("#humidityArc path");
  const marker = document.getElementById("humidityMarker");
  const point = arcPath.getPointAtLength(arcPath.getTotalLength() * progress);
  marker.setAttribute("cx", point.x);
  marker.setAttribute("cy", point.y);
  document.getElementById("humidityPercent").textContent = `${humidity}%`;
}

function getMoonPhaseSymbol(phaseName) {
  const map = {
    "New Moon": "🌑",
    "Waxing Crescent": "🌒",
    "First Quarter": "🌓",
    "Waxing Gibbous": "🌔",
    "Full Moon": "🌕",
    "Waning Gibbous": "🌖",
    "Last Quarter": "🌗",
    "Waning Crescent": "🌘"
  };
  return map[phaseName] || "🌑";
}
</script>


<script>
  async function updateSunProgress() {
    const lat = 7.8731;  // Example: Sri Lanka
    const lon = 80.7718;

    // Fetch sunrise and sunset data
    const response = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`);
    const data = await response.json();
    const sunrise = new Date(data.results.sunrise);
    const sunset = new Date(data.results.sunset);
    const now = new Date();

    // Format time display
    const formatTime = (date) =>
      date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // Insert into the page
    document.getElementById("sunriseTimeDisplay").textContent = formatTime(sunrise);
    document.getElementById("sunsetTimeDisplay").textContent = formatTime(sunset);

    // Calculate daylight duration
    const daylightMs = sunset - sunrise;
    const elapsedMs = now - sunrise;
    const percent = Math.min(Math.max(elapsedMs / daylightMs, 0), 1);
    const daylightHrs = (daylightMs / (1000 * 60 * 60)).toFixed(1);

    document.getElementById("daylightDuration").textContent = `${daylightHrs} hrs`;

    // Move sun on arc
    const arc = document.querySelector("#sunArc path");
    const sun = document.getElementById("sunMarker");
    const pathLength = arc.getTotalLength();
    const point = arc.getPointAtLength(pathLength * percent);
    sun.setAttribute("cx", point.x);
    sun.setAttribute("cy", point.y);

    // Time left
    const duration = new Date(daylightMs - elapsedMs);
    const leftHrs = ((sunset - now) / (1000 * 60 * 60)).toFixed(1);
    document.getElementById("sunDuration").textContent =
      now < sunrise ? "Before Sunrise" :
      now > sunset ? "After Sunset" :
      `${(percent * 100).toFixed(0)}% of day done`;
  }

  updateSunProgress();
  setInterval(updateSunProgress, 5 * 60 * 1000); // Update every 5 min
</script>

<style>

/* Time-based background gradients with animation */
.morning-bg {
  background: linear-gradient(270deg, #1A3DFE, #1786FE, #0D21FE);
  background-size: 600% 600%;
  animation: gradientShift 10s ease infinite;
}

.afternoon-bg {
  background: linear-gradient(270deg, #87cefa, #00bfff, #1e90ff);
  background-size: 600% 600%;
  animation: gradientShift 10s ease infinite;
}

.evening-bg {
  background: linear-gradient(270deg, #FF780B, #FFCD08, #FFCC1E);
  background-size: 600% 600%;
  animation: gradientShift 10s ease infinite;
}

.night-bg {
  background: linear-gradient(270deg, #0f2027, #203a43, #2c5364);
  background-size: 600% 600%;
  animation: gradientShift 10s ease infinite;
}

/* Animation for smooth background transitions */
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}


</style>

<script>
  function applyTimeBasedWeatherTheme() {
    const hour = new Date().getHours();
    const weatherBox = document.getElementById("weatherBox");

    if (!weatherBox) return;

    // Remove existing time-based background classes
    weatherBox.classList.remove("morning-bg", "afternoon-bg", "evening-bg", "night-bg");

    // Add appropriate class based on the current hour
    if (hour >= 5 && hour < 12) {
      weatherBox.classList.add("morning-bg");
    } else if (hour >= 12 && hour < 17) {
      weatherBox.classList.add("afternoon-bg");
    } else if (hour >= 17 && hour < 20) {
      weatherBox.classList.add("evening-bg");
    } else {
      weatherBox.classList.add("night-bg");
    }
  }

  // Run immediately when the page loads
  document.addEventListener("DOMContentLoaded", () => {
    applyTimeBasedWeatherTheme();

    // Re-check every minute (60000 ms)
    setInterval(applyTimeBasedWeatherTheme, 60000);
  });
</script>




<script>
function getRelativeTime(pubDate) {
  const posted = new Date(pubDate);
  const now = new Date();
  const diffMs = now - posted;
  const diffMins = Math.floor(diffMs / (1000 * 60));
  if (diffMins < 1) return "Just now";
  if (diffMins < 60) return `${diffMins}m ago`;
  const diffHrs = Math.floor(diffMins / 60);
  if (diffHrs < 24) return `${diffHrs}h ago`;
  const diffDays = Math.floor(diffHrs / 24);
  return `${diffDays}d ago`;
}

async function fetchBreakingNewsRSS() {
  const url = "https://rss2json.com/api.json?rss_url=" +
    encodeURIComponent("https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en");

  try {
    const response = await fetch(url);
    const data = await response.json();

    const list = document.getElementById("breakingNewsList");
    list.innerHTML = "";

    if (data.items && data.items.length > 0) {
      data.items.slice(0, 6).forEach(item => {
        const li = document.createElement("li");

        const timeAgo = getRelativeTime(item.pubDate || item.isoDate);
        const category = (item.categories && item.categories[0]) || "News";
        const badgeColor = {
          World: "bg-red-500",
          Tech: "bg-blue-500",
          Business: "bg-green-500",
          Sports: "bg-yellow-500",
          Politics: "bg-purple-500",
          News: "bg-gray-500"
        }[category] || "bg-gray-500";

        const thumbnail = item.enclosure?.url || "";

        li.className = `
          group flex items-start gap-3 px-2 py-3 
          transition hover:bg-gray-100 dark:hover:bg-gray-800 
          border-b border-gray-200 dark:border-gray-700 rounded-md
        `;

        li.innerHTML = `
          ${thumbnail ? `
            <img src="${thumbnail}" alt="thumbnail" 
                 class="w-12 h-12 object-cover rounded-md flex-shrink-0 border border-gray-200 dark:border-gray-700">`
           : `<div class="mt-1 w-2.5 h-2.5 bg-[#FF7D1E] rounded-full flex-shrink-0"></div>`}

          <div class="flex-1 min-w-0">
            <a href="${item.link}" target="_blank" 
               class="block font-semibold text-gray-900 dark:text-white 
               text-sm leading-snug group-hover:text-[#FF7D1E] transition">
              ${item.title}
            </a>
            <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400">
              <span class="inline-block px-2 py-0.5 rounded-full text-white ${badgeColor}">
                ${category}
              </span>
              <span>${timeAgo}</span>
              <span class="italic">via Clidder News</span>
            </div>
          </div>
        `;

        list.appendChild(li);
      });
    } else {
      list.innerHTML = "<li class='text-gray-500 dark:text-gray-400'>No news found.</li>";
    }
  } catch (err) {
    console.error("Error fetching news:", err);
    document.getElementById("breakingNewsList").innerHTML =
      "<li class='text-red-500 dark:text-red-400'>Failed to load news.</li>";
  }
}

fetchBreakingNewsRSS();
setInterval(fetchBreakingNewsRSS, 60 * 1000); // Refresh every 1 minute
</script>

<script>
async function testSpeed() {
  const imageUrl = "https://upload.wikimedia.org/wikipedia/commons/3/3f/Fronalpstock_big.jpg"; // 5MB image
  const start = performance.now();
  try {
    const response = await fetch(imageUrl + "?cache=" + Math.random(), {
      method: "GET",
      cache: "no-cache"
    });
    const blob = await response.blob();
    const end = performance.now();

    const duration = (end - start) / 1000;
    const sizeInBits = blob.size * 8;
    const speedMbps = (sizeInBits / duration / 1024 / 1024).toFixed(2);
    document.getElementById("networkSpeed").textContent = `📶 ${speedMbps} Mbps`;
  } catch (e) {
    document.getElementById("networkSpeed").textContent = "⚠️ Test failed";
  }
}

// Initial and repeat every 10s
testSpeed();
setInterval(testSpeed, 1000);
</script>




<script>
  fetch("https://ipapi.co/json")
    .then(res => res.json())
    .then(data => {
      const flagEmoji = [...data.country_code.toUpperCase()]
        .map(c => String.fromCodePoint(c.charCodeAt() + 127397))
        .join('');
      document.getElementById("userFlag").textContent = flagEmoji;
      document.getElementById("userLocationText").textContent = `From ${data.city}, ${data.country_name}`;
      document.getElementById("userCity").textContent = data.city || "--";
      document.getElementById("userIP").textContent = data.ip || "--";
    })
    .catch(() => {
      document.getElementById("userLocationText").textContent = "Location unavailable";
    });
</script>










<!-- 📱 Mobile Search Page -->
<div id="mobileSearchModal" class="fixed inset-0 z-[9999] bg-white dark:bg-black hidden flex flex-col">
  <!-- 🔍 Only Search Bar + Settings (Twitter-style) -->
  <div class="flex items-center gap-2 px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-black">
    <!-- Search Bar -->
    <div class="flex-1 relative">
      <input
        id="mobileSearchField"
        type="text"
        placeholder="Search Clidder"
        class="w-full px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800 text-black dark:text-white placeholder-gray-500 dark:placeholder-gray-400 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-[#FF7D1E]"
        oninput="handleMobileSearch(this.value)"
      />
      <!-- Suggestions -->
      <div id="searchSuggestions" class="absolute z-10 w-full bg-white dark:bg-gray-900 mt-1 rounded-lg shadow border border-gray-200 dark:border-gray-700 hidden max-h-64 overflow-y-auto text-sm"></div>
    </div>
    <!-- Settings Icon -->
    <button onclick="alert('Filter options coming soon')" class="text-lg text-gray-700 dark:text-white">
      <i class="fas fa-sliders-h"></i>
    </button>
  </div>

  <!-- 🔽 Content Area -->
  <div class="flex-1 overflow-y-auto px-4 py-4 space-y-8 bg-white dark:bg-black" onscroll="handleScrollForMorePosts()">
    <!-- Breaking News -->
    <div id="breakingNewsSearchSection">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3">🚨 What’sgoing on?</h3>
      <div id="breakingNewsSearchList" class="space-y-4"></div>
    </div>

    <!-- Trending -->
    <div id="trendingSearchSection">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3">🔥 Trends for you</h3>
      <div id="trendingSearchList" class="space-y-4"></div>
    </div>

    <!-- Weather (cloned) -->
    <div id="weatherSearchBox" class="space-y-2"></div>

    <!-- Posts -->
    <div id="mobileSearchResults" class="space-y-6"></div>
  </div>

  <!-- ✅ Existing Bottom Bar -->
  <div class="fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-black border-t border-gray-200 dark:border-gray-700">
    <div class="flex justify-around items-center py-2 text-sm text-gray-700 dark:text-white">
      <button id="mobileNavHome" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
      <span class="relative inline-block">
    <!-- Twitter-like home icon -->
    <svg viewBox="0 0 24 24" aria-hidden="true" class="w-6 h-6 fill-current">
      <path d="M22.58 12.42l-9-9a1.5 1.5 0 00-2.12 0l-9 9A1.5 1.5 0 003 14h1v7a1 1 0 001 1h5a1 1 0 001-1v-5h2v5a1 1 0 001 1h5a1 1 0 001-1v-7h1a1.5 1.5 0 001.08-2.58z"></path>
    </svg>

    <!-- Orange active dot -->
    <span class="absolute -top-1 -right-1 w-2 h-2 bg-orange-500 rounded-full"></span>
  </span>
  <span class="text-base font-medium"></span>
  </button>



     <button onclick="openMobileSearch()" class="text-xl text-gray-700 dark:text-white mr-2">
  <i class="fas fa-search"></i>
</button>


       <button id="mobileNavFavs" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
    <i class="fas fa-star text-xl"></i><span class="text-xs"></span>
  </button>


<button id="mobileclips" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
    <i class="fas fa-play-circle fa-lg"></i><span class="text-xs"></span>
  </button>


   <button id="mobileNavClidders" class="flex flex-col items-center text-gray-600 hover:text-[#FF7D1E]">
      <i class="fas fa-users text-lg"></i>
    </button>

  <button onclick="toggleMobileSidebarMenu()" class="text-2xl text-gray-700 dark:text-white focus:outline-none">
    <i class="fas fa-ellipsis-h"></i>
  </button>

    </div>
  </div>
</div>


<script>
let searchPageLoaded = false;

function openMobileSearch() {
  document.getElementById('mobileSearchModal').classList.remove('hidden');
  document.getElementById('mobileSearchField').focus();
  document.getElementById('mobileSearchResults').innerHTML = '';
  document.getElementById('searchSuggestions').style.display = 'none';
  document.getElementById('breakingNewsSearchSection').style.display = 'block';

  loadStyledBreakingNews();
  loadTrendingHashtags();
  cloneWeatherBox();
  searchPageLoaded = false;
}

function closeMobileSearch() {
  document.getElementById('mobileSearchModal').classList.add('hidden');
  document.querySelectorAll('#mobileSearchResults video').forEach(v => v.pause());
}

function handleMobileSearch(query) {
  const q = query.toLowerCase().trim();
  const results = document.getElementById('mobileSearchResults');
  const suggestionsBox = document.getElementById('searchSuggestions');
  const breaking = document.getElementById('breakingNewsSearchSection');
  results.innerHTML = '';
  suggestionsBox.innerHTML = '';
  suggestionsBox.style.display = 'none';

  if (!q) {
    breaking.style.display = 'block';
    return;
  }

  breaking.style.display = 'none';

  const posts = document.querySelectorAll('#feed .post-content');
  const suggestions = new Set();
  let found = 0;

  posts.forEach(post => {
    const text = post.textContent.toLowerCase();
    const original = post.closest('article') || post.parentElement;

    if (text.includes(q)) {
      const clone = original.cloneNode(true);
      clone.onclick = () => {
        closeMobileSearch();
        window.scrollTo({ top: 0, behavior: "smooth" });
      };
      clone.querySelectorAll('video').forEach(v => {
        v.setAttribute('muted', true);
        v.setAttribute('playsinline', true);
        v.pause();
      });
      results.appendChild(clone);
      found++;
      suggestions.add(post.textContent.slice(0, 50) + '...');
    }

    [...post.textContent.matchAll(/[@#]\w+/g)].forEach(tag => {
      if (tag[0].toLowerCase().includes(q)) suggestions.add(tag[0]);
    });
  });

  if (suggestions.size > 0) {
    suggestionsBox.style.display = 'block';
    suggestionsBox.innerHTML = [...suggestions].slice(0, 6).map(
      s => `<div class="px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer" onclick="selectSuggestion('${s.replace(/'/g, "\\'")}')">🔍 ${s}</div>`
    ).join('');
  }

  if (found === 0) {
    results.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">No results for "<strong>${q}</strong>".</p>`;
  }

  setupSearchVideoAutoplay();
}

function selectSuggestion(val) {
  document.getElementById('mobileSearchField').value = val;
  handleMobileSearch(val);
}

function setupSearchVideoAutoplay() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const video = entry.target;
      if (entry.isIntersecting) {
        document.querySelectorAll('#mobileSearchResults video').forEach(v => {
          if (v !== video) v.pause();
        });
        video.play().catch(() => {});
      } else video.pause();
    });
  }, { threshold: 0.75 });

  document.querySelectorAll('#mobileSearchResults video').forEach(v => observer.observe(v));
}

function loadStyledBreakingNews() {
  const list = document.getElementById('breakingNewsSearchList');
  const originalItems = document.querySelectorAll('#breakingNewsList li');
  list.innerHTML = '';
  if (!originalItems.length) {
    list.innerHTML = `<p class="text-sm text-gray-400">No news available.</p>`;
    return;
  }
  originalItems.forEach(li => {
    const text = li.textContent.trim();
    const url = li.querySelector('a')?.href || '#';
    const box = document.createElement('div');
    box.className = 'rounded-lg border p-3 bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700';
    box.innerHTML = `<a href="${url}" target="_blank" class="block font-medium text-gray-900 dark:text-white hover:underline">${text}</a>
    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Trending now · Clidder News</div>`;
    list.appendChild(box);
  });
}

function loadTrendingHashtags() {
  const list = document.getElementById('trendingSearchList');
  const trending = [
    { title: "#TechNews", info: "Technology · Trending" },
    { title: "#ClidderAI", info: "AI · Trending" },
    { title: "#SriLanka", info: "Local News · Trending" },
    { title: "#Crypto", info: "Finance · Trending" }
  ];
  list.innerHTML = trending.map(tag => `
    <div class="p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer">
      <div class="text-xs text-gray-500 dark:text-gray-400">${tag.info}</div>
      <div class="text-sm font-bold text-black dark:text-white">${tag.title}</div>
    </div>
  `).join('');
}

function cloneWeatherBox() {
  const original = document.querySelector('#weatherBox');
  const target = document.getElementById('weatherSearchBox');
  if (original && target) {
    target.innerHTML = original.outerHTML;
    target.querySelector('#weatherBox').id = 'weatherBoxClone';
  }
}

function handleScrollForMorePosts() {
  if (searchPageLoaded) return;
  const scrollArea = document.getElementById('mobileSearchModal').querySelector('.overflow-y-auto');
  if (scrollArea.scrollTop + scrollArea.clientHeight >= scrollArea.scrollHeight - 100) {
    searchPageLoaded = true;
    const posts = [...document.querySelectorAll('#feed article')];
    const results = document.getElementById('mobileSearchResults');
    posts.slice(0, 5).forEach(post => {
      const clone = post.cloneNode(true);
      clone.onclick = () => {
        closeMobileSearch();
        window.scrollTo({ top: 0, behavior: "smooth" });
      };
      results.appendChild(clone);
    });
    setupSearchVideoAutoplay();
  }
}
</script>


<script>
function triggerEmojiRain(emojis) {
  for (let i = 0; i < 30; i++) {
    const emoji = document.createElement("div");
    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    emoji.style.position = "fixed";
    emoji.style.left = Math.random() * window.innerWidth + "px";
    emoji.style.top = "-2rem";
    emoji.style.fontSize = (Math.random() * 1.5 + 1.2) + "rem";
    emoji.style.zIndex = "9999";
    emoji.style.opacity = "0.8";
    emoji.style.pointerEvents = "none";
    emoji.style.animation = `emojiFall ${Math.random() * 2 + 3}s linear forwards`;
    document.body.appendChild(emoji);
    setTimeout(() => emoji.remove(), 5000);
  }
}

document.getElementById("btnSubmitTweet")?.addEventListener("click", () => {
  const textarea = document.getElementById("tweetInput");
  if (!textarea) return;

  const content = textarea.value.trim().toLowerCase();
  console.log("User Post:", content);

  let emojis = ["✨", "💬", "🌟", "🔥"]; // default

  const matchMap = [
    { keywords: ["love", "❤️", "💕"], emojis: ["❤️", "💘", "💕", "😍", "💖"] },
    { keywords: ["happy", "yay", "😊", "good"], emojis: ["😄", "🎉", "🥳", "💃", "😁"] },
    { keywords: ["sad", "cry", "💔", "😭", "😢"], emojis: ["😭", "🥺", "😢", "💔"] },
    { keywords: ["win", "success", "victory"], emojis: ["🏆", "🎯", "🥇", "🔥"] },
    { keywords: ["news", "update", "breaking"], emojis: ["📰", "📢", "🚨", "🔔"] },
    { keywords: ["funny", "lol", "😂", "🤣"], emojis: ["😂", "🤣", "🙃", "😹"] },
    { keywords: ["fire", "🔥", "lit"], emojis: ["🔥", "💥", "⚡", "🚀"] },
    { keywords: ["music", "song", "🎧"], emojis: ["🎵", "🎶", "🎧", "🎤"] },
    { keywords: ["food", "hungry", "🍕", "🍔"], emojis: ["🍕", "🍔", "🍟", "🍩", "🍫"] },
    { keywords: ["weather", "sun", "☀️", "rain"], emojis: ["🌞", "⛅", "🌧", "☁️", "🌦"] },
    { keywords: ["ai", "bot", "gpt"], emojis: ["🤖", "📡", "🧠", "⚙️"] },

    // Extra 10 sets 👇
    { keywords: ["school", "exam", "study"], emojis: ["📚", "📝", "📖", "🎓"] },
    { keywords: ["game", "play", "gamer"], emojis: ["🎮", "🕹️", "🏆", "🔥"] },
    { keywords: ["sports", "football", "soccer"], emojis: ["⚽", "🏀", "🏈", "🎯"] },
    { keywords: ["travel", "trip", "flight"], emojis: ["✈️", "🌍", "🧳", "📸"] },
    { keywords: ["nature", "tree", "forest"], emojis: ["🌳", "🍃", "🌲", "🍀"] },
    { keywords: ["sleep", "tired", "zzz"], emojis: ["😴", "🛌", "🌙", "💤"] },
    { keywords: ["coding", "dev", "code"], emojis: ["💻", "🧑‍💻", "👨‍💻", "🖥️"] },
    { keywords: ["movie", "film", "cinema"], emojis: ["🎬", "🍿", "📽️", "🎞️"] },
    { keywords: ["party", "dance", "club"], emojis: ["💃", "🕺", "🎉", "🎊"] },
    { keywords: ["money", "rich", "💰"], emojis: ["💰", "💸", "🤑", "💳"] }
  ];

  for (const match of matchMap) {
    if (match.keywords.some(word => content.includes(word))) {
      emojis = match.emojis;
      break;
    }
  }

  console.log("Selected emojis:", emojis);
  triggerEmojiRain(emojis);
});
</script>

<style>
@keyframes emojiFall {
  0% { transform: translateY(0); opacity: 0.9; }
  100% { transform: translateY(100vh); opacity: 0; }
}
</style>






<script>
const tweet = document.getElementById("tweetInput");
const prompts = [
  "Summarize an insight you've learned recently",
  "Share a thought you've been reflecting on",
  "What’s a question you'd like others to consider?",
  "Describe a moment of clarity you had today",
  "Outline a small habit that improved your routine",
  "Note a challenge you’re currently working through",
  "What’s a mindset that drives your progress?",
  "Explain a decision you’ve made and why",
  "Highlight something that deserves more attention",
  "Document a method that improves your productivity",
  "Describe a recent lesson from failure",
  "What are you prioritizing right now?",
  "Share a principle that guides your work",
  "Explain a strategy that worked for you",
  "Describe a quiet win you had this week",
  "Outline a goal you’re moving toward",
  "What are you optimizing for right now?",
  "Share a quote that shifted your perspective",
  "Describe a risk that paid off",
  "What makes today meaningful for you?",
  "Clarify something you believe but rarely say",
  "Note a pattern you’ve observed in others",
  "What’s one thing you consistently return to?",
  "Capture a reflection from recent reading",
  "Describe how you approach uncertainty",
  "Share how you structure deep work sessions",
  "What belief has helped you grow most?",
  "Note a decision that helped you simplify",
  "Describe a system that keeps you grounded",
  "What’s a metric you actually care about?"
];
let i = 0;
setInterval(() => {
  tweet.placeholder = prompts[i % prompts.length];
  i++;
}, 5000);
</script>







<!-- 🔮 Clidder AI Modal -->
<div id="clidderAIModal"
     class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] hidden p-4 flex items-center justify-center">
  <div class="bg-white dark:bg-[#111827] rounded-2xl shadow-2xl w-full max-w-3xl h-[80vh] relative flex flex-col overflow-hidden">

    <!-- Close Button -->
    <button onclick="toggleClidderAIModal()" class="absolute top-3 right-4 text-gray-500 hover:text-red-500 text-2xl z-10">
      &times;
    </button>

    <!-- Clidder AI Chat -->
    <div style="position: relative; height: 100%;">
      <iframe
        src="https://app.thinkstack.ai/bot/index.html?chatbot_id=685de92a53177c5dd5a47e9a&type=inline&theme=dark"
        class="w-full h-full border-0"
        style="position: relative; z-index: 0; color-scheme: light dark;"></iframe>

      <!-- Hide Thinkstack branding (overlay bar) -->
      <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 30px; background: #111827; z-index: 1;"></div>
    </div>

    <!-- Custom Footer Bar -->
    <div class="bg-black text-white text-sm text-center py-2">
      Clidder AI  – Powered by Induwara Jayasinghe
    </div>

  </div>
</div>

<!-- 🔁 JS to Toggle Modal -->
<script>
  function toggleClidderAIModal() {
    const modal = document.getElementById("clidderAIModal");
    modal.classList.toggle("hidden");
  }
</script>








<!-- PROFILE MODAL -->
<div id="profileModal" class="fixed inset-0 bg-black/50 z-[9999] hidden flex items-center justify-center">
  <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
              bg-white dark:bg-[#111827] text-black dark:text-white rounded-xl shadow-2xl 
              max-w-sm w-[90%] sm:w-full p-6 border-[4px]"
       style="border-image: linear-gradient(to right, #f97316, #fb923c) 1; border-image-slice: 1;">
    <button onclick="document.getElementById('profileModal').classList.add('hidden')"
            class="absolute top-2 right-3 text-gray-500 hover:text-red-500">×</button>
    <div id="profileModalContent"></div>
    <div class="mt-6">
      <div class="flex justify-around border-b border-gray-300 dark:border-gray-600 text-sm font-semibold text-gray-600 dark:text-gray-300">
        <button class="tab-btn" onclick="showTab('posts')">Posts</button>
        <button class="tab-btn" onclick="showTab('about')">About</button>
        <button class="tab-btn" onclick="showTab('media')">Media</button>
      </div>
      <div id="profileTabContent" class="mt-4 text-gray-800 dark:text-gray-100 text-sm">
        <!-- dynamic content here -->
      </div>
    </div>
  </div>
</div>

<script type="module">
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  getDoc,
  query,
  where,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

const db = getFirestore();
let activeProfileUID = null;

const sidebarBirthdays = document.getElementById("sidebarBirthdays");
const sidebarHome = document.getElementById("sidebarHome");
const birthdayUsersSection = document.getElementById("birthdayUsersSection");
const todayBirthdayList = document.getElementById("todayBirthdayList");
const upcomingBirthdayList = document.getElementById("upcomingBirthdayList");
const feed = document.getElementById("feed");

function getMonthName(monthIndex) {
  return new Date(2000, monthIndex, 1).toLocaleString('default', { month: 'long' });
}

function formatBirthday(dateStr) {
  const date = new Date(dateStr);
  return `${getMonthName(date.getMonth())} ${date.getDate()}`;
}

sidebarBirthdays.addEventListener("click", async () => {
  birthdayUsersSection.style.display = "flex";
  feed.style.display = "none";

  todayBirthdayList.innerHTML = "";
  upcomingBirthdayList.innerHTML = "";

  const snapshot = await getDocs(collection(db, "users"));
  const today = new Date();
  const mmddToday = `${today.getMonth() + 1}`.padStart(2, '0') + "-" + `${today.getDate()}`.padStart(2, '0');

  const upcoming = [], past = [];

  snapshot.forEach(docSnap => {
    const user = docSnap.data();
    if (!user.birthday) return;

    const date = new Date(user.birthday);
    const mmdd = `${date.getMonth() + 1}`.padStart(2, '0') + "-" + `${date.getDate()}`.padStart(2, '0');
    const daysDiff = Math.floor((date.setFullYear(today.getFullYear()) - today) / (1000 * 60 * 60 * 24));

    if (mmdd === mmddToday) {
      todayBirthdayList.appendChild(renderUserCard(user, docSnap.id));
    } else if (daysDiff > 0 && daysDiff <= 30) {
      upcoming.push({ ...user, id: docSnap.id, daysLeft: daysDiff });
    } else if (daysDiff < 0 && Math.abs(daysDiff) <= 30) {
      past.push({ ...user, id: docSnap.id, daysAgo: Math.abs(daysDiff) });
    }
  });

  if (todayBirthdayList.children.length === 0) {
    todayBirthdayList.innerHTML = "<p>No birthdays today.</p>";
  }

  [...upcoming.sort((a,b)=>a.daysLeft-b.daysLeft), ...past.sort((a,b)=>a.daysAgo-b.daysAgo)]
    .forEach(user => {
      const tag = user.daysLeft ? `in ${user.daysLeft} days` : `${user.daysAgo} days ago`;
      upcomingBirthdayList.appendChild(renderUserCard(user, user.id, tag));
    });
});

sidebarHome?.addEventListener("click", () => {
  birthdayUsersSection.style.display = "none";
  feed.style.display = "flex";
});

function renderUserCard(user, uid, extra = "") {
  const div = document.createElement("div");
  div.className = "birthday-user-card";
  div.innerHTML = `
    <img src="${user.profilePic || 'https://i.ibb.co/0VqN92C4/clidder-off-dark.png'}" alt="${user.fullName}" />
    <div>
      <div class="inline-flex items-center gap-1 font-medium flex-wrap">
        ${user.fullName || 'Unknown'}
        ${getPremiumHTML(user.premium)}
        ${getVerifiedHTML(user.verified)}
        ${getProHTML(user.pro)}
        ${getCompanyHTML(user.company)}
        ${getAIHTML(user.AI)}
        ${getClidderHTML(user.Clidder)}
      </div>
      <div class="text-sm text-gray-500">${user.birthday ? formatBirthday(user.birthday) : ''} ${extra}</div>
    </div>
  `;
  div.style.cursor = "pointer";
  div.onclick = () => showProfileModal(uid);
  return div;
}

async function showProfileModal(uid) {
  activeProfileUID = uid;
  const snap = await getDoc(doc(db, "users", uid));
  if (!snap.exists()) return;
  const user = snap.data();

  document.getElementById("profileModalContent").innerHTML = `
    <div class="text-center">
      <img src="${user.profilePic || 'https://placehold.co/100'}" class="w-24 h-24 rounded-full mx-auto mb-2" />
      <h3 class="text-xl font-semibold inline-flex items-center gap-1 justify-center flex-wrap">
        ${user.fullName || "User"}
        ${getPremiumHTML(user.premium)}
        ${getVerifiedHTML(user.verified)}
        ${getProHTML(user.pro)}
        ${getCompanyHTML(user.company)}
        ${getAIHTML(user.AI)}
        ${getClidderHTML(user.Clidder)}
      </h3>
      <p class="text-sm text-gray-500">@𝓬𝓹${user.username}</p>
    </div>
  `;

  showTab('about');
  document.getElementById("profileModal").classList.remove("hidden");
}

async function showTab(tab) {
  const content = document.getElementById("profileTabContent");

  if (tab === 'posts') {
    const q = query(collection(db, 'posts'), where('uid', '==', activeProfileUID), orderBy('createdAt', 'desc'));
    const snapshot = await getDocs(q);
    if (snapshot.empty) {
      content.innerHTML = "<p class='text-center text-gray-500'>No posts found.</p>";
    } else {
      content.innerHTML = Array.from(snapshot.docs).map(doc => {
        const post = doc.data();
        return `<div class='p-2 border-b dark:border-gray-700'><p>${post.content || "(No content)"}</p></div>`;
      }).join('');
    }
  } else if (tab === 'about') {
    const snap = await getDoc(doc(db, "users", activeProfileUID));
    const user = snap.data();
    content.innerHTML = `
      <div class='text-center'>
        <p class='mb-2'>${user.bio || "No bio available."}</p>
        <p class='text-sm text-gray-500'>Birthday: ${formatBirthday(user.birthday)}</p>
      </div>
    `;
  } else if (tab === 'media') {
    const q = query(collection(db, 'posts'), where('uid', '==', activeProfileUID));
    const snapshot = await getDocs(q);
    const mediaPosts = snapshot.docs.filter(doc => {
      const post = doc.data();
      return post.imageUrl || post.videoUrl;
    });

    if (mediaPosts.length === 0) {
      content.innerHTML = "<p class='text-center text-gray-500'>No media found.</p>";
    } else {
      content.innerHTML = mediaPosts.map(doc => {
        const post = doc.data();
        return `<div class='p-2'>
          ${post.imageUrl ? `<img src='${post.imageUrl}' class='rounded-lg max-h-60 mb-2' />` : ""}
          ${post.videoUrl ? `<video src='${post.videoUrl}' controls class='w-full max-h-60 mb-2'></video>` : ""}
        </div>`;
      }).join('');
    }
  }
}
</script>




<!-- 🔍 Profile Card Modal -->
<div id="profileCardModal" class="fixed inset-0 z-[9999] bg-black/50 hidden">
  <div id="profileCardBox"
       class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
              bg-white dark:bg-[#111827] text-black dark:text-white 
              rounded-xl shadow-2xl max-w-sm w-[90%] sm:w-full p-6 
              ring-1 ring-black/10 dark:ring-white/10 dark:shadow-[0_0_15px_rgba(255,255,255,0.15)]">
    
    <!-- Close button -->
    <button onclick="document.getElementById('profileCardModal').classList.add('hidden')"
            class="absolute top-2 right-3 text-gray-500 hover:text-black dark:hover:text-white text-xl font-bold">
      ×
    </button>

    <!-- Profile content -->
    <div id="profileCardContent" class="flex flex-col items-center space-y-2 text-center"></div>

    <!-- Footer -->
    <div class="mt-4 text-xs text-gray-500 dark:text-gray-400 text-center">
      Powered by Induwara Jayasinghe
    </div>
  </div>
</div>

<script>
  function openProfileCard(user) {
    const modal = document.getElementById("profileCardModal");
    const content = document.getElementById("profileCardContent");

    // Parse Firestore timestamp or fallback
    const joinedDate = user.createdAt && user.createdAt.toDate
      ? user.createdAt.toDate()
      : (user.createdAt instanceof Date
          ? user.createdAt
          : new Date(user.createdAt || Date.now()));

    const joinedText = `Joined ${joinedDate.toLocaleDateString(undefined, {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    })} at ${joinedDate.toLocaleTimeString(undefined, {
      hour: 'numeric',
      minute: '2-digit',
      hour12: true
    })}`;

    content.innerHTML = `
      <img src="${user.profilePic || 'https://i.ibb.co/0VqN92C4/clidder-off-dark.png'}"
           class="w-20 h-20 rounded-full object-cover border-4 border-[#FF7D1E]" alt="Profile Pic" />

      <h2 class="text-xl font-semibold flex flex-wrap justify-center items-center gap-1">
        ${user.userName || "Unknown User"}
        ${getPremiumHTML(user.premium)}
        ${getVerifiedHTML(user.verified)}
        ${getProHTML(user.pro)}
        ${getCompanyHTML(user.company)}
        ${getAIHTML(user.AI)}
        ${getClidderHTML(user.Clidder)}
      </h2>

      <p class="text-gray-500 dark:text-gray-400 text-sm">${user.userHandle || "unknown"}</p>
      <p class="text-gray-600 dark:text-gray-300 text-sm mt-1">${joinedText}</p>
    `;

    modal.classList.remove("hidden");
  }
</script>




<!-- 📄 Post Popup Modal -->
<div id="postPopupModal" class="fixed inset-0 z-[9998] bg-black/50 hidden" onclick="hidePopupOnOutsideClick(event)">
  <div id="popupBox"
       class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
              bg-white dark:bg-[#111827] text-black dark:text-white 
              rounded-xl shadow-2xl w-[95%] sm:w-[600px] max-w-full p-6 relative
              max-h-[90vh] sm:max-h-[70vh] overflow-hidden
              ring-1 ring-black/10 dark:ring-white/10 dark:shadow-[0_0_15px_rgba(255,255,255,0.15)]">
    
    <!-- ❌ Close Button -->
    <button onclick="document.getElementById('postPopupModal').classList.add('hidden')"
            class="absolute top-2 right-3 text-gray-500 hover:text-black dark:hover:text-white text-xl font-bold">×</button>

    <!-- 📦 Content Area -->
    <div id="postPopupContent" class="text-sm space-y-2"></div>
  </div>
</div>

<script>
  // 🌐 Format links, hashtags, mentions
  function parseContentWithLinks(text) {
    if (!text) return "";

    return text
      .replace(/(https?:\/\/[^\s]+)/g,
        '<a href="$1" target="_blank" class="text-orange-500 underline break-words">$1</a>')
      .replace(/(^|\\s)#(\\w+)/g,
        '$1<span class="text-orange-500">#$2</span>')
      .replace(/(^|\\s)@(\\w+)/g,
        '$1<span class="text-orange-500">@$2</span>');
  }

  // 📤 Open Post Popup
  function openPostPopup(post) {
    const modal = document.getElementById("postPopupModal");
    const content = document.getElementById("postPopupContent");

    const postedDate = post.createdAt?.toDate?.() || new Date(post.createdAt || Date.now());
    const dateString = postedDate.toLocaleString();

    const mediaHTML = post.imageUrl
      ? `<div class="mt-4"><img src="${post.imageUrl}" alt="Post Media" class="w-full max-h-80 rounded-lg object-cover" /></div>`
      : "";

    const captionHTML = parseContentWithLinks(post.caption || "(No content)");

    content.innerHTML = `
      <!-- 👤 User Info -->
      <div class="flex items-center gap-3 mb-4 text-left">
        <img src="${post.profilePic || 'https://placehold.co/40x40?text=U'}"
             class="w-10 h-10 rounded-full object-cover border border-orange-400" />
        <div class="flex flex-col">
          <span class="font-semibold text-base text-gray-900 dark:text-white inline-flex items-center gap-1 flex-wrap">
            ${post.userName || "Unknown User"}
            ${getPremiumHTML(post.premium)}
            ${getVerifiedHTML(post.verified)}
            ${getProHTML(post.pro)}
            ${getCompanyHTML(post.company)}
            ${getAIHTML(post.AI)}
            ${getClidderHTML(post.Clidder)}
          </span>
          <span class="text-sm text-gray-500 dark:text-gray-400">${post.userHandle?.replace(/^@/, "") || "unknown"}</span>
        </div>
      </div>

      <!-- 📝 Caption + Media -->
      <div class="overflow-y-auto pr-1 max-h-[50vh] text-left">
        <div class="text-gray-900 dark:text-gray-100 text-base whitespace-pre-wrap break-words mb-4">
          ${captionHTML}
        </div>
        ${mediaHTML}
      </div>

      <!-- 📅 Timestamp + Clidder -->
      <div class="flex justify-between items-center mt-4 text-xs">
        <span class="text-gray-500 dark:text-gray-400">Posted on: ${dateString}</span>
        <span class="flex items-center gap-1 text-orange-500 font-semibold">
          Clidder | 
          <img src="https://i.ibb.co/zVgvTJRF/clidder-ai.png" alt="Clidder AI" class="w-4 h-4" />
        </span>
      </div>
    `;

    modal.classList.remove("hidden");
  }

  // ❎ Close popup if clicking outside the box
  function hidePopupOnOutsideClick(event) {
    const box = document.getElementById("popupBox");
    if (!box.contains(event.target)) {
      document.getElementById("postPopupModal").classList.add("hidden");
    }
  }
</script>




</body>
</html>

